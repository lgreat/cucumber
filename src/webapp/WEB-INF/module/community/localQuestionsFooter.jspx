<?xml version="1.0" encoding="UTF-8"?>
<jsp:root version="2.0"
          xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:community="urn:jsptagdir:/WEB-INF/tags/community"
          xmlns:content="urn:www.greatschools.net/taglib/content"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:variant="urn:jsptagdir:/WEB-INF/tags/variant"
        >
    <jsp:directive.page import="gs.web.util.context.SessionContext"/>
    <jsp:directive.page import="gs.web.util.context.SessionContextUtil"/>

    <!-- Parameters -->
    <!-- id for city location object -->
    <c:set var="cityId" value="${param.cityId}"/>
    <!-- name for city location object -->
    <c:set var="cityDisplayName" value="${param.cityDisplayName}"/>
    <!-- pagename of calling page, for omniture eVar5 tracking -->
    <c:set var="callerPagename" value="${param.callerPagename}"/>
    <c:if test="${callerPagename eq null or callerPagename eq ''}">
        <!-- Default to some distinctive value -->
        <c:set var="callerPagename" value="unspecified"/>
    </c:if>
    <!-- Max number of entries to show (populated in numberOfEntriesToShow) -->
    <c:set var="maxEntries" value="${param.maxEntries}"/>

    <c:if test="${cityId > 0 and not requestScope.context.crawler}">
        <jsp:scriptlet>
            int numberOfEntriesToShow = 1;
            if (request.getParameter("maxEntries") != null) {
                numberOfEntriesToShow = Integer.valueOf(request.getParameter("maxEntries"));
            }
            if (numberOfEntriesToShow &lt; 1 || numberOfEntriesToShow > 5) {
                numberOfEntriesToShow = 1;
            }
            SessionContext sessionContext = SessionContextUtil.getSessionContext(request);
            String communityHost = sessionContext.getSessionContextUtil().getCommunityHost(request);
            String url = "http://" + communityHost +
                    "/category/feed/?category=all,none&amp;type=question&amp;loc_id=" + request.getParameter("cityId") +
                    "&amp;limit=" + numberOfEntriesToShow;

            request.setAttribute("communityHost", communityHost);
            request.setAttribute("communityFeedUrl", url);
            request.setAttribute("numberOfEntriesToShow", numberOfEntriesToShow);
        </jsp:scriptlet>

        <pageHelper:externalCss file="/res/css/community/local/questionsFooter.css"/>

        <div id="localQuestionsContainer">
            <div id="localQuestions">
                <a class="noDecoration"
                   onclick="clickCapture.capture('eVar5', 'LOCAL${callerPagename}'); return true"
                   href="http://${communityHost}/q-and-a/browse?sort=timestamp&amp;amp;order=desc&amp;amp;tab=local#browseQuestions">
                    <img class="localQuestionsLogo" src="/res/img/community/local/localfooter_logo_light.gif" alt="Local"/>
                </a>
                <h2>
                    <a class="noDecoration"
                       onclick="clickCapture.capture('eVar5', 'LOCAL${callerPagename}'); return true"
                       href="http://${communityHost}/q-and-a/browse?sort=timestamp&amp;amp;order=desc&amp;amp;tab=local#browseQuestions">${cityDisplayName}</a>
                </h2>
                <div class="caption">
                    <a class="noDecoration"
                       onclick="clickCapture.capture('eVar5', 'LOCAL${callerPagename}'); return true"
                       href="http://${communityHost}/q-and-a/browse?sort=timestamp&amp;amp;order=desc&amp;amp;tab=local#browseQuestions">Talk to parents about local schools</a>
                </div>
                <content:feed feedUrl="${communityFeedUrl}" numberOfEntriesToShow="${numberOfEntriesToShow}" showCommentCount="false"
                              numberOfCharactersPerEntryToShow="100" onClick="clickCapture.capture('eVar5', 'LOCAL${callerPagename}'); return true">
                    <!-- If no RSS content is found hide this module -->
                    <pageHelper:externalCss file="/res/css/community/local/questionsHide.css"/>
                </content:feed>
                <a class="localQuestionsMore" onclick="clickCapture.capture('eVar5', 'LOCAL${callerPagename}'); return true"
                   href="http://${communityHost}/q-and-a/browse?sort=timestamp&amp;amp;order=desc&amp;amp;tab=local#browseQuestions"><gsml:img
                        src="/res/img/community/local/more_small.gif" alt="More"/></a>
            </div>
        </div>
    </c:if>

</jsp:root>