<?xml version="1.0" encoding="UTF-8"?>
<jsp:root version="2.0"
          xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml" xmlns:variant="urn:jsptagdir:/WEB-INF/tags/variant"
        >
    <jsp:directive.tag body-content="empty"
                       description="Adds a Facebook like button to the page. Requires that the proper meta tags have been added to the document head and that the html tag contains the proper xmlns declarations."
                        import="gs.web.util.UrlBuilder"
    />
    <jsp:directive.attribute name="showLongText" type="java.lang.Boolean"
                             description="Whether or not to display the 'people like [school name]' text"
                             required="true"/>

        <jsp:scriptlet>
            UrlBuilder urlBuilder = new UrlBuilder("home");
            String domainUrl = urlBuilder.asFullUrlXml(request);
            request.setAttribute("domainUrl", domainUrl);
        </jsp:scriptlet>

    <div id="fb-root" class="hidden"><!-- empty tag = broken page --></div>
    <!--
        switch to test asynchronous vs. synchronous loading of the like button
    -->
    <c:choose>
        <c:when test="${(not empty param.synclike)}">
            <script src="http://connect.facebook.net/en_US/all.js"><!-- not empty --></script>

            <script>
                FB.init({
                    appId  : '112862918759431',
                    status : true, // check login status
                    cookie : true, // enable cookies to allow the server to access the session
                    xfbml  : true,  // parse XFBML
                    channelUrl: '${domainUrl}res/channel.html'
                });
                //        FB.event.subscribe('edge.create',function(){});
            </script>
        </c:when>
        <c:otherwise>
            <script type="text/javascript">
                window.fbAsyncInit = function() {
                    FB.init({appId: '112862918759431', status: true, cookie: true, xfbml: true, channelUrl: '${domainUrl}res/channel.html'});

                };

                (function() {
                    var e = document.createElement('script');
                    e.async = true;
                    e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
                    document.getElementById('fb-root').appendChild(e);
                }());

            </script>
        </c:otherwise>
    </c:choose>
    <![CDATA[
    <fb:like href="${pageUrlOnFacebook}" layout="button_count" show_faces="false" width="90" action="like" colorscheme="light" font="arial"></fb:like>
    ]]>
</jsp:root>

