<?xml version="1.0" encoding="UTF-8"?>
<jsp:root version="2.0"
          xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:variant="urn:jsptagdir:/WEB-INF/tags/variant"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:gsweb="gstaglib"
        >
    <jsp:directive.tag body-content="empty"
                       description="Adds a Facebook like button to the page. Requires that the proper meta tags have been added to the document head and that the html tag contains the proper xmlns declarations."
            />
    <jsp:directive.attribute name="includeFbSendBtn" required="true" type="java.lang.Boolean"
                             description="Whether to include the facebook send button"/>

    <pageHelper:externalJavascript file="/res/js/omnitureEventNotifier.js"/>

    <div id="fb-root" class="hidden"><!-- empty tag = broken page --></div>


    <script type="text/javascript">
        GS = GS || {};
        GS.FB = GS.FB || {};
        GS.FB.subscribes = function() {
            FB.Event.subscribe('edge.create', function(response) {
                omnitureEventNotifier.clear();
                omnitureEventNotifier.successEvents = "event36;";
                omnitureEventNotifier.send();
            });

            FB.Event.subscribe('message.send', function(response) {
                omnitureEventNotifier.clear();
                omnitureEventNotifier.successEvents = "event38;";
                omnitureEventNotifier.send();
            });
        };

        window.fbAsyncInit = function() {
            FB.init({appId: "${gsweb:getFacebookAppId()}", status: true, cookie: true, xfbml: true});
            GS.FB.subscribes();
        };

        (function() {
            var e = document.createElement('script');
            e.async = true;
            e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
            document.getElementById('fb-root').appendChild(e);
        }());

    </script>
    <c:choose>
        <c:when test="${includeFbSendBtn== true}">
            <![CDATA[
    <fb:like href="${pageUrlOnFacebookUN}" layout="button_count" show_faces="false" width="150" action="like" colorscheme="light" font="arial" send="true"></fb:like>
    ]]>
        </c:when>
        <c:otherwise>
            <![CDATA[
    <fb:like href="${pageUrlOnFacebookUN}" layout="button_count" show_faces="false" width="150" action="like" colorscheme="light" font="arial" ></fb:like>
    ]]>
        </c:otherwise>
    </c:choose>

</jsp:root>

