<?xml version="1.0" encoding="UTF-8"?>
<jsp:root version="2.0"
    xmlns:jsp="http://java.sun.com/JSP/Page"
    xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
    xmlns:community="urn:jsptagdir:/WEB-INF/tags/community"
    xmlns:link="urn:www.greatschools.org/taglib/link"
    xmlns:c="http://java.sun.com/jsp/jstl/core">
    <jsp:directive.tag body-content="scriptless"/>
    <!--
        INSTRUCTIONS FOR USE

        You must supply the following parameters:
        openingElementSelector - JQuery selector for the elements to apply an onClick to that opens the hover.
                                    e.g. "#updateMyPhotoLink"

        @author aroy@greatschools.org
    -->
    <!-- Required attributes -->
    <jsp:directive.attribute name="openingElementSelector" required="true" type="java.lang.String"
                             description="Jquery selector to apply an onClick function to that opens the hover."/>
    <jsp:directive.attribute name="redirect" required="true" type="java.lang.String"
                             description="URL to load once avatar upload is complete."/>

    <pageHelper:externalJavascript file="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"/>
    <pageHelper:externalJavascript file="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"/>
    <pageHelper:externalJavascript file="/res/js/jquery/plugins/bgiframe/2.1.1/jquery.bgiframe.min.js"/>

    <script type="text/javascript">

        if (GS.types == undefined) {
           GS.types = {};
        }
        GS.types.uploadAvatarHover = function() {
            this.uploadAvatarIframeUrl = '/community/hover/uploadAvatarHover.page?memberId=${requestScope.context.user.id}';
            this.init = function() {
                jQuery('#uploadAvatarHover').dialog({
                    autoOpen: false,
                    resizable: false,
                    modal: true,
                    draggable: false,
                    width: 645,
                    title: "Upload a picture",
                    bgiframe: true,
                    zIndex: 99999999
                });
            };
            this.open = function() {
                jQuery('#uploadAvatarHover').dialog('open');
                jQuery('#uploadAvatarIFrame').attr('src', this.uploadAvatarIframeUrl);
            };
            this.done = function() {
                jQuery('#uploadAvatarHover').dialog('close');
                document.location='${pageScope.redirect}';
            };
        };

        jQuery(function() {
            GS.uploadAvatarHover = new GS.types.uploadAvatarHover();
            GS.uploadAvatarHover.init();

            GS.registerCloseDialogHandler(function() {
                jQuery('#uploadAvatarHover').dialog("close");
            });

            jQuery('${pageScope.openingElementSelector}').click(function() {
                GS.uploadAvatarHover.open();
                return false;
            });
        });
    </script>

    <div id="uploadAvatarHover" style="display:none;">
        <iframe src="" id="uploadAvatarIFrame"
                name="uploadAvatarIFrame"
                frameborder="0" height="445" width="645" scrolling="no"
                marginheight="0" marginwidth="0"><!-- don't collapse --></iframe>
    </div>
</jsp:root>
