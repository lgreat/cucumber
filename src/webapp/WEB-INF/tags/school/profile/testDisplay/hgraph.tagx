<?xml version="1.0" encoding="UTF-8"?>
<jsp:root version="2.0"
          xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
        >
    <jsp:directive.attribute name="subjectToYears" type="gs.web.school.test.SubjectToTestValues" required="true"/>
    <jsp:directive.attribute name="hideSubject" type="java.lang.Boolean" required="true"/>
    <jsp:directive.attribute name="dataNAText" type="java.lang.String" required="true"/>

    <c:set var="scoresContent">
        <c:forEach var="testValue" items="${pageScope.subjectToYears.testValues}"
                   varStatus="loopCount">
            <c:set var="firstTimeBlue" value=""/>
            <c:set var="firstTimeDarkGrey" value="quiet"/>
            <!--Display the state average for only the latest year-->
            <c:if test="${loopCount.count eq 1}">
                <c:set var="stateAvg" value="${testValue.stateAvg}"/>
                <c:set var="numberTested" value="${testValue.numberTested}"/>
                <c:set var="testYearAvg" value="${testValue.year}"/>
                <c:set var="firstTimeBlue" value="blue"/>
                <c:set var="firstTimeDarkGrey" value="make-2b2b2b"/>
            </c:if>

            <div class="line">
                <div class="unit size10of100">
                    <p class="small bottom">
                        <strong class="${firstTimeDarkGrey}">${testValue.year}</strong></p>
                </div>
                <div class="unit size4of100">&amp;nbsp;</div>
                <div class="unit size67of100">
                    <div class="bar_container thin ${firstTimeBlue}">
                        <div style="width:${testValue.testScoreStr}%"><!-- not empty --></div>
                    </div>
                </div>
                <div class="unit size3of100">&amp;nbsp;</div>
                <c:set var="thePercentage"
                       value="${testValue.testScoreLabel}%"/>
                <c:if test="${testValue.testScoreLabel == pageScope.dataNAText}">
                    <c:set var="thePercentage" value="n/a"/>
                </c:if>
                <div class="unit size15of100 small lastUnit bottom">
                    <strong class="${firstTimeDarkGrey}">${thePercentage}</strong></div>
            </div>

        </c:forEach>
    </c:set>

    <div class="mod standard_1-1">
        <div class="inner">
            <div class="bd">
                <div class="line">
                    <c:if test="${!hideSubject}">
                        <div class="unit size35of100 pam">
                            <h5 class="mbn">${subjectToYears.subjectLabel}</h5>
                            <c:if test="${stateAvg != pageScope.dataNAText}">
                                <p class="small bottom">The state average for ${subjectToYears.subjectLabel} was ${stateAvg}% in ${testYearAvg}.</p>
                            </c:if>
                            <c:if test="${not empty numberTested}">
                                <p class="small bottom">${numberTested} students were tested at this school in ${testYearAvg}.</p>
                            </c:if>
                        </div>
                    </c:if>
                    <div class="unit size62of100 lastUnit pam">
                        <c:out value="${scoresContent}"
                               escapeXml="false"/>
                    </div>
                </div>
            </div>
        </div>
    </div>

</jsp:root>