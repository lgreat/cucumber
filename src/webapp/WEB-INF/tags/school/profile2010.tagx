<?xml version="1.0" encoding="UTF-8"?>
<jsp:root version="2.0"
          xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:promo="urn:jsptagdir:/WEB-INF/tags/promo"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          xmlns:gslink="urn:jsptagdir:/WEB-INF/tags/link"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:school="urn:jsptagdir:/WEB-INF/tags/school"
          xmlns:gsweb="gstaglib"
          xmlns:community="urn:jsptagdir:/WEB-INF/tags/community"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:variant="urn:jsptagdir:/WEB-INF/tags/variant"
        >
<jsp:directive.tag body-content="scriptless"/>
<jsp:directive.attribute name="school" required="true" description="School object" type="gs.data.school.School"/>
<jsp:directive.attribute name="tab" required="true" description="The Selected Tab" type="java.lang.String"/>
<jsp:directive.attribute name="subtab" required="false" description="The Selected Sub-Tab, if any" type="java.lang.String"/>
<jsp:directive.attribute name="omniturePageName" required="true" type="java.lang.String"
                         description="Omniture page name for custom click tracking"/>

<pageHelper:externalCss file="/res/css/school/profile2010.css"/>
<c:set var="state" value="${school.databaseState}"/>
<c:set var="city" value="${school.physicalAddress.city}"/>
<c:set var="schoolId" value="${school.id}"/>
<c:set var="headerLinkAnchor" value="from..HeaderLink"/>

<school:hovers school="${school}" tab="${tab}"/>

<div id="schoolProfile" class="${(tab eq 'overview')? 'overview' : ''}">

    <div id="schoolProfileHeader">
        <div id="breadcrumbs">
            <ul>
                <li><link:home>Home</link:home> &amp;gt; </li>
                <li><link:research state="${state}"
                                   title="${state.longName} schools">${state.longName} schools</link:research> &amp;gt;
                </li>
                <li><link:city city="${city}" state="${school.physicalAddress.state}"
                               title="${city} schools">${city} <c:if test="${school.levelCode eq 'p'}">pre</c:if>schools</link:city>&amp;#160;
                </li>
                <c:if test="${school.districtId != 0 and school.levelCode != 'p'}">
                    <li>&amp;gt; <link:districtHome district="${school.district}"
                                                       title="District information"><c:out value="${school.district.name}" escapeXml="true"/></link:districtHome>
                    </li>
                </c:if>
                <c:if test="${school.levelCode == 'p'}">
                    <li>&amp;gt; <link:schools cityName="${city}" levelCode="p">${city} preschools</link:schools></li>
                </c:if>
            </ul>
        </div>
        <!-- end: breadcrumbs -->

        <!-- School name -->
        <div id="schoolName">
            <h1>${school.name}</h1>
        </div>
        <!-- End School name -->

        <div id="schoolTypeInfo">
            <!-- School Type -->
            <c:if test="${school.levelCode ne 'p'}">
                ${gsweb:capitalize(school.type.schoolTypeName)} |
            </c:if>
            <!-- Grade levels -->
            <c:choose>
                <c:when test="${school.levelCode eq 'p'}">
                    Preschool
                </c:when>
                <c:otherwise>
                    ${school.gradeLevels}
                </c:otherwise>
            </c:choose>
            <!-- Religious affiliation -->
            <c:if test="${not empty school.affiliation}">
                | ${school.affiliation}
            </c:if>
            <!-- Enrollment -->
            <c:set var="enrollmentOrCapacity" value="${school.enrollmentOrCapacity}"/>
            <c:choose>
                <c:when test="${not empty enrollmentOrCapacity and enrollmentOrCapacity > 0}">
                    | ${enrollmentOrCapacity} ${gsweb:pluralize(enrollmentOrCapacity, 'Student')}
                </c:when>
            </c:choose>
        </div>

        <div id="schoolToolLinks">
            <span>
                <img alt="Add to My School List" src="/res/img/school/tools_th_add.gif"/>
                <link:mySchoolList school="${school}" anchor="${headerLinkAnchor}">Add to My School List</link:mySchoolList>
            </span>
            <span>
                <img alt="Rate and Review" src="/res/img/school/tools_th_rate.gif"/>
                <link:schoolProfileParentReview school="${school}" anchor="schoolReviewSubmitForm">Rate &amp;amp; Review</link:schoolProfileParentReview>
            </span>
            <span>
                <img src="/res/img/school/overview/7970_b/print.gif" alt="Print this page"/>
                <a href="javascript:window.print();">Print</a>
            </span>
            <span>
                <gsml:url var="mailToFriendUrl"
                          value="/community/mailToFriend.page?schoolId=${school.id}&amp;amp;refer=${tab}"/>
                <img src="/res/img/school/tools_th_email.gif" alt="Email this page to a friend"/>
                <a href="${mailToFriendUrl}"
                        onclick="window.open('${mailToFriendUrl}', 'win', 'width=600,height=550,scrollbars=yes'); return false;">Email</a>
            </span>
            <span>
                <gslink:realtorDotComLink school="${school}">Homes for sale</gslink:realtorDotComLink>
            </span>
        </div>

        <div id="schoolInfo">
            <c:if test="${not empty school.phone or not empty school.fax or not empty school.webSite}">
                <div id="schoolInfoLeftColumn">
                    <c:if test="${not empty school.phone}">
                        <div><label>Phone:</label> ${school.phone}</div>
                    </c:if>
                    <c:if test="${not empty school.fax}">
                        <div><label>Fax:</label> ${school.fax}</div>
                    </c:if>
                    <c:if test="${not empty requestScope.pq_hours}">
                        <div><label>Hours:</label> ${requestScope.pq_hours}</div>
                    </c:if>
                    <c:if test="${not empty school.webSite}">
                        <div>
                            <c:choose>
                                <c:when test="${(fn:startsWith(school.webSite,'http://')) or (fn:startsWith(school.webSite,'https://'))}">
                                    <a href="${school.webSite}" target="_blank">School Website</a>
                                </c:when>
                                <c:otherwise>
                                    <a href="http://${school.webSite}" target="_blank">School Website</a>
                                </c:otherwise>
                            </c:choose>
                        </div>
                    </c:if>
                </div>
            </c:if>
            <div id="schoolInfoRightColumn">
                <address class="adr">
                    <span class="street-address">${school.physicalAddress.street}</span>
                    <br/>
                    <span>
                        <span class="locality">${school.physicalAddress.city}</span>,
                        <span class="region">${school.physicalAddress.state.abbreviation} </span>
                        <span class="postal-code">${school.physicalAddress.zip}</span>
                    </span>
                    <br/>
                    <span>
                        <c:if test="${not empty(school.county)}">
                            <c:choose>
                                <c:when test="${fn:endsWith(school.county,'County')}">${school.county}</c:when>
                                <c:when test="${school.physicalAddress.state.abbreviation eq 'LA'}">${school.county} Parish</c:when>
                                <c:otherwise>${school.county} County</c:otherwise>
                            </c:choose>
                        </c:if>
                        <c:if test="${not empty(school.county)}"> | </c:if>
                        <link:mapSchool rel="foaf.based_near" school="${school}">Map</link:mapSchool>
                    </span>
                </address>
                <c:if test="${school.districtId gt 0 and school.levelCode ne 'p'}">
                    <div>
                        <link:districtHome district="${school.district}"
                                           title="District information"><c:out value="${school.district.name}"
                                                                               escapeXml="true"/></link:districtHome>
                    </div>
                </c:if>
            </div>

        </div>
    </div>
    <!-- end schoolProfileHeader -->

    <div id="schoolProfileBody">
        <div id="schoolProfileLeftColumn">
            <div id="schoolProfileTabsWrapper">
                <ul id="schoolProfileTabs">
                    <li id="sptab1" class="${(tab eq 'overview')?'active':'inactive'}">
                        <c:choose>
                            <c:when test="${tab eq 'overview'}">Overview</c:when>
                            <c:otherwise>
                                <link:schoolProfileOverview school="${school}" anchor="${headerLinkAnchor}">Overview</link:schoolProfileOverview>
                            </c:otherwise>
                        </c:choose>
                    </li>
                    <li id="sptab2" class="${(tab eq 'parentReviews')?'active':'inactive'}">
                        <c:choose>
                            <c:when test="${tab eq 'parentReviews'}">Reviews</c:when>
                            <c:otherwise>
                                <link:schoolProfileParentReview school="${school}" anchor="${headerLinkAnchor}">Reviews</link:schoolProfileParentReview>
                            </c:otherwise>
                        </c:choose>
                    </li>
                    <c:choose>
                        <c:when test="${school.levelCode eq 'p' and requestScope.hasSurveyData}">
                            <c:set var="sptab3_name" value="Program Details"/>
                            <!-- TODO: Link to parent survey display page -->
                            <c:set var="sptab3_link"><a href="#" onclick="return false;">${sptab3_name}</a></c:set>
                        </c:when>
                        <c:when test="${requestScope.hasTestScores}">
                            <c:set var="sptab3_name" value="Test Scores &amp;amp; Stats"/>
                            <c:set var="sptab3_link"><a href="/school/testScores.page?id=${school.id}&amp;amp;state=${school.databaseState}#${headerLinkAnchor}">${sptab3_name}</a></c:set>
                        </c:when>
                        <c:when test="${school.type.name eq 'private'}">
                            <c:set var="sptab3_name" value="School Stats"/>
                            <c:set var="sptab3_link"><a href="/school/teachersStudents.page?id=${school.id}&amp;amp;state=${school.databaseState}#${headerLinkAnchor}">${sptab3_name}</a></c:set>
                        </c:when>
                    </c:choose>
                    <c:if test="${not empty sptab3_name}">
                        <li id="sptab3" class="${(tab eq 'schoolStats')?'active':'inactive'}">
                            <c:choose>
                                <c:when test="${tab eq 'schoolStats'}">${sptab3_name}</c:when>
                                <c:otherwise>
                                    ${sptab3_link}
                                </c:otherwise>
                            </c:choose>
                        </li>
                    </c:if>
                    <li id="sptab4" class="${(tab eq 'schoolMap')?'active':'inactive'}">
                        <c:choose>
                            <c:when test="${tab eq 'schoolMap'}">Map</c:when>
                            <c:otherwise>
                                <link:mapSchool school="${school}" anchor="${headerLinkAnchor}">Map</link:mapSchool>
                            </c:otherwise>
                        </c:choose>
                    </li>
                </ul>
                <div id="schoolInaccuracy" class="fltrt">
                    Notice an inaccuracy?
                    <link:profileFeedback>Let us know!</link:profileFeedback>
                </div>
            </div>
            <!-- end schoolProfileTabsWrapper -->
            <div id="schoolProfileContentsWrapper">
                <c:if test="${tab eq 'schoolStats' and school.levelCode ne 'p' and (school.type.name ne 'private' or requestScope.hasSurveyData or requestScope.hasTestScores)}">
                    <div id="schoolProfileSubTabsWrapper">
                        <ul id="schoolProfileSubTabs">
                            <c:if test="${requestScope.hasTestScores}">
                                <li id="spstab1" class="${(subtab eq 'testScores')?'active':'inactive'}">
                                    <c:choose>
                                        <c:when test="${subtab eq 'testScores'}">Test scores</c:when>
                                        <c:otherwise>
                                            <a href="/school/testScores.page?id=${school.id}&amp;amp;state=${school.databaseState}#${headerLinkAnchor}">Test scores</a>
                                        </c:otherwise>
                                    </c:choose>
                                </li>
                            </c:if>
                            <c:if test="${school.type.name ne 'private'}">
                                <li id="spstab2" class="${(subtab eq 'ratings')?'active':'inactive'}">
                                    <c:choose>
                                        <c:when test="${subtab eq 'ratings'}">GreatSchools Ratings</c:when>
                                        <c:otherwise>
                                            <link:schoolProfileRating school="${school}" anchor="${headerLinkAnchor}">GreatSchools Ratings</link:schoolProfileRating>
                                        </c:otherwise>
                                    </c:choose>
                                </li>
                            </c:if>
                            <li id="spstab3" class="${(subtab eq 'teachersStudents')?'active':'inactive'}">
                                <c:choose>
                                    <c:when test="${subtab eq 'teachersStudents'}">Teachers &amp;amp; Students</c:when>
                                    <c:otherwise>
                                        <a href="/school/teachersStudents.page?id=${school.id}&amp;amp;state=${school.databaseState}#${headerLinkAnchor}">Teachers &amp;amp; Students</a>
                                    </c:otherwise>
                                </c:choose>
                            </li>
                            <c:if test="${requestScope.hasSurveyData}">
                                <li id="spstab4" class="${(subtab eq 'survey')?'active':'inactive'}">
                                    <c:choose>
                                        <c:when test="${subtab eq 'survey'}">Programs &amp;amp; Extracurriculars</c:when>
                                        <c:otherwise>
                                            <link:startSurveyResults school="${school}"
                                                                     styleClass="GS_CI9_">Programs &amp;amp; Extracurriculars</link:startSurveyResults>
                                        </c:otherwise>
                                    </c:choose>
                                </li>
                            </c:if>
                        </ul>
                    </div>
                    <!-- end schoolProfileSubTabsWrapper -->
                </c:if>
                <br class="clearfloat"/>
                <div id="bodyContents">
                    <jsp:doBody/>
                </div>
            </div>
        </div>
        <!-- end schoolProfileLeftColumn -->

        <div id="schoolProfileRightColumn">
            <c:choose>
                <c:when test="${tab eq 'overview'}">
                    <ad:AboveFold_300x250/>

                    <variant:b>
                        <promo:schoolChoicePackPromo
                                schoolName="${school.name}"
                                showBorder="${true}"
                                showSchoolChoiceLink="${true}"
                                schoolObjectForRedirect="${school}"
                                showConfirmation="${not empty param.confirm and param.confirm eq 'true'}"
                                />
                    </variant:b>
                    
                    <ad:House_Ad_300x137 referredBy="${omniturePageName}"/>

                    <!-- Community module -->
                    <c:set var="recentDiscussions" value=""/>
                    <c:if test="${not empty requestScope.discussionBoardId}">
                        <gsweb:currentAbsolutePath var="myUrl" urlEncode="true"/>
                        <c:set var="recentDiscussions">
                            <c:import
                                    url="/community/profileRecentDiscussions.module?board_id=${requestScope.discussionBoardId}&amp;limit=3&amp;uri=${myUrl}"/>
                        </c:set>
                    </c:if>
                    ${recentDiscussions}
                    
                    <ad:BelowFold_300x250/>
                </c:when>
                <c:when test="${tab eq 'schoolMap'}">
                    <promo:searchRealtorDotCom omniturePageName="${pageName}" showAdPct="0" size="300x137"
                                               defaultCity="${city}" defaultState="${stateAbbrev}"/>
                    <!--DESIGNER NOTE: "AD" MARKUP IS THE SAME AS THE EXISTING OVERVIEW INTERFACES -->
                    <div class="ad_middle">
                        <ad:AboveFold_300x250/>
                    </div>
                </c:when>
                <c:otherwise>
                    <ad:AboveFold_300x250/>

                    <ad:House_Ad_300x137 referredBy="${omniturePageName}"/>

                    <promo:searchRealtorDotCom omniturePageName="${omniturePageName}" showAdPct="0" size="300x137"
                                               defaultCity="${school.city}" defaultState="${school.databaseState.abbreviation}"/>

                    <!-- Community module -->
                    <c:set var="recentDiscussions" value=""/>
                    <c:if test="${not empty requestScope.discussionBoardId}">
                        <gsweb:currentAbsolutePath var="myUrl" urlEncode="true"/>
                        <c:set var="recentDiscussions">
                            <c:import
                                    url="/community/profileRecentDiscussions.module?board_id=${requestScope.discussionBoardId}&amp;limit=3&amp;uri=${myUrl}&amp;topic=${discussionTopic}"/>
                        </c:set>
                    </c:if>
                    ${recentDiscussions}

                    <ad:BelowFold_300x250/>

                    <ad:BelowFold_Top_300x125/>

                </c:otherwise>
            </c:choose>
        </div>
        <!-- end schoolProfileRightColumn -->

        <br class="clearfloat"/>
    </div>
    <!-- end schoolProfileBody -->

</div>
<!-- end schoolProfile -->
</jsp:root>
