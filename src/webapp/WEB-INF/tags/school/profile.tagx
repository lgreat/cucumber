<?xml version="1.0" encoding="UTF-8"?>
<jsp:root version="2.0"
          xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:promo="urn:jsptagdir:/WEB-INF/tags/promo"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:link="urn:www.greatschools.net/taglib/link"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:school="urn:jsptagdir:/WEB-INF/tags/school"
        >
<jsp:directive.tag body-content="scriptless"/>
<jsp:directive.attribute name="school" required="true" description="School object" type="gs.data.school.School"/>
<jsp:directive.attribute name="tab" required="false" description="The Selected Tab" type="java.lang.String"/>
<pageHelper:externalCss file="/res/css/school/profile.css"/>

<jsp:scriptlet>
    try {
        String adPageName = "school/" + school.getType().getSchoolTypeName() + '/' + school.getLevelCode().getCommaSeparatedString().charAt(0);
        StringBuffer keywordBuffer = new StringBuffer();
        keywordBuffer.append("type=").append(school.getType().getSchoolTypeName())
                .append("&amp;")
                .append("level=").append(school.getLevelCode().getCommaSeparatedString().charAt(0))
                .append("&amp;")
                .append("county=").append(school.getCounty().replaceAll("\\s+","+"))
                .append("&amp;")
                .append("school_id=").append(school.getId());
    
        request.setAttribute("adPageName", adPageName);
        request.setAttribute("adKeywords", keywordBuffer.toString());
    } catch (Exception e){}
</jsp:scriptlet>



<c:set var="state" value="${school.physicalAddress.state}"/>
<c:set var="city" value="${school.physicalAddress.city}"/>
<c:set var="schoolId" value="${school.id}"/>

<c:choose>
    <c:when test="${school.type.schoolTypeName != 'private'}">
        <c:set var="schoolType" value="public"/>
        <pageHelper:externalJavascript file="/cm/mss_modal.js"/>
        <pageHelper:addOnLoadHandler handler="DisplayPopUp('${state}','${schoolId}',0,'${tab}');"/>
        <pageHelper:externalJavascript file="/cm/mss_modal.js"/>
        <!--TODO pagehelper method just for adding hovers so we don;t have to keep track on version numbers in different places-->
        <pageHelper:externalCss file="/res/css/submodal/submodal.css?v=7"/>
        <pageHelper:externalJavascript file="/res/js/submodal/submodal.js?v=7"/>
    </c:when>
    <c:otherwise>
        <c:set var="schoolType" value="private"/>
    </c:otherwise>
</c:choose>
<div id="schoolProfile">
<div id="printEmail">
    <gsml:url var="mailToFriendUrl" value="/community/mailToFriend.page?schoolId=${school.id}&amp;refer=${tab}"/>
    <a href="%" onClick=" window.print(); return false">Print this page</a>&amp;nbsp;&amp;nbsp;&amp;nbsp;|&amp;nbsp;&amp;nbsp;&amp;nbsp;<gsml:a href="${mailToFriendUrl}" onClick=" window.open('${mailToFriendUrl}', 'win', 'width=600,height=550,scrollbars=yes'); return false;">Email to a friend</gsml:a>
</div>
    <div class="wrap0">
        <div class="wrap1">
            <div class="wrap2">
                <div class="wrap3">
                    <div class="box">
                        <table class="rollmenu" cellspacing="0" cellpadding="0">
                            <tr>
                                <td class="${(tab eq 'overview') ? 'active' : 'inactive'}"><link:schoolProfileOverview school="${school}">School<br/>Overview
                                </link:schoolProfileOverview></td>
                                <c:choose>
                                    <c:when test="${schoolType != 'private'}" >
                                        <c:if test="${state.ratingsState}">
                                            <td class="${(tab eq 'ratings') ? 'active' : 'inactive'}"><link:schoolProfileRating school="${school}">GreatSchools<br/>Ratings
                                            </link:schoolProfileRating></td>
                                        </c:if>
                                        <td><link:schoolProfileTestscore school="${school}">Test<br/>Scores
                                        </link:schoolProfileTestscore></td>
                                        <td><link:schoolProfileCensus school="${school}">Teachers/<br/>Students
                                        </link:schoolProfileCensus></td>
                                    </c:when>
                                    <c:otherwise>
                                        <td><link:schoolProfilePrivateQuickFacts school="${school}">Quick<br/>Facts
                                        </link:schoolProfilePrivateQuickFacts></td>
                                        <td><link:schoolProfileCensus school="${school}">Teachers/<br/>Students
                                        </link:schoolProfileCensus></td>
                                    </c:otherwise>
                                </c:choose>
                                <td><link:schoolProfileParentReview school="${school}">Parent<br/> Reviews
                                </link:schoolProfileParentReview></td>
                                <td><link:schoolProfilePrincipalView school="${school}">Principal's <br/>View
                                </link:schoolProfilePrincipalView></td>
                            </tr>
                        </table>

                        <div class="boxBody">
                            <h1>${school.name}</h1>
                            <c:if test="${tab ne 'authorizer'}">
                            <div id="school_info">
                                <c:if test="${not empty school.gradeLevels}">Grades: ${school.gradeLevels}<br/></c:if>

                                Type: ${school.type.schoolTypeName} <br/>
                                Enrollment:
                                <c:choose>
                                    <c:when test="${not empty school.enrollment}">
                                        ${school.enrollment}
                                    </c:when>
                                    <c:otherwise>
                                        n/a
                                    </c:otherwise>
                                </c:choose>
                                <br/>

                                <c:if test="${not empty school.physicalAddress}">
                                    <address>
                                        ${school.physicalAddress.street}<br/>
                                        ${city}, ${state} ${school.physicalAddress.zip}<br/>
                                        ${school.county} County
                                    </address>
                                </c:if>

                                <c:if test="${not empty school.phone}">
                                    Phone: ${school.phone}<br/>
                                </c:if>

                                <c:if test="${not empty school.fax}">
                                    Fax: ${school.fax}<br/>
                                </c:if>

                                <c:if test="${not empty school.webSite}">
                                    <a href="${school.webSite}" target="_blank">School Web site</a><br/>
                                </c:if>

                                <c:if test="${school.districtId != 0}">
                                    District: <gsml:a
                                        href="/cgi-bin/${state.abbreviationLowerCase}/district_profile/${school.districtId}">${school.district.name}</gsml:a>
                                    <br/>
                                </c:if>
                                More about <link:city city="${city}" state="${state}">${city} schools</link:city>
                            </div>

                            <ul id="school_links">
                                <c:if test="${schoolType != 'private'}">
                                    <li>
                                        <promo:mssHover referredBy="schoolProfile" school="${school}">Email updates<br/>
                                            about this school</promo:mssHover>
                                    </li>
                                </c:if>

                                <li>
                                    <link:schoolCompareSchool school="${school}">Compare this
                                        school</link:schoolCompareSchool>
                                </li>
                                <li><gsml:a href="/cgi-bin/msl_confirm/${state.abbreviationLowerCase}/?add_ids=${school.id}">Add to My
                                    SchoolList</gsml:a></li>
                                <li><link:schoolProfileAddParentReview school="${school}">Rate this
                                    school</link:schoolProfileAddParentReview></li>

                                <c:if test="${not empty school.physicalAddress}">
                                    <li>
                                        <gsml:a href="http://maps.google.com/maps?oi=map&amp;q=${school.physicalAddress.street},${school.physicalAddress.city} ${school.physicalAddress.state}"
                                           target="_blank">Map</gsml:a>
                                    </li>
                                </c:if>
                            </ul>

                            <div id="school_promo" class="noprint">
                                <c:choose>
                                    <c:when test="${not empty school.authorizer}">
                                        <school:charterAuthorizerPromo school="${school}"/>
                                    </c:when>
                                    <c:otherwise>
                                        <promo:schoolChoiceTips/>
                                    </c:otherwise>
                                </c:choose>
                            </div>

                            <div id="site_promo" class="noprint">
                                <ad:beta/>
                            </div>
                            </c:if>
                            <br style="clear:both;"/>
                            <jsp:doBody/>

                        </div>
                        <br style="clear:both;"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</jsp:root>
