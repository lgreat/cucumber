<?xml version="1.0" encoding="UTF-8"?>
<jsp:root
        xmlns:jsp="http://java.sun.com/JSP/Page" version="1.2"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
        xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
        xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
        xmlns:c="http://java.sun.com/jsp/jstl/core"
        xmlns:fn="http://java.sun.com/jsp/jstl/functions"
        xmlns:link="urn:www.greatschools.org/taglib/link"
        xmlns:gsweb="gstaglib"
        >
    <html lang="en">
    <jsp:output doctype-root-element="html"
                doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
                doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>
    <jsp:directive.page contentType="text/html"/>
    <pageHelper:hideLeaderboard/>
    <pageHelper:hideFooterAd/>
    <head>
        <![CDATA[<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>]]>
    <title>School Hold List | GreatSchools</title>
        <style type="text/css">
            .holdTable td, .holdTable th {
                padding: 2px;
                border: 1px solid #666;
            }
        </style>
        <script type="text/javascript">
            function loadCities() {
                var state = jQuery('#holdListState').val();
                if (state != '') {
                    var url = "/community/registrationAjax.page";

                    <![CDATA[
                    jQuery('#holdListCity').html("<option>Loading...</option>");
                    jQuery('#holdListSchool').html("<option>- Choose city -</option>");
                    jQuery('#holdListId').val('');
                    ]]>

                    jQuery.getJSON(url, {state:state, format:'json', type:'city'}, parseCities);
                }
            }
            function parseCities(data) {
                var citySelect = jQuery('#holdListCity');
                if (data.cities) {
                    citySelect.empty();
                    for (var x = 0; x &lt; data.cities.length; x++) {
                        var city = data.cities[x];
                        if (city.name) {
                            <![CDATA[
                            citySelect.append("<option value=\"" + city.name + "\">" + city.name + "</option>");
                            ]]>
                        }
                    }
                }
            }
            function loadSchools() {
                var state = jQuery('#holdListState').val();
                var city = jQuery('#holdListCity').val();
                if (state != '' &amp;&amp; city != '- Choose city -' &amp;&amp; city != 'My city is not listed') {
                    var url = "/community/registration2Ajax.page";

                    <![CDATA[
                    jQuery('#holdListSchool').html("<option>Loading...</option>");
                    ]]>

                    jQuery.getJSON(url, {state:state, city:city, format:'json', type:'school'}, parseSchools);
                }
            }
            function parseSchools(data) {
                var schoolSelect = jQuery('#holdListSchool');
                if (data.schools) {
                    schoolSelect.empty();
                    for (var x = 0; x &lt; data.schools.length; x++) {
                        var school = data.schools[x];
                        if (school.name &amp;&amp; school.id) {
                            <![CDATA[
                            schoolSelect.append("<option value=\"" + school.id + "\">" + school.name + "</option>");
                            ]]>
                        }
                    }
                }
            }
            function selectSchool(schoolId) {
                var state = jQuery('#holdListState').val();
                if (state != '' &amp;&amp; schoolId > -1) {
                    $('#holdListId').val(schoolId);
                }
            }

            $(function() {
                var sitePreferences = subCookie.getObject("site_pref");

                if (sitePreferences != undefined &amp;&amp; sitePreferences.holdSchoolAlert != undefined) {
                    var holdSchoolAlert = sitePreferences.holdSchoolAlert;
                    if (holdSchoolAlert == 'schoolAdded') {
                        alert("The school has been added to the hold list.")
                    } else if (holdSchoolAlert == 'schoolRemoved') {
                        alert("The school has been removed from the hold list.")
                    }
                    subCookie.deleteObjectProperty("site_pref", "holdSchoolAlert");                    
                }
            });
        </script>
    </head>
    <gsml:body pageLayout="nocol" adPageName="schoolReviewList">

        <p>To see flagged reviews, <a href="/admin/schoolReview/list.page?showFlagged=true">click here</a>.</p>        
        <p>To see unprocessed reviews, <a href="/admin/schoolReview/list.page?showUnprocessed=true">click here</a>.</p>
        <br/>

        <div class="addHold">
            <h2>Add a school to the hold list</h2>
            <form action="/admin/schoolReview/holdList.page" method="post">
                <label for="holdListState">State: </label>
                <gsweb:stateSelector allowNoState="true" name="schoolState"
                                     styleId="holdListState" onChange="loadCities();"/>
                <br/>
                <p>Either choose city and school</p>
                <label for="holdListCity">&amp;nbsp;&amp;nbsp;&amp;nbsp;City: </label>
                <select id="holdListCity" onchange="loadSchools();">
                    <option>- Choose state -</option>
                </select>
                <!--<br/>-->
                <label for="holdListSchool">&amp;nbsp;&amp;nbsp;&amp;nbsp;School: </label>
                <select id="holdListSchool" onchange="selectSchool(this.value);">
                    <option>- Choose city -</option>
                </select>
                <br/>
                <p>OR specify the school id</p>
                <label for="holdListId">&amp;nbsp;&amp;nbsp;&amp;nbsp;School Id: </label>
                <input type="text" id="holdListId" name="schoolId"/>
                <br/>
                <label for="holdListNotes">Notes: </label>
                <textarea id="holdListNotes" name="notes" cols="50" rows="3"><!-- Not empty --></textarea>
                <br/>
                <input type="hidden" name="action" value="add"/>
                <input type="submit" name="Add" value="Add"/>
            </form>
        </div>
        <br/>
        <hr/>
        <br/>
        <h2>Hold List</h2>
        <c:if test="${not empty requestScope.holdList}">
            <div id="holdList">
                <table class="holdTable">
                    <tr>
                        <th>School name</th>
                        <th>State</th>
                        <th>Notes</th>
                        <th>Date held</th>
                        <th>&amp;nbsp;</th>
                    </tr>
                    <c:forEach items="${requestScope.holdList}" var="heldSchool">
                        <c:set var="school" value="${heldSchool.school}"/>
                        <tr>
                            <td><link:schoolProfileOverview school="${school}">${school.name}</link:schoolProfileOverview></td>
                            <td>${school.databaseState}</td>
                            <td>${heldSchool.notes}</td>
                            <fmt:formatDate value="${heldSchool.created}" var="holdCreated"
                                            pattern="MMMM d, yyyy"/>
                            <td>${holdCreated}</td>
                            <td>
                                <form action="/admin/schoolReview/holdList.page" method="post">
                                    <input type="hidden" name="action" value="delete"/>
                                    <input type="hidden" name="heldSchoolId" value="${heldSchool.id}"/>
                                    <input type="submit" name="Remove" value="Remove"/>
                                </form>
                            </td>
                        </tr>
                    </c:forEach>
                </table>
            </div>
        </c:if>
        <c:if test="${empty requestScope.holdList}">
            <p>No held schools!</p>
        </c:if>
    </gsml:body>
    </html>
</jsp:root>