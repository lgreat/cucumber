<?xml version="1.0" encoding="UTF-8"?>
<jsp:root
        xmlns:jsp="http://java.sun.com/JSP/Page" version="1.2"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
        xmlns:c="http://java.sun.com/jsp/jstl/core"
        xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
        xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
        xmlns:gsweb="gstaglib"
        xmlns:form="http://www.springframework.org/tags/form">
    <html lang="en">

    <jsp:output doctype-root-element="html"
                doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
                doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>

    <jsp:directive.page contentType="text/html"/>
    <head>
        <title>Admin OSP Moderation${isPendingView ? ' - Pending' : ''}</title>
    </head>
    <gsml:body adPageName="school/esp" pageLayout="nocol">
        <!--<div class="container_24">-->
            <div class="grid_24 slStylesV1-0 espModerationTable">
                
                <div>
                    <c:choose>
                        <c:when test="${isPendingView}">
                            <a href="/admin/espModerationForm.page?pending=0">Main Requests</a>
                            &#160;&#160;&#160;
                            <b>Pending Requests</b>
                        </c:when>
                        <c:otherwise>
                            <b>Main Requests</b>
                            &#160;&#160;&#160;
                            <a href="/admin/espModerationForm.page?pending=1">Pending Requests</a>
                        </c:otherwise>
                    </c:choose>
                  &#160;&#160;&#160;
                  <a href="/admin/espModerationSearch.page">Moderation Search</a>
                </div>
								
                <div class="legend">
                    <b style="margin-right:20px;">Legend: </b>
                    <span class="emailMatch">User email matches contact email</span>
                    <span class="durra">User requesting multi-access</span>
                    <span class="schoolHasActiveMemberships">School has active memberships</span>
                    <span class="userHasProvisionalAccess">User has Provisional Access</span>
                </div>
                <form:form commandName="espModerationCommand">
                    <c:if test="${not empty mrows}">
                        <input type="submit" name="moderatorAction" value="approve"/>
                        <input type="submit" name="moderatorAction" value="reject"/>
                        <input type="submit" name="moderatorAction" value="deactivate"/>
                        <input type="submit" name="moderatorAction" value="update"/>
                    </c:if>
                    <c:if test="${isPendingView}"><input type="hidden" name="pending" value="1"/></c:if>
                    <table width="950">
                        <col width="32px"/>
                        <col width="210px"/>
                        <col width="206px"/>
                        <col width="130px"/>
                        <col width="70px"/>
                        <col width="90px"/>
                        <col width="213px"/>
                        <tr>
                            <th rowspan="2"><!--Do no collapse--></th>
                            <!--First row-->
                            <th>Email</th>
                            <th>School</th>
                            <th>First Name</th>
                            <th>State</th>
                            <th>Member Id</th>
                            <th>Contact Name</th>
                        </tr>
                        <tr>
                            <!--Second Row-->
                            <th>Contact Email</th>
                            <th>Web Url</th>
                            <th>Last Name</th>
                            <th>School Id</th>
                            <th>Job Title</th>
                            <th>Note</th>
                        </tr>
                    </table>
                    <c:choose>
                    <c:when test="${not empty mrows}">
                    <c:forEach var="mrow" items="${mrows}" varStatus="index">
                    		<c:set var="membership" value="${mrow.membership}"/>
                    		<c:set var="emailMatchClass" value="${mrow.emailMatch ? 'emailMatch' : ''}"/>
                    		<c:set var="durraClass" value="${mrow.disabledUserReRequestingAccess || mrow.hasOtherActiveEspMemberships ? 'durra' : ''}"/>
                            <c:set var="schoolHasActiveMembershipsClass" value="${mrow.schoolHasActiveMemberships ? 'schoolHasActiveMemberships' : ''}"/>
                            <c:set var="userHasProvisionalAccess" value="${mrow.userHasProvisionalAccess ? 'userHasProvisionalAccess' : ''}"/>
                    		<table width="950" class="${emailMatchClass} ${durraClass} ${schoolHasActiveMembershipsClass}${userHasProvisionalAccess}">
                            <col width="32px"/>
                            <col width="210px"/>
                            <col width="206px"/>
                            <col width="130px"/>
                            <col width="70px"/>
                            <col width="90px"/>
                            <col width="213px"/>
                            <tr>
                                <td><form:checkbox path="espMembershipIds" value="${membership.id}"/>
                                </td>
                                <!--First Row-->
                                <td><a href="mailto:${membership.user.email}">${membership.user.email}</a></td>
                                <td>
                                    ${membership.school.name}
                                    <c:if test="${mrow.schoolHasActiveMemberships eq true}">
                                        -<a href="/admin/espModerationSearch.page?schoolId=${membership.school.id}&amp;stateString=${membership.state}&amp;email=&amp;userId="> View all
                                        requests for this school</a>
                                    </c:if>
                                </td>
                                <td>${membership.user.firstName}</td>
                                <td>${membership.state}</td>
                                <td>${membership.user.id}</td>
                                <td>${mrow.contactName}</td>
                            </tr>
                            <tr>
                                <td><a href="/admin/espModerationDetails.page?id=${membership.id}">&gt;</a></td>
                                <!--Second Row-->
                                <td>${mrow.contactEmail}</td>
                                <td><a href="${gsweb:escapeHtml(mrow.absoluteWebUrl)}" target="_blank">${gsweb:escapeHtml(membership.webUrl)}</a></td>
                                <td>${membership.user.lastName}</td>
                                <td>${membership.school.id}</td>
                                <td>${membership.jobTitle}</td>
                                <td><textarea name="notes[${membership.id}]" cols="21" rows="3">${membership.note}</textarea></td>
                            </tr>
                        </table>
                    </c:forEach>
                    <br/>
                    <input type="submit" name="moderatorAction" value="approve"/>
                    <input type="submit" name="moderatorAction" value="reject"/>
                    <input type="submit" name="moderatorAction" value="deactivate"/>
                    <input type="submit" name="moderatorAction" value="update"/>
                    </c:when>
                    <c:otherwise><h4>${isPendingView? 'No pending entries exist.' : 'No main entries exist.'}</h4></c:otherwise>
                    </c:choose>                
                </form:form>
            </div>
        <!--</div>-->
        <div style="display:none;"><mod:tracking pageName="OSP Moderation" hier1="ESP"/></div>
    </gsml:body>

    </html>
</jsp:root>