<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:article="urn:jsptagdir:/WEB-INF/tags/content/cms/article"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:k12="urn:jsptagdir:/WEB-INF/tags/promo/k12"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:content="urn:jsptagdir:/WEB-INF/tags/content"
          xmlns:gsweb="gstaglib"
          version="2.0">
<jsp:directive.page import="gs.web.util.CookieUtil"/>
<html lang="en">
<jsp:directive.page contentType="text/html"/>
<jsp:scriptlet>
    request.setAttribute("isHubUser", CookieUtil.getCookieValue(request, "ishubUser"));
</jsp:scriptlet>

<pageHelper:addFacebookArticleMetaTags uri="${uri}" deck="${feature.summary}" title="${feature.title}"
                                       imageUrl="${feature.imageUrl}"/>

<ad:setSlotPrefix slotPrefix="Library_Article_Page"/>
<c:set var="omniturePageName" value="article"/>
<pageHelper:includeQualarooJS/>

<head>
    <article:title pageTitle="${feature.pageTitle}" promo="${feature.promo}" title="${feature.title}"
                   primaryCategoryName="${feature.primaryKategory.name}"/>

    <c:choose>
        <c:when test="${not empty isHubUser}">
            <meta name="decorator" content="standardDecorator-hubs"/>
        </c:when>
        <c:otherwise>
            <meta name="decorator" content="standardDecorator-v1"/>
        </c:otherwise>
    </c:choose>
    <meta name="description" content="${feature.metaDescription}"/>
    <meta name="keywords" content="${feature.metaKeywords}"/>


    <gsml:javascript src="/res/js/content/cms/article/combined.js"/>
    <!-- GS-11430 -->
    <c:if test="${showCompanionAd}">
        <script type="text/javascript" src="http://objects.tremormedia.com/embed/js/banners.js">
            // i had to put something here to avoid the tag collapsing which breaks the ad
        </script>
        <script type="text/javascript">
            function displayCompanionBanners(banners) {
                tmDisplayBanner(banners, "adCompanionBanner", 300, 250);
                jQuery('#squareadvert').hide();
                jQuery(".ad .adCompanionHeader").show();
            }
        </script>
    </c:if>

    <!-- GS-12332 -->
    <c:choose>
        <c:when test="${feature.currentPageNum == 1}">
            <link rel="canonical" href="${contentUrl}"/>
        </c:when>
        <c:when test="${feature.currentPageNum == -1}">
            <link rel="canonical" href="${singlePageContentUrl}"/>
        </c:when>
        <c:otherwise>
            <link rel="canonical" href="${contentUrl}?page=${feature.currentPageNum}"/>
        </c:otherwise>
    </c:choose>
    <c:if test="${prevPageNum != -1}">
        <link rel="prev" href="${prevPageContentUrl}"/>
    </c:if>
    <c:if test="${nextPageNum != -1}">
        <link rel="next" href="${nextPageContentUrl}"/>
    </c:if>

    <article:hoverScriplet/>
    <k12:trafficDriverIncludes/>

    <link rel="stylesheet" href="/res/css/04_text/articles-v1.css?v=$RELEASE_NUMBER" type="text/css" />
</head>

<gsml:body adPageName="article" pageLayout="nocol">

<c:if test="${not empty smallPhotos and fn:length(smallPhotos) > 0
                  and not empty mediumPhotos and fn:length(mediumPhotos) > 0
                  and not empty largePhotos and fn:length(largePhotos) > 0
                  and not empty altTexts and fn:length(altTexts) > 0}">
    <c:set var="showPhotoGallery" value="${true}"/>
</c:if>

<div class="container_24 clearfix">
    <div class="grid_16">
        <div class="articles clearfix">
            <article:breadcrumbs breadcrumbs="${breadcrumbs}"/>

            <!--Licensor logo-->
            <!-- Example article with licensor logo and attrib: http://localhost:8080/special-education/LD-ADHD/560-get-organized-for-school.gs?page=1 -->
            <c:if test="${not empty feature.licensorLogoUrl}">
                <article:licensorLogo logoUrl="${feature.licensorLogoUrl}"
                                      logoAltText="${feature.licensorLogoAltText}"
                                      licensorUrl="${feature.licensorUrl}"/>
            </c:if>

            <h1>${feature.title}</h1>

            <c:choose>
                <c:when test="${article.currentPageNum lt 2}">
                    <h4>${fn:escapeXml(article.summary)}</h4>
                </c:when>
                <c:otherwise>
                    <p class="small quiet">
                        <em>Page ${article.currentPageNum} of ${article.numPages}</em>
                    </p>
                </c:otherwise>
            </c:choose>

            <ad:adTag position="Sponsor_610x30"/>

            <!--Sidebar-->
            <div class="grid_5 alpha">
                <!-- 2012 03 26 - mitch added comment to parameter list so I could access it in the toolbar -->
                <article:toolsLayout1-v1 feature="${feature}" uri="${uri}" comments="${comments}"/>

                <!--GS-12398 Display sidebar blog module only when there is no photo gallery or related videos or related articles or feature sidebar is displayed-->
                <c:set var="showBlogModule" value="${true}" property="java.lang.Boolean"/>

                <c:if test="${showPhotoGallery}">
                    <c:set var="showBlogModule" value="${false}"/>
                    <div id="js_photo_gallery_container">
                        <article:photosCarousel/>
                    </div>
                </c:if>

                <c:if test="${feature.relatedVideos != null and fn:length(feature.relatedVideos) >0 }">
                    <c:set var="showBlogModule" value="${false}"/>
                    <div><article:relatedVideosCarousel feature="${feature}"/></div>
                </c:if>

                <c:if test="${not empty feature.relatedArticles}">
                    <c:set var="showBlogModule" value="${false}"/>
                    <article:relatedArticles-v1 feature="${feature}"/>
                </c:if>


                <c:if test="${not empty feature.sidebar}">
                    <c:set var="showBlogModule" value="${false}"/>
                    <div class="mod articleSidebar">
                        <div class="inner rnd4 mvm">
                            <div class="bd">
                                ${feature.sidebar}
                            </div>
                        </div>
                    </div>
                </c:if>

                <c:if test="${showBlogModule}">
                    <gsweb:cache key="article_sidebar_blog">
                        <content:articleSidebarBlogModule-v1/>
                    </gsweb:cache>
                </c:if>
            </div>
            <!--Sidebar-->

            <!--Content-->
            <div class="grid_11 omega articleContent">
                <!--Image-->
                <article:mainImage feature="${feature}"/>
                <!--Image-->

                <!-- Byline -->
                <article:authorByline feature="${feature}"/>
                <!-- Byline -->

                ${currentPage}

                <c:if test="${not empty feature.pdfUri and (-1 eq feature.currentPageNum or feature.numPages eq feature.currentPageNum)}">
                    <div class="fl">
                        <a class="button-1" href="${feature.pdfUri}">Download <span
                                class="sprite i-downloadarrow"><!-- do not collapse --></span></a>
                    </div>
                    <div class="lineheight-25"><a class="padlft_10"
                                                  href="${feature.pdfUri}">Download and print at home.</a>
                    </div>
                    <div class="shim-10"><!-- do not collapse --></div>
                </c:if>
            </div>
            <!--Content-->

            <div class="grid_16 alpha omega">
                <!--Share buttons-->
                <article:socialToolsLayout2-v1 includeFbSendBtn="false" includeShareBtn="true"/>
                <!--Share buttons-->

                <!-- Pagination -->
                <c:if test="${feature.numPages > 1}">
                    <div class="pagination fr js-pageNumbers">
                        <!--Page-->
                        <c:forEach begin="1" end="${feature.numPages}" var="pageNum" varStatus="status">
                            <c:choose>
                                <c:when test="${pageNum == feature.currentPageNum}">
                                    <span class="active">${pageNum}</span>
                                </c:when>
                                <c:otherwise>
                                    <c:choose>
                                        <c:when test="${pageNum == 1}">
                                            <span><a href="${contentUrl}">${pageNum}</a></span>
                                        </c:when>
                                        <c:otherwise>
                                            <span><a href="${contentUrl}?page=${pageNum}">${pageNum}</a></span>
                                        </c:otherwise>
                                    </c:choose>
                                </c:otherwise>
                            </c:choose>
                        </c:forEach>
                        <c:choose>
                            <c:when test="${-1 == feature.currentPageNum}">
                                <span class="active rnd3">Single Page</span>
                            </c:when>
                            <c:otherwise>
                                <a href="${singlePageContentUrl}">Single Page</a>
                            </c:otherwise>
                        </c:choose>
                    </div>
                </c:if>
                <!-- Pagination -->
            </div>

            <div class="shim-20"><!-- do not collapse --></div>

            <!-- Author bios, Licensor attribution -->
            <c:if test="${(feature.currentPageNum eq -1) or (feature.numPages eq feature.currentPageNum)}">
                <article:authorBios authorBios="${authorBios}"/>
            </c:if>
            <article:disclaimer showDisclaimer="${false}"/>
            <c:if test="${not empty feature.licensorAttribution}">
                <article:licensorAttribution licensorAttribution="${feature.licensorAttribution}"/>
            </c:if>
            <!-- Author bios, Licensor attribution -->
        </div>

        <!-- Related links -->
        <c:if test="${not empty feature.externalLinks}">
            <article:relatedLinksList feature="${feature}"/>
        </c:if>
        <!-- Related links -->
        <c:choose>
            <c:when test="${requestScope.context.fbCommentsEnabled}">
                <!-- FB Comments -->
                <div><article:commentsFB-v1 comments="${comments}" feature="${feature}"/></div>
            </c:when>
            <c:otherwise>
                <!-- Old Comments with Form -->
                <article:commentsWithForm feature="${feature}" contentUrl="${contentUrl}" comments="${comments}"/>
            </c:otherwise>
        </c:choose>
    </div>

    <div class="grid_8">
        <article:rightColumn feature="${feature}" omniturePageName="${omniturePageName}"
                             showCompanionAd="${showCompanionAd}"/>
    </div>
</div>

<mod:tracking pageName="${omniturePageName}"
              hier1="Article,${commaSeparatedPrimaryKategoryNames},Article Title: ${titleForOmniture}"
              events="event7"
              isContentFirstPage="${article.currentPageNum eq 1}"
              isContentPage="${true}"
              contentId="${article.contentKey.identifier}"
        />

<article:hoverBody feature="${feature}"/>

<c:if test="${showPhotoGallery}">
    <article:photoGallery cssClass="js-photo-gallery-trigger" smallImages="${smallPhotos}"
                          largeImages="${largePhotos}"
                          altTexts="${altTexts}" prefix="article" photoCaptions="${photoCaptions}"/>
</c:if>

<div id="fade" class="black_overlay"><!-- do not collapse --></div>
</gsml:body>

</html>
</jsp:root>