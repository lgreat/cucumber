<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:gsweb="gstaglib"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          version="2.0"
          xmlns:link="urn:www.greatschools.net/taglib/link"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions">
<html lang="en">
<jsp:directive.page contentType="text/html"/>

<head>
    <c:choose>
        <c:when test="${not empty requestScope.topicCenter.pageTitle}">
            <c:set var="pageTitle">${requestScope.topicCenter.pageTitle} Discussion Board</c:set>
        </c:when>
        <c:otherwise>
            <c:set var="pageTitle">${requestScope.topicCenter.title} Discussion Board</c:set>
        </c:otherwise>
    </c:choose>
    <title>${pageTitle} | GreatSchools</title>
    <meta name="description" content="${requestScope.discussionBoard.metaDescription}"/>
    <meta name="keywords" content="${requestScope.discussionBoard.metaKeywords}"/>
    <pageHelper:externalCss file="/res/css/widelayout.css"/>
    <pageHelper:externalCss file="/res/css/_textStyles.css"/>
    <pageHelper:externalCss file="/res/css/discussionBoards/db_community.css"/>
    <pageHelper:externalCss file="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/ui-lightness/jquery-ui.css"/>
    <pageHelper:externalJavascript file="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"/>
    <pageHelper:externalJavascript file="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"/>
    <pageHelper:externalJavascript file="/res/js/jquery/plugins/curvycorners/2.0.3/curvycorners.js"/>

    <script type="text/javascript">
        $(function() {
            $("#startADiscussionDialog").dialog({
                autoOpen: false,
                resizable: false,
                modal: true
            });

            $("#dialogCancelButton").click(function() {
                $('#startADiscussionDialog').dialog("close");
            });

            $('#upperStartADiscussion').click(function() {
                //<c:choose><c:when test="${requestScope.validUser != null}">
                    $('#startADiscussionDialog').dialog("open");
                    return false;
                //</c:when><c:otherwise>
                    document.location='${requestScope.loginRedirectUrl}';
                //</c:otherwise></c:choose>
            });
        });
    </script>
</head>
<body>
<div id="container" class="gainlayout">
<div id="mainContent">
    <p class="breadCrumbs smallAlertText">You are here: ${requestScope.discussionBoard.title}</p>

    <div class="module">
        <div class="header">
            <span class="title1white fltlft">Learning Disabilities Community</span>
            <button id="upperStartADiscussion" class="fltrt button2" type="button">Start a discussion</button>
            <br class="clearfloat"/>
        </div>
        <!-- end header -->

        <div id="startADiscussionDialog" style="display:none;">
            <form action="/community/discussionSubmission.page" method="POST">
                <input type="hidden" name="redirect" value="${requestScope.uri}"/>
                <div class="topicSelect">
                    <label for="topicSelect">Topic</label>
                    <select id="topicSelect" name="topicCenterId">
                        <c:forEach var="myTc" items="${requestScope.discussionTopics}">
                            <gsml:selectOption value="${myTc.contentKey.identifier}"
                                               selected="${myTc.contentKey.identifier == requestScope.topicCenter.contentKey.identifier}">${myTc.title}</gsml:selectOption>
                        </c:forEach>
                    </select>
                </div>
                <div class="titleInput">
                    <label for="titleInput">Title</label>
                    <input id="titleInput" type="text" name="title" value="${requestScope.userTitle}"/>
                </div>
                <div class="bodyInput">
                    <label for="bodyInput">Details</label>
                    <textarea id="bodyInput"  class="bodyInput" rows="5" cols="30"
                              name="body"><!-- no collapse -->${requestScope.userBody}</textarea>
                </div>
                <input type="submit" name="submit" value="Start a Discussion"/>
                <input id="dialogCancelButton" type="button" value="Cancel"/>
            </form>
        </div>

        <div class="db_body">
            <c:choose>
                <c:when test="${fn:length(requestScope.discussionList) > 0}">

                    <div class="db_deck gainlayout">
                        <!--<p>Displaying discussion
                            ${(requestScope.page - 1) * requestScope.pageSize + 1} - ${(requestScope.page - 1) * requestScope.pageSize + fn:length(requestScope.discussionList)}
                            of ${requestScope.totalDiscussions} discussion(s)</p>-->

                        <form action="" class="fltlft">
                            <span class="smallAlertText">Show:</span>
                            <select name="posts">
                                <option value="0">no posts</option>
                                <option value="5" selected="selected">5 posts</option>
                                <option value="10">10 posts</option>
                                <option value="15">15 posts</option>
                            </select>
                        </form>

                        <p class="fltrt smallAlertText">Sort by: Oldest First | <a href="#">Newest First</a> | <a
                                href="#">Most Popular</a></p>
                        <br class="clearfloat"/>
                    </div>
                    <!-- end db_deck -->

                    <c:forEach var="discussion" items="${requestScope.discussionList}">
                        <div class="db_discussion sdrt">
                            <div class="db_title gainlayout">
                                <h4 class="fltlft"><link:discussion discussion="${discussion}"><span
                                        class="title1">Discussion: ${discussion.title}</span></link:discussion></h4>

                                <p class="fltrt"><a class="smallText1" href="#">Email</a></p>
                                <br class="clearfloat"/>
                            </div>

                            <div class="db_discuss_topic gainlayout">
                                <div class="fltlft">
                                    <gsml:a href="http://${communityHost}/members/${discussion.user.userProfile.screenName}">
                                        <img class="fltlft"
                                             src="http://${communityHost}/avatar?id=${discussion.user.id}&amp;width=48&amp;height=48"
                                             alt="Avatar" width="48" height="48"
                                             style="border: 1px solid #c6c6c6;"/>
                                    </gsml:a>
                                </div>
                                <!-- end discussion avatar -->

                                <div class="db_discuss fltrt rounded">
                                    <p class="fltlft">
                                        <gsml:a href="http://${communityHost}/members/${discussion.user.userProfile.screenName}">
                                            <span class="smallAlertTextBoldNeutral">${discussion.user.userProfile.screenName}</span>
                                        </gsml:a>

                                        <span class="smallText1"> ${gsweb:detailedPeriodBetweenDates(discussion.dateCreated,requestScope.currentDate)}</span>
                                    </p>

                                    <p class="fltrt"><a class="smallText1" href="#">Report it</a></p>
                                    <br class="clearfloat"/>
                                    <span class="text3">${discussion.body}</span>
                                </div>
                                <!-- end db_discuss -->
                                <br class="clearfloat"/>
                            </div>
                            <!-- end db_discuss_topic -->
                        </div>
                        <!-- end db_discussion -->

                        <br class="clearfloat"/>
                        <c:if test="${fn:length(discussion.replies) > 0}">
                            <div class="db_replies">
                                <p class="Text1">Most recent replies</p>

                                <c:forEach var="reply" items="${discussion.replies}" begin="0" end="1">

                                    <div class="db_reply_topic">
                                        <div class="fltlft">
                                            <gsml:a href="http://${communityHost}/members/${reply.user.userProfile.screenName}">
                                                <img src="http://${communityHost}/avatar?id=${reply.user.id}&amp;width=48&amp;height=48"
                                                     alt="Avatar" width="48" height="48"
                                                     style="border: 1px solid #c6c6c6;"/>
                                            </gsml:a>
                                        </div>
                                        <!-- end reply avatar -->

                                        <div class="db_reply fltrt rounded">
                                            <p class="fltlft">
                                                <gsml:a href="http://${communityHost}/members/${reply.user.userProfile.screenName}">
                                                    <span class="smallAlertTextBoldNeutral">${reply.user.userProfile.screenName}</span>
                                                </gsml:a>

                                                <span class="smallText1"> ${gsweb:detailedPeriodBetweenDates(reply.dateCreated,requestScope.currentDate)}</span>
                                            </p>

                                            <p class="fltrt"><a class="smallText1" href="#">Report it</a></p>
                                            <br class="clearfloat"/>

                                            <span class="text3">${reply.body}</span>
                                        </div>
                                        <!-- end db_reply -->
                                    </div>
                                    <!-- end db_reply_topic -->
                                    <br class="clearfloat"/>
                                </c:forEach>

                                <p class="viewAll"><a class="text3" href="#">View all replies (28) <span
                                        class="alertDoubleArrow">&amp;raquo;</span></a></p>
                            </div>
                            <!-- end db_replies -->
                        </c:if>
                    </c:forEach>
                </c:when>
                <c:otherwise>
                    <p>There are no discussions to display!</p>
                </c:otherwise>
            </c:choose>
            <br class="clearfloat"/>
        </div>
        <!-- end db_body -->


        <div class="db_footer">
            <c:if test="${requestScope.totalPages > 1}">
                <div class="cmsDiscussionPagination">
                    Page
                    <c:forEach begin="1" end="${requestScope.totalPages}" var="pageNum" varStatus="status">
                        <c:choose>
                            <c:when test="${pageNum == requestScope.page}">
                                <span class="active">${pageNum}</span>
                            </c:when>
                            <c:otherwise>
                                <a href="${uri}&amp;page=${pageNum}">${pageNum}</a>
                            </c:otherwise>
                        </c:choose>
                    </c:forEach>
                </div>
            </c:if>
        </div>
        <!-- end db_footer -->
    </div>
    <!-- end module -->
</div>
<!-- end mainContent -->
<div id="sideBar">
    <div class="module">
        <div class="header">
            <span class="title1white">Search Community</span>
        </div>
        <div class="body1bg">
            <form action="">
                <input type="text" name="search"/>
                <input type="submit" value="Search"/>
            </form>
        </div>
        <div class="body3bg sdrt">
            <div class="subhead2">Browse by topic</div>
            <div class="fltlft">
                <ul class="topics text2_180">
                    <li><a href="#">Great Parenting</a></li>
                    <li><a href="#">Academics &amp;amp; Activities</a></li>
                    <li><a href="#">Learning Disabilities</a></li>
                    <li><a href="#">Improve Your School</a></li>
                    <li><a href="#">Prep for College</a></li>
                </ul>
            </div>
            <div class="fltlft">
                <ul class="topics text2_180">
                    <li><a href="#">Finding a School</a></li>
                    <li><a href="#">Preschool</a></li>
                    <li><a href="#">Elementary</a></li>
                    <li><a href="#">Middle School</a></li>
                    <li><a href="#">High School</a></li>
                </ul>
            </div>
            <br class="clearfloat"/>
        </div>
        <div class="body2bg sdrb">
            <form action="">
                <span class="subhead2">Browse by city</span>
                <select name="cities">
                    <option value="#">Select city</option>
                    <option value="SF">San Franciso</option>
                    <option value="OT">Oakland</option>
                    <option value="SJ">San Jose</option>
                </select>
            </form>
        </div>
    </div>
    <!-- end module -->
    <br class="modulespacer"/>

    <div class="module">
        <div class="header">
            <span class="title1white">More in Learning Disabilities</span>
        </div>
        <div class="body3bg">
            <div class="fltlft">
                Most viewed
            </div>
            <div class="fltlft">
                Most viewed
            </div>
            <br class="clearfloat"/>
            <ul class="text3_230">
                <li><a href="#">What you can do to stamp out bullying</a></li>
                <li><a href="#">Why social skills are key to learning</a></li>
                <li><a href="#">My 5-Year-Old's behavior's changing</a></li>
                <li><a href="#">Healthy breakfasts for healthy minds</a></li>
                <li><a href="#">Does your child's school promote earth-friendly practices?</a></li>
                <li><a href="#">Problems in kindergarten: I need advice!</a></li>
                <li><a href="#">What you can do to stamp out bullying</a></li>
                <li><a href="#">Why social skills are key to learning</a></li>
                <li><a href="#">My 5-Year-Old's behavior's changing</a></li>
                <li><a href="#">Coping with homework horrors</a></li>
            </ul>
        </div>
    </div>
    <!-- end module -->
</div>
<!-- end sideBar -->
</div>
<!-- end container -->
</body>
</html>
</jsp:root>