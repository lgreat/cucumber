<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:gsweb="gstaglib"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:link="urn:www.greatschools.net/taglib/link"
          xmlns:variant="urn:jsptagdir:/WEB-INF/tags/variant"
          version="2.0" >
<jsp:directive.page import="gs.data.content.Article"/>
<jsp:directive.page import="gs.web.util.PageHelper"/>
<html lang="en">
    <jsp:directive.page contentType="text/html"/>
    <c:set var="pageName" value="article" scope="request"/>
    <head>
        <title>${requestScope.articleTitle} - GreatSchools.net</title>
        <pageHelper:setPathway pathway="LIBRARY"/>
        <pageHelper:externalCss file="/res/css/content/article.css"/>
        <c:choose>
            <c:when test="${requestScope.newArticle eq true}">
                <pageHelper:externalCss file="/res/css/content/articleNew.css"/>
                <c:set var="articleStyle" value="new" scope="request"/>
            </c:when>
            <c:otherwise>
                <pageHelper:externalCss file="/res/css/content/articleOld.css"/>
                <c:set var="articleStyle" value="old" scope="request"/>
            </c:otherwise>
        </c:choose>

        <c:if test="${not empty requestScope.articleMetaDescriptor}">
            <meta name="description" content="${requestScope.articleMetaDescriptor}" />
        </c:if>
        <c:if test="${not empty requestScope.articleMetaKeywords}">
            <meta name="keywords" content="${requestScope.articleMetaKeywords}" />
        </c:if>
        <jsp:scriptlet>
            PageHelper pageHelper = (PageHelper) request.getAttribute(PageHelper.REQUEST_ATTRIBUTE_NAME);
            if (pageHelper != null) {
                Article article = (Article) request.getAttribute("article");
                if (article != null) {
                    pageHelper.addAdKeyword("article_id", article.getId().toString());
                }
            }
        </jsp:scriptlet>
        <ad:setSlotPrefix slotPrefix="Library_Article_Page"/>
    </head>
    <body>

    <table cellspacing="0" cellpadding="0" border="0">
        <tbody>
            <tr>
                <td class="articlecopy">
                    <!-- Tools -->
                    <div id="articletools" class="noprint">
                        <div id="toolsmenu">
                            <strong>Article Tools</strong>
                            <hr size="1" noshade="noshade"/>
                            <div class="simplemenu">
                                <gsml:img src="/images/editorial/printgrey.gif" alt="Print this article"/>
                                <a href="javascript:window.print();">Print This Article</a>
                            </div>
                            <div class="simplemenu">
                                <gsml:img src="/images/editorial/emailgrey.gif" alt="Email this article"/>
                                <gsml:url var="mailToFriendUrl" value="/community/mailToFriend.page?articleId=${requestScope.article.id}&amp;refer=article"/>
                                <gsml:a href="${mailToFriendUrl}"
                                            onClick="window.open('${mailToFriendUrl}', 'win', 'width=600,height=550,scrollbars=yes'); return false;">Email This Article</gsml:a>
                            </div>
                            <div class="simplemenu">
                                <gsml:img src="/images/editorial/signupgrey.gif" alt="Sign-up for newsletters"/>
                                <link:newsletterCenter>Sign-up For Newsletters</link:newsletterCenter>
                            </div>
                            <br/>
                            <div class="simplemenu">
                                <link:articleLibrary>See full library of articles</link:articleLibrary>
                            </div>
                        </div>
                        <div id="squareadvert">
                            <ad:AboveFold_300x250/>
                        </div>
                        <div id="seasonalPromo">
                            <gsweb:adTagGenerator position="House_Ad_300x137"/>
                        </div>
                    </div>
                    <!-- Article -->
                    <c:choose>
                        <c:when test="${not empty requestScope.article}">
                            <div id="article">
                                <div class="article-title">${requestScope.articleTitle}</div>
                                <div class="abstract">${requestScope.articleAbstract}</div>
                                <div class="byline">By ${requestScope.article.author}</div>
                                <div id="articleText">${requestScope.articleText}</div>
                            </div>
                        </c:when>
                        <c:otherwise>
                            <h2 class="noarticle">Article not found</h2>
                        </c:otherwise>
                    </c:choose>

                    <div id="articleComments" class="noprint">
                        <div id="enterComment">
                            <script type="text/javascript">
                                function wrapCommentWithDelimiter(comment) {
                                    return "BEGIN_ARTICLE_COMMENT\n" +
                                           comment +
                                           "\nEND_ARTICLE_COMMENT\n";
                                }
                            </script>
                            <form action="/cgi-bin/feedback_submit" method="post"
                                  onsubmit="captchaChallenge.value = Recaptcha.$('recaptcha_challenge_field').value;captchaResponse.value = Recaptcha.$('recaptcha_response_field').value;description.value = wrapCommentWithDelimiter(comment.value);">
                                <input type="hidden" name="state" value="${requestScope.context.stateOrDefault}" />
                                <input type="hidden" name="type" value="article" />
                                <input type="hidden" name="id" value="${requestScope.article.id}" />
                                <input type="hidden" name="captchaChallenge" value="the Challenge"/>
                                <input type="hidden" name="captchaResponse" value="the Response"/>
                                <input type="hidden" name="description" value=""/>

                                <div class="greenHeader" id="commentHeader">
                                    <span class="rlbcopy">Email us your feedback</span>
                                </div>
                                <![CDATA[<textarea name="comment" cols="30" rows="10"></textarea>]]>
                                <div id="nameEmail">
                                    Name (optional): &amp;nbsp;&amp;nbsp;<input name="name" class="text" size="25" type="text"/>
                                    <br /><br />
                                    Email (optional): &amp;nbsp;&amp;nbsp;&amp;nbsp;<input name="email" class="text" size="25" type="text"/>
                                    <br /><br />
                                    <div class="captcha">
                                        <script type="text/javascript">
                                            var RecaptchaOptions = {theme:'white', tabindex: 0};
                                        </script>
                                        <script type="text/javascript"
                                           src="http://api.recaptcha.net/challenge?k=6LfZWAEAAAAAAPfIO2ES9Xr027O-Et-fMcSHkZeR">
                                           /* this comment keeps the tag from collapsing */
                                        </script>

                                        <![CDATA[
                                        <noscript>
                                           <iframe src="http://api.recaptcha.net/noscript?k=6LfZWAEAAAAAAPfIO2ES9Xr027O-Et-fMcSHkZeR"
                                               height="300" width="500" frameborder="0"></iframe><br/>
                                           <textarea name="recaptcha_challenge_field"
                                                     rows="3" cols="40" style="height: 60px;">
                                           </textarea>
                                           <input type="hidden" name="recaptcha_response_field"
                                               value="manual_challenge"/>
                                        </noscript>
                                        ]]>
                                    </div>
                                    <input value="submit" type="submit"/>
                                </div>
                                <div id="terms">
                                    <input name="permit" type="checkbox" checked="checked"/>
                                    <span class="ncopy permission">
                                        Yes, I agree to the <link:termsOfUse>GreatSchools Terms of Use</link:termsOfUse> and give GreatSchools
                                        permission to post my comments for other parents to read.
                                    </span>
                                    <span class="note">
                                        <span class="rlbcopy">Note: </span>Your email address is
                                        required if you would like a response from GreatSchools.net.
                                    </span><br />
                                </div>
                            </form>
                        </div>

                        <c:if test="${requestScope.article.userComments ne null and fn:length(requestScope.article.userComments) gt 0}">
                            <hr width="100%" class="commentDivider"/>
                            <div class="orangeBold greenHeader"><span>Comments From GreatSchools.net Users</span></div>
                            <div id="comments">
                                <c:forEach var="comment" items="${requestScope.article.userComments}">
                                    <div class="comment">
                                        <span class="r2ibcopy comment-date"><fmt:formatDate value="${comment.posted}" pattern="MM/d/yyyy"/>:</span>
                                        <div class="comment-text">"${comment.text}"</div>
                                    </div>
                                    <c:if test="${requestScope.newArticle eq false}">
                                        <center><hr width="90%" class="commentDivider"/></center>
                                    </c:if>
                                </c:forEach>
                            </div>
                        </c:if>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <c:if test="${articleStyle eq 'new'}">
        <script type="text/javascript" >  <![CDATA[   <!--
            /* used for both a and b variants */

            function getMoreOnContent(){
                 var moreOnElementNode = document.getElementById("more-about");
    
                 if (moreOnElementNode != null ){
                     var nodes = moreOnElementNode.getElementsByTagName("div") ;

                     if (nodes != null && nodes.length > 0){
                         /* assuming the more-about is first,  exclude the related links div */
                         return nodes[0];
                     } else {
                         /* assuming there is only a more-about section and no related links... */
                         return moreOnElementNode;
                     }
                 } else {
                    /* couldn't find the more-about div so, return null */
                    return null;
                 }
            }
            /* execute after the tracking tag... */
            function setOmnitureTagging(node, variant){
                if (node != null ){
                    var aNodes = node.getElementsByTagName("a") ;
                    for(var i = 0; i < aNodes.length; i++) {
                        aNodes[i].setAttribute("id", "moreon" + variant + "__" + i);
                        /* register handler directly for because of ie issues */
                        res = registerEventHandler(aNodes[i],"click", evar5ClickEventHandler);
                    }
                    /* alert("setOmnitureTagging " + node.innerHTML); */
                }
            }
            /* execute berore resetting the id and class of the more-about div */
            function hideDottedDivider(node){
                /* only hide the divider when there is nothing left under it */
                if (node.getAttribute("id") != "more-about"){
                    return;
                }
                var nodes = document.getElementsByClassName("dotted-divider") ;
                if (nodes != null && nodes.length == 1) {
                    nodes[0].parentNode.removeChild(nodes[0]);
                }
            }

         --> ]]>
        </script>
    </c:if>

    <mod:tracking pageName="${pageName}"
                hier1="Article,ArticleTitle: ${requestScope.articleHier1}"
                events="event7"
                articleStyle="${articleStyle}" />

    <c:if test="${articleStyle eq 'new'}">
        <script type="text/javascript" >
            <![CDATA[
            <!--
                /* Omniture Tagging */
                setOmnitureTagging(getMoreOnContent(),"A");
             -->
            ]]>
        </script>
    </c:if>

    </body>
    </html>
</jsp:root>