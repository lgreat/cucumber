<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:content="urn:jsptagdir:/WEB-INF/tags/content"
          xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:gsweb="gstaglib"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          xmlns:variant="urn:jsptagdir:/WEB-INF/tags/variant"
          version="2.0" >
<jsp:directive.page import="gs.data.content.Article"/>
<jsp:directive.page import="gs.web.util.PageHelper"/>
<html lang="en">
    <jsp:directive.page contentType="text/html"/>
    <c:set var="pageName" value="article" scope="request"/>
    <head>
        <title>${requestScope.articleTitle} - GreatSchools.org</title>
        <pageHelper:setPathway pathway="LIBRARY"/>
        <pageHelper:externalCss file="/res/css/content/article.css"/>
        <c:choose>
            <c:when test="${requestScope.newArticle eq true}">
                <pageHelper:externalCss file="/res/css/content/articleNew.css"/>
                <pageHelper:externalCss file="/res/css/content/articlePrint.css"/>
                <pageHelper:externalCss file="/res/css/content/landingPageShared.css" />
                <pageHelper:externalCss file="/res/css/content/library.css" />
                <c:set var="articleStyle" value="new" scope="request"/>

                <![CDATA[
                <!--[if IE]>
                    <link rel="stylesheet" type="text/css" href="/res/css/content/librarySidebar_ie.css" />
                <![endif]-->
                ]]>
            </c:when>
            <c:otherwise>
                <pageHelper:externalCss file="/res/css/content/articleOld.css"/>
                <c:set var="articleStyle" value="old" scope="request"/>
            </c:otherwise>
        </c:choose>

        <c:if test="${not empty requestScope.articleMetaDescriptor}">
            <meta name="description" content="${requestScope.articleMetaDescriptor}" />
        </c:if>
        <c:if test="${not empty requestScope.articleMetaKeywords}">
            <meta name="keywords" content="${requestScope.articleMetaKeywords}" />
        </c:if>
        <jsp:scriptlet>
            PageHelper pageHelper = (PageHelper) request.getAttribute(PageHelper.REQUEST_ATTRIBUTE_NAME);
            if (pageHelper != null) {
                Article article = (Article) request.getAttribute("article");
                if (article != null) {
                    pageHelper.addAdKeyword("article_id", article.getId().toString());
                }
            }
        </jsp:scriptlet>
        <ad:setSlotPrefix slotPrefix="Library_Article_Page"/>
    </head>
    <gsml:body adPageName="articlePage" pageLayout="nocol">

    <table cellspacing="0" cellpadding="0" border="0">
    <tbody>
    <tr>
        <c:if test="${articleStyle eq 'new'}">
            <td id="leftCol">
                <div id="foo" class="cleared">
                    <content:librarySidebar cssClass="white hideFromPrint" />
                </div>
            </td>
        </c:if>
                <td class="articlecopy">
                    <!-- Tools -->
                    <div id="articletools" class="noprint">
                        <div id="toolsmenu">
                            <strong>Article Tools</strong>
                            <hr size="1" noshade="noshade"/>
                            <div class="simplemenu">
                                <gsml:img src="/images/editorial/printgrey.gif" alt="Print this article"/>
                                <a href="javascript:window.print();">Print This Article</a>
                            </div>
                            <div class="simplemenu">
                                <gsml:img src="/images/editorial/emailgrey.gif" alt="Email this article"/>
                                <gsml:url var="mailToFriendUrl" value="/community/mailToFriend.page?articleId=${requestScope.article.id}&amp;refer=article"/>
                                <gsml:a href="${mailToFriendUrl}"
                                            onClick="window.open('${mailToFriendUrl}', 'win', 'width=600,height=550,scrollbars=yes'); return false;">Email This Article</gsml:a>
                            </div>
                            <div class="simplemenu">
                                <gsml:img src="/images/editorial/signupgrey.gif" alt="Sign-up for newsletters"/>
                                <link:newsletterManagement styleClass="GS_EV5_" styleId="NL_sub_article_tools">Sign-up For Newsletters</link:newsletterManagement>
                            </div>
                            <br/>
                            <div class="simplemenu">
                                <link:articleLibrary>See full library of articles</link:articleLibrary>
                            </div>
                        </div>
                        <div id="squareadvert">
                            <ad:AboveFold_300x250/>
                        </div>
                        <div id="seasonalPromo">
                            <c:choose>
                                <c:when test="${requestScope.context.cobranded}">
                                    <link:schoolChoiceCenter styleClass="more"><gsml:img src="/res/img/content/schoolChoiceTips/schoolChoiceTips_300x137.jpg" alt="School Choice Tips"/></link:schoolChoiceCenter>       
                                </c:when>
                                <c:otherwise>
                                    <gsweb:adTagGenerator position="House_Ad_300x137"/>
                                </c:otherwise>
                            </c:choose>
                        </div>
                    </div>
                    <!-- Article -->
                    <c:choose>
                        <c:when test="${not empty requestScope.article}">
                            <div id="article">
                                <div class="article-title">${requestScope.articleTitle}</div>
                                <div class="abstract">${requestScope.articleAbstract}</div>
                                <div class="byline">By ${requestScope.article.author}</div>
                                <div id="articleText">${requestScope.articleText}</div>
                            </div>
                        </c:when>
                        <c:otherwise>
                            <h2 class="noarticle">Article not found</h2>
                        </c:otherwise>
                    </c:choose>

                    <c:if test="${false}"> <!-- related community content -->
                    <c:if test="${articleStyle eq 'new'}">
                        <div id="dynamicMoveFrom">
                            <div id="articlesLabel">
                                <h2>Articles</h2>
                            </div>

                            <div id="moreOnParagraph" class="paragraph moreOnParagraph" >
                                <!-- collapse free comment -->
                            </div>
                            <div id="normalParagraph" class="paragraph" >
                                <!-- collapse free comment -->
                            </div>

                            <div id="relatedParentPosts">
                                    <jsp:include page="/community/relatedPostsArticle.module">
                                        <jsp:param name="category" value="${not empty requestScope.communityDiscussionCategoryId ? requestScope.communityDiscussionCategoryId: 16 }"/>
                                    </jsp:include>
                            </div>
                        </div>
                    </c:if>
                    </c:if>
                    <div id="articleComments" class="noprint">
                        <div id="enterComment">
                            <script type="text/javascript">
                                function wrapCommentWithDelimiter(comment) {
                                    return "BEGIN_ARTICLE_COMMENT\n" +
                                           comment +
                                           "\nEND_ARTICLE_COMMENT\n";
                                }
                            </script>
                            <form action="/cgi-bin/feedback_submit" method="post"
                                  onsubmit="captchaChallenge.value = Recaptcha.$('recaptcha_challenge_field').value;captchaResponse.value = Recaptcha.$('recaptcha_response_field').value;description.value = wrapCommentWithDelimiter(comment.value);">
                                <input type="hidden" name="state" value="${requestScope.context.stateOrDefault}" />
                                <input type="hidden" name="type" value="article" />
                                <input type="hidden" name="id" value="${requestScope.article.id}" />
                                <input type="hidden" name="captchaChallenge" value="the Challenge"/>
                                <input type="hidden" name="captchaResponse" value="the Response"/>
                                <input type="hidden" name="description" value=""/>

                                <div class="greenHeader" id="commentHeader">
                                    <span class="rlbcopy">Email us your feedback</span>
                                </div>
                                <![CDATA[<textarea name="comment" cols="30" rows="10"></textarea>]]>
                                <div id="nameEmail">
                                    Name (optional): &amp;nbsp;&amp;nbsp;<input name="name" class="text" size="25" type="text"/>
                                    <br /><br />
                                    Email (optional): &amp;nbsp;&amp;nbsp;&amp;nbsp;<input name="email" class="text" size="25" type="text"/>
                                    <br /><br />
                                    <div class="captcha">
                                        <script type="text/javascript">
                                            var RecaptchaOptions = {theme:'white', tabindex: 0};
                                        </script>
                                        <script type="text/javascript"
                                           src="http://api.recaptcha.net/challenge?k=6LdG4wkAAAAAAHVSQPDpiPPjz4w5PB28eZj8yhlL">
                                           /* this comment keeps the tag from collapsing */
                                        </script>

                                        <![CDATA[
                                        <noscript>
                                           <iframe src="http://api.recaptcha.net/noscript?k=6LdG4wkAAAAAAHVSQPDpiPPjz4w5PB28eZj8yhlL"
                                               height="300" width="500" frameborder="0"></iframe><br/>
                                           <textarea name="recaptcha_challenge_field"
                                                     rows="3" cols="40" style="height: 60px;">
                                           </textarea>
                                           <input type="hidden" name="recaptcha_response_field"
                                               value="manual_challenge"/>
                                        </noscript>
                                        ]]>
                                    </div>
                                    <input value="submit" type="submit"/>
                                </div>
                                <div id="terms">
                                    <input name="permit" type="checkbox" checked="checked"/>
                                    <span class="ncopy permission">
                                        Yes, I agree to the <link:termsOfUse>GreatSchools Terms of Use</link:termsOfUse> and give GreatSchools
                                        permission to post my comments for other parents to read.
                                    </span>
                                    <span class="note">
                                        <span class="rlbcopy">Note: </span>Your email address is
                                        required if you would like a response from GreatSchools.org.
                                    </span><br />
                                </div>
                            </form>
                        </div>

                        <c:if test="${requestScope.article.userComments ne null and fn:length(requestScope.article.userComments) gt 0}">
                            <hr width="100%" class="commentDivider"/>
                            <div class="orangeBold greenHeader"><span>Comments From GreatSchools.org Users</span></div>
                            <div id="comments">
                                <c:forEach var="comment" items="${requestScope.article.userComments}">
                                    <div class="comment">
                                        <span class="r2ibcopy comment-date"><fmt:formatDate value="${comment.posted}" pattern="MM/d/yyyy"/>:</span>
                                        <div class="comment-text">"${comment.text}"</div>
                                    </div>
                                    <c:if test="${requestScope.newArticle eq false}">
                                        <center><hr width="90%" class="commentDivider"/></center>
                                    </c:if>
                                </c:forEach>
                            </div>
                        </c:if>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <c:if test="${articleStyle eq 'new'}">
        <script type="text/javascript" >  <![CDATA[   <!--
            /* used for both a and b variants */

            function getMoreOnContent(){
                 var moreOnElementNode = document.getElementById("more-about");
    
                 if (moreOnElementNode != null ){
                     var nodes = moreOnElementNode.getElementsByTagName("div") ;

                     if (nodes != null && nodes.length > 0){
                         /* assuming the more-about is first,  exclude the related links div */
                         return nodes[0];
                     } else {
                         /* assuming there is only a more-about section and no related links... */
                         return moreOnElementNode;
                     }
                 } else {
                    /* couldn't find the more-about div so, return null */
                    return null;
                 }
            }
            /* execute after the tracking tag... */
            function setOmnitureTagging(node, variant){
                if (node != null ){
                    var aNodes = node.getElementsByTagName("a") ;
                    for(var i = 0; i < aNodes.length; i++) {
                        aNodes[i].setAttribute("id", "moreon" + variant + "__" + i);
                        /* register handler directly for because of ie issues */
                        res = registerEventHandler(aNodes[i],"click", evar5ClickEventHandler);
                    }
                }
            }
            /* execute berore resetting the id and class of the more-about div */
            function hideDottedDivider(node){
                /* only hide the divider when there is nothing left under it */
                if (node.getAttribute("id") != "more-about"){
                    return;
                }
                var nodes = document.getElementsByClassName("dotted-divider") ;
                if (nodes != null && nodes.length == 1) {
                    nodes[0].parentNode.removeChild(nodes[0]);
                }
            }

         --> ]]>
        </script>
    </c:if>

    <mod:tracking pageName="${pageName}"
                hier1="Article,ArticleTitle: ${requestScope.articleHier1}"
                events="event7"
                articleStyle="${articleStyle}"
                articleId = "${requestScope.article.id}" />

    <c:if test="${articleStyle eq 'new'}">
        <script type="text/javascript" >
            <![CDATA[
            <!--
                /* Omniture Tagging */
                setOmnitureTagging(getMoreOnContent(),"A");
             -->
            ]]>
        </script>

        <script type="text/javascript" >
            <![CDATA[
            <!--
                /* newsletter sign up */
                var oNewsletter = {
                    addNewsletterSubscribeLink : function(){
                        this.insertElement();
                    },
                    findElementToInsertBefore : function(){
                        /* insert before the first instance of div class="dotted-divider" */
                        var nodes = document.getElementsByClassName("dotted-divider") ;
                        if (nodes != null && nodes.length > 0){
                            return nodes[0];
                        } else {
                            return null;
                        }
                    },
                    createLinkParagraphNode : function(){
                        var paragraphNode = document.createElement('div');
                        paragraphNode.className = 'paragraph';

                        var nodes = document.getElementsByClassName("articleCopyright") ;
                        if (nodes != null && nodes.length > 0){
                            var breakNode = document.createElement('br');
                            paragraphNode.appendChild(breakNode);
                        }

                        var textNode = document.createTextNode('Get more great tips to keep your child on track! ');
                        paragraphNode.appendChild(textNode);

                        var linkNode = document.createElement('a');

                        linkNode.href = '/community/newsletters/popup/newsletter.page?referrer=articlePage';
                        linkNode.onclick = oNewsletter.showNewsletterSubscriptionPopup ;
                        linkNode.className = "submodal-480-550";
                        linkNode.id = "NL_sub_end_of_article";
                        var linkText = document.createTextNode('Sign up for our newsletters >');
                        linkNode.appendChild(linkText);

                        paragraphNode.appendChild(linkNode);
                        var res = registerEventHandler(linkNode,"click", evar5ClickEventHandler)

                        return paragraphNode;
                    },
                    insertElement : function(){
                        var insertBeforeThisNode = this.findElementToInsertBefore();
                        if (insertBeforeThisNode != null) {
                            var newLinkParagraphNode = this.createLinkParagraphNode() ;
                            insertBeforeThisNode.parentNode.insertBefore(newLinkParagraphNode, insertBeforeThisNode);
                        }
                    },
                    showNewsletterSubscriptionPopup : function(){
                        var popup = window.open(this.href,'Popup','toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no, width=480,height=550,left=50,top=50');
                        popup.focus();
                        return false;
                    }
                };

                oNewsletter.addNewsletterSubscribeLink();
             -->
            ]]>
        </script>
        <c:if test="${false}">  <!-- related community content -->
        <script type="text/javascript" >
            <![CDATA[
            <!--

            var oMoreOn = {
                displayRelatedTopics : function (){
                    var moreOnElementNode = document.getElementById("more-about");
                    if (moreOnElementNode == null) return;

                    var headlineNode = this.getHeadlineNode(moreOnElementNode);
                    if (headlineNode == null) return;

                    var relatedParentPostsNode = document.getElementById("relatedParentPosts");
                    if (relatedParentPostsNode == null) return;


                    if ( relatedParentPostsNode.children.length < 1 ) {
                       return;
                    }

                    var articlesLabelNode = document.getElementById("articlesLabel");
                    if (articlesLabelNode == null) return;

                    if (moreOnElementNode.getElementsByClassName == undefined){
                        moreOnElementNode.getElementsByClassName = function(cl){
                            var retnode = [];
                            var myclass = new RegExp('\\b'+cl+'\\b');
                            var elem = this.getElementsByTagName('*');
                            for (var i = 0; i < elem.length; i++) {
                                var classes = elem[i].className;
                                if (myclass.test(classes)) retnode.push(elem[i]);
                            }
                            return retnode;
                        }
                    }
                    var nodes = moreOnElementNode.getElementsByClassName("paragraph") ;

                    if (nodes != null && nodes.length > 0 ){
                        var moreOnParagraphNode = nodes[0];
                        moreOnParagraphNode.className = "paragraph moreOnParagraph" ;

                        if (nodes.length > 1){
                            moreOnElementNode.insertBefore(relatedParentPostsNode, nodes[1]);
                        } else {
                            moreOnElementNode.appendChild(relatedParentPostsNode);
                        }
                        if (moreOnParagraphNode.getElementsByClassName == undefined){
                            moreOnParagraphNode.getElementsByClassName = function(cl){
                                var retnode = [];
                                var myclass = new RegExp('\\b'+cl+'\\b');
                                var elem = this.getElementsByTagName('*');
                                for (var i = 0; i < elem.length; i++) {
                                    var classes = elem[i].className;
                                    if (myclass.test(classes)) retnode.push(elem[i]);
                                }
                                return retnode;
                            }
                        }
                        var headlineNodes = moreOnParagraphNode.getElementsByClassName("headline");
                        if (headlineNodes != null)  {
                            headlineNodes[0].appendChild(articlesLabelNode) ;
                        }
                    } else {
                        this.rebuildNonDivedMoreAbout(moreOnElementNode);
                    }
                },
                rebuildNonDivedMoreAbout : function(moreAboutElementNode){

                    var headlineNode = this.getHeadlineNode(moreAboutElementNode);
                    if (headlineNode == null) return;

                    var moreOnParagraph = document.getElementById("moreOnParagraph");
                    if (moreOnParagraph == null) return;

                    var normalParagraph = document.getElementById("normalParagraph");
                    if (normalParagraph == null) return;

                    var relatedParentPostsNode = document.getElementById("relatedParentPosts");
                    if (relatedParentPostsNode == null) return;

                    var articlesLabelNode = document.getElementById("articlesLabel");
                    if (articlesLabelNode == null) return;

                    headlineNode.appendChild(articlesLabelNode) ;
                    var children = moreAboutElementNode.childNodes;
                    
                    while (moreAboutElementNode.childNodes.length > 0){
                        moreOnParagraph.appendChild(moreAboutElementNode.childNodes[0]) ;
                    }
                    moreAboutElementNode.appendChild(moreOnParagraph );
                    moreAboutElementNode.appendChild(relatedParentPostsNode );

                    if ( relatedParentPostsNode.children.length < 1 ) {
                        moreOnParagraph.className = "paragraph";
                        articlesLabelNode.style.display = "none";
                        relatedParentPostsNode.parentNode.removeChild(relatedParentPostsNode);
                    }
                },
                getHeadlineNode : function(moreAboutElementNode){
                    if (moreAboutElementNode.getElementsByClassName == undefined){
                        moreAboutElementNode.getElementsByClassName = function(cl){
                            var retnode = [];
                            var myclass = new RegExp('\\b'+cl+'\\b');
                            var elem = this.getElementsByTagName('*');
                            for (var i = 0; i < elem.length; i++) {
                                var classes = elem[i].className;
                                if (myclass.test(classes)) retnode.push(elem[i]);
                            }
                            return retnode;
                        }
                    }
                    var nodes = moreAboutElementNode.getElementsByClassName("headline") ;
                    if (nodes != null && nodes.length > 0){
                        return nodes[0];
                    } else {
                        return null;
                    }
                }
            } ;

            oMoreOn.displayRelatedTopics();

         --> ]]>
        </script>


        </c:if>
    </c:if>

    <script type="text/javascript">
        <![CDATA[  <!--
            /*
               GS-6858 dynamically make a table that is adjacent to content directly to its
               right fit by aligning it to the left and making it narrower
            */
            var rightColLen = document.getElementById('articletools').offsetHeight;
            var editorialTableList = document.getElementsByClassName('editorialTable');
            /*    alert( "rightColLen: " + rightColLen );*/
            for (var t = 0; t < editorialTableList.length; t++){
                /*   alert("tableTop: " + editorialTableList[t].offsetTop);*/
                var oldTableTop = editorialTableList[t].offsetTop;
                var oldWidth =  editorialTableList[t].style.width ;
                var oldMarginLeft = editorialTableList[t].style.marginLeft;
                var oldMarginRight = editorialTableList[t].style.marginRight;

                if (editorialTableList[t].offsetTop < rightColLen + 100)  {
                    /*   alert("moving table");*/
                    editorialTableList[t].style.width    = "389px"  ;
                    editorialTableList[t].style.marginLeft = "0";
                    editorialTableList[t].style.marginRight = "0";

                     /* If it the table top hasn't moved, revert back to the original version */
                    if (editorialTableList[t].offsetTop >  rightColLen)  {
                        /*  alert("reverting table"); */
                        editorialTableList[t].style.width    = oldWidth  ;
                        editorialTableList[t].style.marginLeft = oldMarginLeft;
                        editorialTableList[t].style.marginRight = oldMarginRight;
                    }
                }
            }
        -->]]>
    </script>

    </gsml:body>
    </html>
</jsp:root>