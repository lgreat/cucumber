<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" xmlns="http://www.w3.org/1999/xhtml" version="2.0"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
        >
    <jsp:directive.page import="org.apache.commons.lang.StringUtils"/>
    <jsp:directive.page import="java.net.URLDecoder"/>
    <jsp:scriptlet>
        // Create a domain cookie that the user has seen the ad
        Cookie interstitialCookie = new Cookie("gs_interstitial", "viewed");
        interstitialCookie.setMaxAge(86400); // expires in one day
        interstitialCookie.setPath("/");
        interstitialCookie.setDomain("greatschools.org");
        response.addCookie(interstitialCookie);

        String uri = request.getParameter("passThroughURI");
        if (StringUtils.isNotEmpty(uri)) {
            String uriDecoded = URLDecoder.decode(uri, "UTF-8");
            request.setAttribute("passThroughURI", uriDecoded);
        }

        gs.web.util.PageHelper.hideLeaderboard(request);
        gs.web.util.PageHelper.hideHeader(request);
        gs.web.util.PageHelper.hideFooterAd(request);
        gs.web.util.PageHelper.hideFooter(request);
        gs.web.util.PageHelper.setPageName(request, "interstitial");
    </jsp:scriptlet>
    <html lang="en">
    <jsp:output doctype-root-element="html"
                doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
                doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>
    <jsp:directive.page contentType="text/html"/>
    <head>
        <title>Interstitial Ad</title>
        <meta http-equiv="refresh" content="20;url=${passThroughURI}"/>
        <pageHelper:externalCss file="/res/css/brand.css"/>
        <pageHelper:externalCss file="/res/css/ads/interstitial.css"/>
        <script type="text/javascript">
            function continueToDestination() {
                location.replace('${passThroughURI}');
            }

            function setContinueTimeout() {
                setTimeout("continueToDestination()", 15000);
            }
        </script>
        <pageHelper:addOnLoadHandler handler="setContinueTimeout()"/>
    </head>
    <gsml:body adPageName="interstitial" pageLayout="interstitial">
    <gsml:a href="/">
        <gsml:img src="/res/img/logo/logo_GS_330x110.gif"
                  alt="GreatSchools: Involved Parents. Successful Kids" id="logo"/>
    </gsml:a>
    <div id="thanks">
        GreatSchools thanks the foundations and advertisers that make<br/>
        it possible to provide our site free to millions of parents.
    </div>
    <div id="skip" class="bigger bold">
        <a href="${passThroughURI}" onclick="continueToDestination(); return false;">To skip this ad, click here</a>
        <a href="${passThroughURI}" onclick="continueToDestination(); return false;">
            <gsml:img src="/res/img/ad/two_pink_arrows_right.gif" alt="To skip this ad, click here"
                      id="arrows"/>
        </a>
    </div>
    <div id="background">
        <!-- Unfortunately, can't center a div unless it has its width set, and ads will be variable width -->
        <table id="frame" align="center">
            <tr>
                <td id="shortly">
                    <div id="message">You will see the page you requested shortly</div>
                </td>
            </tr>
            <tr>
                <td id="interstitial">
                    <c:choose>
                        <c:when test="${(not empty param.adslot) and (param.adslot eq 'city')}">
                            <c:set var="pos" value="Interstitial_City"/>
                        </c:when>
                        <c:when test="${(not empty param.adslot) and (param.adslot eq 'rc')}">
                            <c:set var="pos" value="Interstitial_RC"/>
                        </c:when>
                        <c:when test="${(not empty param.adslot) and (param.adslot eq 'search')}">
                            <c:set var="pos" value="Interstitial_Search"/>
                        </c:when>
                        <c:when test="${(not empty param.adslot) and (param.adslot eq 'school')}">
                            <c:set var="pos" value="Interstitial_School"/>
                        </c:when>
                        <c:when test="${(not empty param.adslot) and (param.adslot eq 'ContentSearch')}">
                            <c:set var="pos" value="Interstitial_ContentSearch"/>
                        </c:when>
                        <c:otherwise>
                            <c:set var="pos" value="Interstitial"/>
                        </c:otherwise>
                    </c:choose>
                    <ad:interstitial position="${pos}"/>
                </td>
            </tr>
        </table>
    </div>
    <!-- GS-12447 Move along if no ad served for interstitial -->
    <script type="text/javascript">
        if (jQuery('#google_ads_div_${pos}_ad_container').length === 0) {
            continueToDestination();
        }
    </script>
    <mod:tracking pageName="Interstitial Ad"
                  hier1="Advertising,Interstitial Ad"/>
    </gsml:body>
    </html>
</jsp:root>