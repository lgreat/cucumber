<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:spring="http://www.springframework.org/tags"
          xmlns:form="http://www.springframework.org/tags/form"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:survey="urn:jsptagdir:/WEB-INF/tags/survey"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:gsweb="gstaglib"
          xmlns:school="urn:jsptagdir:/WEB-INF/tags/school"
          xmlns:link="urn:www.greatschools.net/taglib/link"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns="http://www.w3.org/1999/xhtml" version="2.0">
<jsp:output doctype-root-element="html"
            doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
            doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>
<jsp:directive.page contentType="text/html"/>


<c:set var="school" value="${userResponseCommand.school}"/>

<html>
<head>
    <title>Complete a Parent Survey for ${school.name} in ${school.city}, ${school.databaseState}</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <meta name="Description" content="Submit a Parent Survey about ${school.name} in ${school.city}, ${school.databaseState}"/>
</head>
<body>
<pageHelper:externalCss file="/res/css/survey/survey.css"/>
<school:profile school="${school}" tab="surveys">
<div id="left-col">
	<div id="intro">
		<gsml:img src="/res/img/survey/flower.gif" alt="flower" id="intro-pic" />

		<div id="intro-blurb">
			<div class="intro-heading1">${school.name} parent survey</div>
        </div>

        <div id="toc">
            <ul id="page-links">
                <c:forEach var="page" items="${userResponseCommand.survey.pages}">
                    <c:set var="cls" value="${page.index eq requestScope.currentPage ? 'active' : 'inactive'}" />
                    <li class="${cls}">
                        <span>
                            ${page.title}
                        </span>
                    </li>
                </c:forEach>
            </ul>
        </div>
    </div>

<form:form commandName="userResponseCommand">

<div id="page-title">
    ${userResponseCommand.page.title}
</div>

<c:forEach var="questionGroup" items="${userResponseCommand.page.questionGroups}">
    <div class="question-group">
    <h2 class="question-group-heading"><c:out value="${questionGroup.title}" escapeXml="true"/></h2>
    <c:forEach var="question" items="${questionGroup.questions}" varStatus="questionCount">
        <div class="question">
            <div class="question-text"><span class="number">${questionCount.index + 1}.</span>${question.text}</div>
            <c:forEach var="answer" items="${question.answers}">
                <h3 class="answer-sibling-heading">${answer.title}</h3>
                <c:choose>
                    <c:when test="${answer.type eq 'MULTI'}">
                        <div class="answer-sibling">
                        <div class="checkbox-col">
                            <c:forEach var="answerValue" items="${answer.answerValues}" varStatus="boxCounter">
                                <c:set var="mapKey" value="q${question.id}a${answer.id}"/>
                                <c:choose>
                                    <c:when test="${not empty userResponseCommand.responseMap[mapKey]}">
                                        <form:checkbox path="responseMap[${mapKey}].values"
                                                       id="${mapKey}" value="${answerValue.symbol}"/>
                                    </c:when>
                                    <c:otherwise>
                                        <input name="responseMap[${mapKey}].values"
                                               value="${answerValue.symbol}" type="checkbox"/>
                                    </c:otherwise>
                                </c:choose>
                                ${answerValue.display}
                                <br/>
                                <c:if test="${boxCounter.index gt (fn:length(answer.answerValues) / 3)}">
                                    <![CDATA[
                                                </div>
                                                <div class="checkbox-col">
                                            ]]>
                                </c:if>

                            </c:forEach>
                        </div>
                        </div>
                    </c:when>
                    <c:when test="${answer.type eq 'SINGLE'}">
                        <c:forEach var="answerValue" items="${answer.answerValues}">
                            <c:set var="mapKey" value="q${question.id}a${answer.id}"/>
                            <c:choose>
                                <c:when test="${not empty userResponseCommand.responseMap[mapKey]}">
                                    <form:radiobutton path="responseMap[${mapKey}].values"
                                                      id="${mapKey}" value="${answerValue.symbol}"/>
                                </c:when>
                                <c:otherwise>
                                    <input name="responseMap[${mapKey}].values"
                                           value="${answerValue.symbol}" type="radio"/>
                                </c:otherwise>
                            </c:choose>
                            ${answerValue.display}
                            <br/>
                        </c:forEach>
                    </c:when>
                    <c:when test="${answer.type eq 'SCALE'}">
                        <c:forEach var="answerValue" items="${answer.answerValues}">
                            <c:set var="mapKey" value="q${question.id}a${answer.id}"/>
                            <c:choose>
                                <c:when test="${not empty userResponseCommand.responseMap[mapKey]}">
                                    <form:radiobutton path="responseMap[${mapKey}].values"
                                                      id="${mapKey}" value="${answerValue.symbol}"/>
                                </c:when>
                                <c:otherwise>
                                    <input name="responseMap[${mapKey}].values"
                                           value="${answerValue.symbol}" type="radio"/>
                                </c:otherwise>
                            </c:choose>
                            ${answerValue.display}
                            <br/>
                        </c:forEach>
                    </c:when>
                    <c:when test="${answer.type eq 'OPTION'}">
                        <c:set var="mapKey" value="q${question.id}a${answer.id}"/>
                        <c:choose>
                            <c:when test="${not empty userResponseCommand.responseMap[mapKey]}">
                                <form:select path="responseMap[${mapKey}].values"
                                             id="${mapKey}" items="${answer.answerValues}" itemValue="symbol" itemLabel="display"/>
                            </c:when>
                            <c:otherwise>
                                <select name="responseMap[${mapKey}].values">
                                    <c:forEach var="answerValue" items="${answer.answerValues}">
                                        <option value="${answerValue.symbol}">${answerValue.display}</option>
                                    </c:forEach>
                                </select>
                            </c:otherwise>
                        </c:choose>
                        <br/>
                    </c:when>
                    <c:otherwise>
                        <h1>error</h1>
                    </c:otherwise>
                </c:choose>
                <br/>
            </c:forEach>

        </div>
    </c:forEach>                                                          
    </div>
</c:forEach>

<div class="question-group">
    <c:choose>
        <c:when test="${(not empty requestScope.context.user) and (not empty userResponseCommand.year) and (userResponseCommand.year ne '0')}">
            <input type="hidden" name="terms" value="true"  />
            <input type="hidden" name="email" value="${requestScope.context.user.email}"  />
        </c:when>
        <c:otherwise>
            <h2 class="question-group-heading">A little about you (required)</h2>
            <div class="question">
                <div class="question-text">My child last attended this school in:</div>
                <ul class="answer-list">
                    <c:forEach var="year" items="${schoolYears}" varStatus="count">
                        <li class="answer-list-item">
                            <form:radiobutton path="year" value="${year}" id="r${year}" cssStyle="radio"/>
                            <label for="r${year}">${year-1}-${year}</label>
                            <c:if test="${count.index == 0}"><form:errors path="year" cssClass="error"/></c:if>
                        </li>
                    </c:forEach>
                </ul>
            </div>
            <div class="question">
                <div class="email-module">
                    Email address
                    <form:input id="email" path="email" size="30"/>
                    <form:errors path="email" >
                        <span class="error">Please enter a valid e-mail address.</span>
                    </form:errors>
                    <div class="email-subtext">We will not share your email. <link:privacyPolicy>GreatSchools Privacy Policy</link:privacyPolicy></div>
                </div>
            </div>
            <form:checkbox path="terms" /> I accept the <link:termsOfUse title="GreatSchools Terms of Service" target="_blank">GreatSchools Terms of Use</link:termsOfUse>
            <form:errors path="terms" />
        </c:otherwise>
    </c:choose>
</div>

<div id="all-errors">
    <h1>user: ${requestScope.context.user}</h1>
    <form:errors path="*" />
</div>

<div class="nextprev">
    <div class="previousnextouterwrap" id="outerteachers">
        <div class="previousnextwrap">
            <div class="next" id="testnext_teachers">
                <!--<input type="submit" name="submit" value="Save and Continue"></input>-->
                <gsml:inputImage src="/res/img/survey/savecontinue.gif" alt="Save and Continue"
                                 name="submit" id="submitButton"/>
                <gsml:img src="/res/img/survey/nextarrows.gif" alt="Next arrows" />
            </div>
        </div>
    </div>
</div>


</form:form>
</div>
<div id="right-col">
    <ad:House_Ad_300x137 referredBy="Parent Survey Questions:1" />
    <ad:x40/>
</div>
</school:profile>
<mod:tracking pageType="School Profile"
              pageName="Parent Survey Questions:1"
              hier1="Schools,Parent Survey,Question,Page 1"/>
</body>
</html>
</jsp:root>