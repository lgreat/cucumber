<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="1.2"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:spring="http://www.springframework.org/tags"
          xmlns:search="urn:jsptagdir:/WEB-INF/tags/search"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:content="urn:jsptagdir:/WEB-INF/tags/content"
          xmlns:promo="urn:jsptagdir:/WEB-INF/tags/promo"
          xmlns:map="urn:jsptagdir:/WEB-INF/tags/map"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:gsweb="gstaglib">
<jsp:directive.page import="gs.data.school.LevelCode"/>
<jsp:directive.page import="gs.web.school.SchoolsController"/>

<html lang="en">
<pageHelper:setPathway pathway="RESEARCH_COMPARE" />
<!--
<c:if test="${requestScope.context.ABVersion eq 'a'}">
    <c:if test="${not requestScope.context.cobranded}">
        <c:if test="${not requestScope.context.crawler}">
            <pageHelper:externalJavascript file="/res/js/interstitial.js"/>
            <pageHelper:addOnLoadHandler handler="doInterstitial()"/>
        </c:if>
    </c:if>
</c:if>
-->
<jsp:output doctype-root-element="html"
            doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
            doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>

<jsp:directive.page contentType="text/html"/>

<c:set var="queryStringNoMap">
    <jsp:scriptlet>
        String queryString = request.getQueryString();
        if (queryString == null) {
            queryString = "";
        }
        int mapIndex = queryString.indexOf("map=");
        // avoid crash if query string is only "?map=0" (which should never happen anyway)
        if (mapIndex > -1 &amp;&amp; queryString.length() > "map=0".length()) {
            // exclude the map=0 along with the trailing separator (an ampersand)
            queryString = queryString.substring(0, mapIndex) +
                    queryString.substring(mapIndex + "map=0x".length());
        }
        out.print(queryString);
    </jsp:scriptlet>
</c:set>

<head>
    <c:set var="title">
        <c:choose>
            <c:when test="${not empty cityDisplayName}">
                <jsp:scriptlet>
                    String title = SchoolsController.calcCitySchoolsTitle(
                            (String) request.getAttribute("cityDisplayName"),
                            (LevelCode) request.getAttribute("lc"),
                            request.getParameterValues("st"));
                    out.print(title);
                </jsp:scriptlet>
            </c:when>
            <c:when test="${not empty distname}">
                <jsp:scriptlet>
                    String title = SchoolsController.calcCitySchoolsTitle(
                            (String) request.getAttribute("distname"),
                            (LevelCode) request.getAttribute("lc"),
                            request.getParameterValues("st"));
                    out.print(title);
                </jsp:scriptlet>
            </c:when>
            <c:otherwise>
                GreatSchools.net Search
            </c:otherwise>
        </c:choose>
    </c:set>

    <c:set var="metadesc">
        <c:choose>
            <c:when test="${not empty cityDisplayName}">

            <jsp:scriptlet>
                String metadesc = SchoolsController.calcMetaDesc(
                      (String)request.getAttribute("districtDisplayName"),
                      (String)request.getAttribute("cityDisplayName"),
                      (LevelCode)request.getAttribute("lc"),
                      request.getParameterValues("st"));
                out.print(metadesc);
            </jsp:scriptlet>
            </c:when>
            <c:when test="${not empty distname}">
               <jsp:scriptlet>
                String metadesc = SchoolsController.calcMetaDesc(
                      (String)request.getAttribute("distname"),
                      (String)request.getAttribute("cityDisplayName"),
                      (LevelCode)request.getAttribute("lc"),
                      request.getParameterValues("st"));
                out.print(metadesc);
            </jsp:scriptlet>

            </c:when>


    </c:choose>

    </c:set>

    <meta name="description" content="${metadesc}"/>
    <title>${title}</title>

    <![CDATA[
       <script language="javascript" type="text/javascript">
       <!--
           function checkSelections() {
               var checks = document.getElementsByTagName('input');

               count = 0;
               for (i=0;i < checks.length; i++) {
                   if (checks.item(i).checked == true) {
                       count++
                   }
               }
               if (count == 0) {
                   alert("Please select the checkbox for at least one school.");
                   return false;
               }
           }
       -->
       </script>
    ]]>

    <c:if test="${not requestScope.context.cobranded}">
        <![CDATA[
    <style type="text/css">
           .pageWidth { width:100% !important; border:0}
    </style>
    ]]>
    </c:if>
    <c:if test="${requestScope.context.cobranded}">
        <![CDATA[
    <style type="text/css">
    .rcopy { }
           .pageWidth { width:760px !important; border:0}
           #searchfooter { width: 400px !important;}
    </style>
    ]]>
    </c:if>

</head>

<gsml:body adPageName="search">
<c:set var="state" value="${requestScope.context.stateOrDefault}"/>
<pageHelper:externalCss file="/res/css/school/schoolsTable.css"/>

<table id="main" width="100%" cellspacing="0"><tr>
    <td class="leftcol" id="leftsearchcolumn" valign="top">
        <div class="filters">
            <jsp:include page="/search/schoolFilters.module?${pageContext.request.queryString}"/>
        </div>

        <c:if test="${requestScope.context.cobrand ne 'yahooed'}">
            <c:if test="${param.map ne 1 and results.total gt 0}">
                <div class="mapIt"><p>
                    <gsml:a href="/schools.page?map=1&amp;${queryStringNoMap}">
                        <gsml:img src="/res/img/geo/btn_map_it.gif" alt="map it"/>
                        <br/><br/>See results on our<br />interactive local map
                    </gsml:a></p>
                </div>
            </c:if>
            <c:if test="${param.map eq 1 }">
                <div class="mapIt">
                    <gsml:a href="/schools.page?map=0&amp;${queryStringNoMap}">
                        <gsml:img src="/res/img/geo/btn_map_it.gif" alt="map it"/>
                        <h4>Hide Map</h4>
                    </gsml:a>
                </div>
            </c:if>
        </c:if>
        <pageHelper:externalCss file="/res/css/mod/browseState.css"/>
        <div id="browseStateControl">
            <mod:browseState state="${state}"/>
        </div>
    </td>
    <td valign="top" class="middleColumn">

        <gsweb:form action="/compareSchools.page" method="get">
            <input type="hidden" name="state" value="${state}}"/>

            <gsweb:schoolTableHeader total="${results.total}"
                                     srcQuery="${pageContext.request.queryString}"
                                     showAll="${results.showAll}"
                                     cityName="${cityName}"
                                     cityDisplayName="${cityDisplayName}"
                                     districtId="${district}"
                                     pageSize="${results.pageSize}"
                                     schoolType="${st}"
                                     levelCode="${lc}"
                    >
            </gsweb:schoolTableHeader>

            <c:if test="${requestScope.context.cobrand ne 'yahooed'}">
                <c:if test="${results.total gt 0}">
                    <c:if test="${param.map eq 1}">
                        <div style="width:100%; text-align:right; padding-right: 5px;  font-size: small;font-weight:bold">
                            <gsml:a href="/schools.page?map=0&amp;${queryStringNoMap}">Hide Map</gsml:a>
                        </div>

                        <div id="mapContainer">
                            <script type="text/javascript">document.write('<div id="map" style="height: 400px; width: 100%">&#160;</div>')</script>
                            <noscript>In order to view this map, enable JavaScript in your browser.</noscript>
                        </div>
                        <map:schools id="map"
                                     bubbles="true"
                                     schools="${results.schools}"/>
                    </c:if>
                    <c:if test="${param.map eq 5}">
                        <div style="border: 1px solid #999; border-width: 1px 0 1px 0; font-size: small;">
                            <table width="100%" cellpadding="0" cellspacing="0">
                                <tr>
                                    <td rowspan="2">
                                        <gsml:a href="/schools.page?map=1&amp;${queryStringNoMap}">
                                            <gsml:img src="/res/img/geo/btn_map_it.gif" alt="map it"/>
                                        </gsml:a>
                                    </td>
                                    <td style="text-align:right; padding-right: 5px; font-weight:bold">
                                        <gsml:a href="/schools.page?map=1&amp;${queryStringNoMap}">Show
                                            Map</gsml:a>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding-left: 15px; padding-bottom: 4px; font-weight: bold">See your
                                        results on our interactive local map
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </c:if>
                </c:if>
            </c:if>
            <gsweb:schoolTable schools="${results.schools}"
                               total="${results.total}"
                               srcQuery="${pageContext.request.queryString}"
                               showAll="${results.showAll}"
                               pageSize="${results.pageSize}"
                               schoolType="${st}"
                               levelCode="${lc}"
                    >
                <search:schoolTable schools="${results.schools}"/>
            </gsweb:schoolTable>
        </gsweb:form>
    </td>
    <td class="rightcolumn" align="center">
        <promo:backToSchool/>
        <c:set var="slotPrefix" value="Search_Site"/>
        <c:if test="${not empty param.city}">
            <c:set var="slotPrefix" value="Search_All_Cities"/>
        </c:if>
        <ad:setSlotPrefix slotPrefix="${slotPrefix}"/>
        <ad:x47/>
        <ad:multiTextAd blurb="Advertiser Links"/>
    </td>
</tr>
</table>

<c:choose>
    <c:when test="${not empty param.city}">
        <mod:tracking
                pageName="schools:city:${(empty results.showAll) ? ((empty param.p ? '1' : param.p)) : 'all'}${param.map eq 1 ? ':map':''}"
                pageType="search"
                hier1="Search,Schools,City,${(results.total gt 0 ? ((empty results.showAll) ? ((empty param.p ? '1' : param.p)) : 'all') : 'noresults') }"
                schoolType="${gsweb:toDelimitedString(paramValues.st)}"
                schoolLevel="${gsweb:toUglyDelimitedString(paramValues.gl)}"/>
    </c:when>
    <c:when test="${not empty param.district}">
        <mod:tracking
                pageName="schools:district:${(empty results.showAll) ? ((empty param.p ? '1' : param.p)) : 'all'}${param.map eq 1 ? ':map':''}"
                pageType="search"
                hier1="Search,Schools,District,${(results.total gt 0 ? ((empty results.showAll) ? ((empty param.p ? '1' : param.p)) : 'all') : 'noresults') }"
                schoolType="${gsweb:toDelimitedString(paramValues.st)}"
                schoolLevel="${gsweb:toUglyDelimitedString(paramValues.gl)}"/>
    </c:when>
    <c:otherwise>
        <mod:tracking pageName="schools${param.map eq 1 ? ':map':''}"
                      pageType="search"
                      hier1="Search,Schools,Page${results.total gt 0 ? (empty param.p ? '1' : param.p) : 'noresults'}"
                      schoolType="${gsweb:toDelimitedString(paramValues.st)}"
                      schoolLevel="${gsweb:toUglyDelimitedString(paramValues.gl)}"/>

    </c:otherwise>
</c:choose>
</gsml:body>
</html>
</jsp:root>