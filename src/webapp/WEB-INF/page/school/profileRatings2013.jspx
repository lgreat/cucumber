<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns="http://www.w3.org/1999/xhtml" version="2.0"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:profile="urn:jsptagdir:/WEB-INF/tags/school/profile"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
          xmlns:gslink="urn:jsptagdir:/WEB-INF/tags/link"
        >

<c:set var="city" value="${school.physicalAddress.city}"/>

<div class="${(!empty requestScope.schoolProfileTabMap.ratings and requestScope.schoolProfileTabMap.ratings eq 'selected'?'':'dn')}">
    <c:if test="${not empty alternateSitePath}">
        <a class="dn js-alternateSitePath" href="${alternateSitePath}" data-hide-alternate-site-button="${not empty hideAlternateSiteButton}"><!-- do not collapse --></a>
    </c:if>

    <c:set var="hasBreakdownRatings" value="${(schoolTestScoreRating != null and testScoreRatingYear != null) or not empty schoolStudentGrowthRating or not empty schoolPostSecondaryReadinessRating}"/>
    <c:set var="hasStateDistributions" value="${not empty stateDistributionPercentBelow and not empty stateDistributionPercentAverage and not empty stateDistributionPercentAbove}"/>

    <div class="alpha grid_16 omega">
        <h2>What is the GreatSchools Rating?</h2>

        <c:if test="${not empty performanceManagementRatingCopy}">
            <div class="alert-yellow smaller">
                <div class="pam clearfix">
                    <div class="fl">
                        <span class="iconx16 i-16-notice"><!-- do not collapse --></span>
                    </div>
                    <div class="fr" style="width:580px;">
                        ${performanceManagementRatingCopy}
                    </div>
                </div>
            </div>
        </c:if>

        <p>${dataCopy['what_is_gs_rating_summary']}</p>

        <div class="alpha grid_2">&amp;nbsp;</div>
        <div class="grid_11">
            <div class="pam ratingsGraphicMakesUp ptl">
                <c:set var="ratingsDescriptor">
                    <c:choose>
                        <c:when test="${overallRating lt 4}">Below average</c:when>
                        <c:when test="${overallRating lt 8}">Average</c:when>
                        <c:when test="${overallRating lt 4}">Above average</c:when>
                    </c:choose>
                </c:set>
                <div class="iconTop media">
                    <c:set var="overallRatingBadge" value="NR"/>
                    <c:if test="${not empty overallRating}">
                        <c:set var="overallRatingBadge" value="${overallRating}"/>
                    </c:if>
                    <c:set var="schoolType" value="public"/>
                    <c:if test="${school.type.schoolTypeName eq 'private'}">
                        <c:set var="schoolType" value="private"/>
                    </c:if>

                    <div class="ratingx72-${schoolType}-RYG r-72-${overallRatingBadge} bottom mhl fl"><!-- do not collapse --></div>
                    <div class="img bd mtl defaul bold"><em>${ratingsDescriptor}</em></div>
                </div>

                <c:if test="${hasBreakdownRatings}">
                    <div class="clear mbl"><!-- not empty --></div>
                    <hr class="keyline1"/>
                    <div class="clear mbl"><!-- not empty --></div>
                    <div>
                        <c:if test="${schoolTestScoreRating != null and testScoreRatingYear != null}">
                            <div class="mbm">
                                Test score rating <span class="medium_bold mbn fr ratingx24-public-RYG r-24-${schoolTestScoreRating} make-ffffff"><!-- not empty --></span>
                            </div>
                        </c:if>
                        <c:if test="${not empty schoolStudentGrowthRating}">
                            <div class="mbm">
                                Student growth rating <span class="medium_bold mbn fr ratingx24-public-RYG r-24-${schoolStudentGrowthRating}"><!-- not empty --></span>
                            </div>
                        </c:if>
                        <c:if test="${not empty schoolPostSecondaryReadinessRating}">
                            <div class="mbm">
                                College readiness rating <span class="medium_bold mbn fr ratingx24-public-RYG r-24-${schoolPostSecondaryReadinessRating}"><!-- not empty --></span>
                            </div>
                        </c:if>
                        <div class="clear mbl"><!-- not empty --></div>
                        <hr class="keyline1"/>

                        <!--legend-->
                        <div class="media mtl">
                            <div class="unit size33of100 mrl">
                                <div class="img pt1">
                                    <span class="iconx16 i-16-key-lowrating mrs fl"><!-- not empty --></span>
                                </div>
                                <div class="bd fl">
                                    <p class="bottom small"><strong>1-3</strong> <em> Below Average</em></p>
                                </div>
                            </div>
                            <div class="unit size28of100">
                                <div class="img pt1">
                                    <span class="iconx16 i-16-key-average-rating mrs fl"><!-- not empty --></span>
                                </div>
                                <div class="bd fl">
                                    <p class="bottom small"><strong>4-7</strong> <em> Average</em></p>
                                </div>
                            </div>
                            <div class="unit size33of100">
                                <div class="img pt1">
                                    <span class="iconx16 i-16-key-high-rating mrs fl"><!-- not empty --></span>
                                </div>
                                <div class="bd fl">
                                    <p class="bottom small"><strong>8-10</strong> <em> Above Average</em></p>
                                </div>
                            </div>
                        </div>

                        <div class="clear"><!-- do not collapse --></div>
                    </div>
                </c:if>
            </div>
        </div>
        <div class="omega grid_4">&amp;nbsp;</div>
    </div>

    <div class="alpha grid_16 omega">
        <c:if test="${hasBreakdownRatings and hasStateDistributions}">
            <p><strong>How schools in the state rate:</strong></p>
            <div class="alpha grid_4 containerGrayBox2 medium phl tac">
                <fmt:formatNumber var="stateDistributionPercentBelowRounded" value="${stateDistributionPercentBelow}" maxFractionDigits="0"/>
                <span class="larger"><strong>${stateDistributionPercentBelowRounded}%</strong></span><br/>
                of schools in the state
                are <strong><em>Below average</em></strong>
            </div>
            <div class="grid_4 containerGrayBox2 medium phl tac">
                <fmt:formatNumber var="stateDistributionPercentAverageRounded" value="${stateDistributionPercentAverage}" maxFractionDigits="0"/>
                <span class="larger"><strong>${stateDistributionPercentAverageRounded}%</strong></span><br/>
                of schools in the state
                are <strong><em>Average</em></strong>
            </div>
            <div class="omega grid_4 containerGrayBox2 medium phl tac">
                <fmt:formatNumber var="stateDistributionPercentAboveRounded" value="${stateDistributionPercentAbove}" maxFractionDigits="0"/>
                <span class="larger"><strong>${stateDistributionPercentAboveRounded}%</strong></span><br/>
                of schools in the state
                are <strong><em>Above average</em></strong>
            </div>
            <div class="clear"><!-- do not collapse --></div>
        </c:if>
    </div>

    <div class="clear mbl"><!-- not empty --></div>
    <hr class="keyline1"/>
    <div class="clear mbl"><!-- not empty --></div>

    <h2 class="pvm bottom">Breaking down the GreatSchools Rating</h2>

    <p class="small">
        ${dataCopy['breaking_down_gs_rating_summary']}
        <c:choose>
            <c:when test="${empty schoolTestScoreRating and empty schoolStudentGrowthRating and empty schoolPostSecondaryReadinessRating}">
                ${dataCopy['breaking_down_gs_rating_summary_no_data']}
            </c:when>
            <c:otherwise>
                ${dataCopy['breaking_down_gs_rating_summary_yes_data']}
            </c:otherwise>
        </c:choose>
    </p>
    <c:set var="currentFootnoteNumeral" value="${1}"/>

    <c:if test="${schoolTestScoreRating != null and testScoreRatingYear != null}">
        <c:set var="testScoreFootnoteNumeral" value="${currentFootnoteNumeral}"/>
        <c:set var="currentFootnoteNumeral" value="${currentFootnoteNumeral+1}"/>

        <div class="pvm">
            <h6 class="mtm medium_bold pbm">
                Test score rating ${testScoreRatingYear}<sup>${testScoreFootnoteNumeral}</sup>
                <a href="#" onclick="return false;" class="js-ratingsExpando medium mls" data-id="test-score">What's this?</a>
            </h6>
            <div class="dn mvl js-ratings-description-for-test-score">
                ${dataCopy['whats_this_test_scores']}
            </div>
            <c:choose>
                <c:when test="${school.databaseState eq 'DC'}">
                    <profile:ratingsBarChart ratingDivId="ratingTestResults1"
                                             schoolRating="${schoolTestScoreRating}"
                                             cityRating="${cityTestScoreRating}"
                                             stateRatingShow="${showStateTestScoreRating}"
                                             stateRating="${stateTestScoreRating}"/>
                </c:when>
                <c:otherwise>
                    <profile:ratingsBarChart ratingDivId="ratingTestResults1"
                                             schoolRating="${schoolTestScoreRating}"
                                             districtRating="${districtTestScoreRating}"
                                             stateRatingShow="${showStateTestScoreRating}"
                                             stateRating="${stateTestScoreRating}"/>
                </c:otherwise>
            </c:choose>
        </div>
        <div class="clear"><!-- not empty --></div>
        <div class="mvm small">
            <gslink:linkToTab tabName="test-scores">
                Learn more about this school's test scores &amp;raquo;
            </gslink:linkToTab>
        </div>
        <div class="clear mbl"><!-- not empty --></div>
        <hr class="keyline2"/>
    </c:if>

    <c:if test="${(schoolStudentGrowthRating != null) or (schoolStudentGrowthRatingBreakdown != null and cityStudentGrowthRating != null
                    and stateStudentGrowthRating != null)}">
        <c:set var="growthFootnoteNumeral" value="${currentFootnoteNumeral}"/>
        <c:set var="currentFootnoteNumeral" value="${currentFootnoteNumeral+1}"/>
        <div class="pvm">
            <h6 class="mtm medium_bold pbm">
                Student growth rating ${studentGrowthRatingYear}<sup>${growthFootnoteNumeral}</sup>
                <a href="#" onclick="return false;" class="js-ratingsExpando medium mls" data-id="growth">What's this?</a>
            </h6>
            <div class="dn mvl js-ratings-description-for-growth">
                ${dataCopy['whats_this_growth']}
            </div>
            <c:choose>
                <c:when test="${school.databaseState eq 'DC'}">
                    <profile:ratingsBarChart ratingDivId="ratingTestResults2"
                                             schoolRating="${schoolStudentGrowthRating}"
                                             cityRating="${cityStudentGrowthRating}"
                                             stateRatingShow="${showStateStudentGrowthRating}"
                                             stateRating="${stateStudentGrowthRating}"/>
                </c:when>
                <c:otherwise>
                    <profile:ratingsBarChart ratingDivId="ratingTestResults2"
                                             schoolRating="${schoolStudentGrowthRating}"
                                             districtRating="${districtStudentGrowthRating}"
                                             stateRatingShow="${showStateStudentGrowthRating}"
                                             stateRating="${stateStudentGrowthRating}"/>
                </c:otherwise>
            </c:choose>
        </div>
        <div class="clear"><!-- not empty --></div>
        <c:if test="${schoolStudentGrowthRatingBreakdown != null}">
            <div class="pvm mbl">
                <c:forEach var="entry" items="${schoolStudentGrowthRatingBreakdown}" varStatus="loopStatus">
                    <div class="containerGrayBox2 small fl phl tac mbn ${loopStatus.last?'':'mrl'}">
                        <p class="mbs">${entry.key} at this school</p>
                        <p class="bottom larger"><strong>${entry.value}</strong></p>
                    </div>
                </c:forEach>
            </div>
        </c:if>
        <div class="clear mbl"><!-- not empty --></div>
        <hr class="keyline2"/>

    </c:if>

    <c:if test="${schoolPostSecondaryReadinessRating != null and postSecondaryReadinessRatingYear != null}">
        <c:set var="psrFootnoteNumeral" value="${currentFootnoteNumeral}"/>
        <c:set var="currentFootnoteNumeral" value="${currentFootnoteNumeral+1}"/>
        <div class="pvm">
            <h6 class="mtm medium_bold pbm">
                College readiness rating ${postSecondaryReadinessRatingYear}<sup>${psrFootnoteNumeral}</sup>
                <a href="#" onclick="return false;" class="js-ratingsExpando medium mls" data-id="post-secondary">What's this?</a>
            </h6>
            <div class="dn mvl js-ratings-description-for-post-secondary">
                ${dataCopy['whats_this_psr']}
            </div>
            <c:choose>
                <c:when test="${school.databaseState eq 'DC'}">
                    <profile:ratingsBarChart ratingDivId="ratingTestResults3"
                                             schoolRating="${schoolPostSecondaryReadinessRating}"
                                             cityRating="${cityPostSecondaryReadinessRating}"
                                             stateRatingShow="${showStatePostSecondaryReadinessRating}"
                                             stateRating="${statePostSecondaryReadinessRating}"/>
                </c:when>
                <c:otherwise>
                    <profile:ratingsBarChart ratingDivId="ratingTestResults3"
                                             schoolRating="${schoolPostSecondaryReadinessRating}"
                                             districtRating="${districtPostSecondaryReadinessRating}"
                                             stateRatingShow="${showStatePostSecondaryReadinessRating}"
                                             stateRating="${statePostSecondaryReadinessRating}"/>
                </c:otherwise>
            </c:choose>
        </div>

        <div class="clear"><!-- not empty --></div>

        <c:if test="${postSecondaryReadinessBreakdownTestScore != null and postSecondaryReadinessBreakdownPercentTested != null}">
            <div class="pvm mbl">
                <div class="containerGrayBox2 small fl phl tac mbn mrl">
                    <p class="mbs">${postSecondaryReadinessBreakdownPercentTestedLabel}</p>
                    <p class="bottom larger"><strong>${postSecondaryReadinessBreakdownPercentTested}%</strong></p>
                </div>
                <div class="containerGrayBox2 small fl phl tac mbn">
                    <p class="mbs">${postSecondaryReadinessBreakdownTestScoreLabel}</p>
                    <p class="bottom larger"><strong>${postSecondaryReadinessBreakdownTestScore}<c:if
                            test="${postSecondaryReadinessBreakdownTestScoreMeasurement eq 'percent'}">%</c:if></strong></p>
                </div>
            </div>
        </c:if>
        <div class="clear mbl"><!-- not empty --></div>
        <hr class="keyline2"/>
    </c:if>

    <c:if test="${schoolTestScoreRating != null and not empty testScoreRatingSource}">
        <p class="smaller bottom pts">${testScoreFootnoteNumeral} ${dataCopy['footnote_test_scores']}</p>
    </c:if>

    <c:if test="${((schoolStudentGrowthRating != null) or (schoolStudentGrowthRatingBreakdown != null and cityStudentGrowthRating != null
                    and stateStudentGrowthRating != null)) and not empty studentGrowthRatingSource}">
        <p class="smaller bottom">${growthFootnoteNumeral} ${dataCopy['footnote_growth']}</p>
    </c:if>

    <c:if test="${schoolPostSecondaryReadinessRating != null and not empty postSecondaryReadinessSource}">
        <p class="smaller bottom">${psrFootnoteNumeral} ${dataCopy['footnote_psr']}</p>
    </c:if>

</div>

<mod:deferredTracking key="ratings" pageName="Ratings" hier1="School,SchoolProfileSuite,Ratings"/>

</jsp:root>