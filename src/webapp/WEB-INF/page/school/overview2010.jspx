<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns="http://www.w3.org/1999/xhtml" version="2.0"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:school="urn:jsptagdir:/WEB-INF/tags/school"
          xmlns:gsweb="gstaglib"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:content="urn:www.greatschools.org/taglib/content"
          xmlns:ratings="urn:jsptagdir:/WEB-INF/tags/ratings"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:map="urn:jsptagdir:/WEB-INF/tags/map"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:promo="urn:jsptagdir:/WEB-INF/tags/promo"
          xmlns:k12="urn:jsptagdir:/WEB-INF/tags/promo/k12"
          xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
          xmlns:variant="urn:jsptagdir:/WEB-INF/tags/variant"
          xmlns:gslink="urn:jsptagdir:/WEB-INF/tags/link"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:community="urn:jsptagdir:/WEB-INF/tags/community"
        >
<jsp:directive.page import="gs.web.util.PageHelper"/>
<jsp:directive.page import="gs.data.school.School"/>
<pageHelper:setPathway pathway="RESEARCH_COMPARE"/>

<jsp:output doctype-root-element="html"
            doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"

            doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>
<jsp:directive.page contentType="text/html"/>
<c:set var="pageName" value="Overview" scope="request"/>
<c:set var="stateAbbrev" value="${requestScope.context.stateOrDefault.abbreviation}"/>
<c:set var="addr" value="${school.physicalAddress.city}, ${school.databaseState.longName} - ${stateAbbrev}"/>
<!-- determine the page name that is reported to omniture -->
<c:choose>
    <c:when test="${school.levelCode == 'p'}">
        <c:set var="pageName" value="Preschool Overview"/>
    </c:when>

    <c:otherwise>
        <c:if test="${school.type.schoolTypeName == 'private'}">
            <c:set var="pageName" value="Private School Overview"/>
        </c:if>
    </c:otherwise>
</c:choose>
<jsp:scriptlet>
    PageHelper.setPageName(request, "spp_overview");
</jsp:scriptlet>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta name="description" content="${gsweb:schoolPageDescription(school)}"/>
    <meta name="keywords" content="${gsweb:schoolPageKeywords(school)}"/>
    <c:choose>
        <c:when test="${school.demoSchool}">
            <meta name="robots" content="noindex, nofollow, noarchive"/>
        </c:when>
        <c:when test="${noIndexFlag}">
            <meta name="robots" content="follow, noindex"/>
        </c:when>
    </c:choose>
    <c:set var="schoolPageTitle" value="${gsweb:schoolPageTitle(school)}"/>
    <title>${schoolPageTitle}</title>
    <!-- SearchMonkey eRDF support-->
    <link rel="schema.foaf" href="http://xmlns.com/foaf/0.1/"/>
    <link rel="schema.sioc" href="http://rdfs.org/sioc/ns#"/>
    <c:if test="${not empty relCanonical}">
        <link rel="canonical" href="${relCanonical}"/>
    </c:if>

    <c:if test="${!requestScope.requestInfo.cobranded}">
        <base href="${requestScope.requestInfo.baseHost}"/>
    </c:if>

    <c:set var="start" value="${empty param.start ? 0 : param.start}"/>
    <!-- TODO: Is the following necessary? -->
    <![CDATA[
<!--[if IE 7]>
<link rel="stylesheet" type="text/css"
href="/res/css/school/parentReviewForm_ie7.css" />
<![endif]-->
     ]]>
        <!-- TODO: Move into global css -->
    <style type="text/css">
        #espLink {
            background: #FAEACF url('/res/img/school/parentReviews/bluePencil.png') 5px 50% no-repeat;
            padding: 9px 44px 9px 29px;
            margin: 15px 15px 5px 0;
        }
    </style>
    <pageHelper:externalJavascript file="/res/js/omnitureEventNotifier.js"/>
    <c:if test="${school.levelCode == 'p'}">
        <c:if test="${requestScope.context.interstitialEnabled and not isInAdFreeHub}">
            <pageHelper:externalJavascript file="/res/js/interstitial.js"/>
            <pageHelper:addOnLoadHandler handler="doInterstitial('pkSchool')"/>
        </c:if>
    </c:if>
    <school:profile2010ShareThisJavaScript/>
    <k12:trafficDriverIncludes/>
</head>
<gsml:body adPageName="overview" pageLayout="overview">

<div class="hreview-aggregate">

<c:set var="adSlotPrefix" value="School_Profile_Page_Overview"/>
<ad:setSlotPrefix slotPrefix="${adSlotPrefix}"/>

<school:profile2010 school="${school}" tab="overview" omniturePageName="${pageName}" adSlotPrefix="${adSlotPrefix}">

<div id="overviewContainer">

<c:set var="overallRating" value="${ratings.overall}"/>
<c:if test="${empty ratings.overall}">
    <c:set var="overallRating" value="0"/>
</c:if>

<div id="overviewColumn1">

    <!-- overall school rating box -->
    <div id="overallRating">

        <c:if test="${not empty gs_rating}">
            <p class="text3">GreatSchools Rating</p>

            <div class="spacer_5"><!-- do not collapse --></div>
            <link:schoolProfileRating school="${school}">
                <ratings:ratingsSprite isNewGsRating="${school.isNewGSRating}" gsRating="${gs_rating}" schoolType="${school.type.schoolTypeName}" isPreschoolOnly="${school.levelCode eq 'p'}" spriteSize="large"/>
                <!--<span class="sprite badge_lg_${gs_rating}_b">&lt;!&ndash; do not collapse &ndash;&gt;</span>-->
            </link:schoolProfileRating>

            <div class="spacer_5"><!-- do not collapse --></div>
            <link:schoolProfileRating styleClass="smallAlertText"
                                      school="${school}">GreatSchools<br/>evaluation criteria</link:schoolProfileRating>
            <div class="brdbtm_dotted spacer_10"><!-- do not collapse --></div>

        </c:if>


        <div class="spacer_10"><!-- do not collapse --></div>
        <p class="text3">
            Community Rating
        </p>

        <div class="spacer_5"><!-- do not collapse --></div>
        <link:schoolProfileParentReview school="${school}">
            <span class="sprite stars_lg_${overallRating}_b stars_${overallRating}" title="${overallRating} star rating"><!-- do not collapse --></span>
        </link:schoolProfileParentReview>

        <div class="spacer_5"><!-- do not collapse --></div>

        <c:choose>
            <c:when test="${numberOfReviews gt 0}">
                <link:schoolProfileParentReview school="${school}" styleClass="smallAlertText">
                    <c:choose>
                        <c:when test="${numberOfReviews eq 1}">Read the review</c:when>
                        <c:otherwise>Read all ${numberOfReviews} reviews</c:otherwise>
                    </c:choose>
                </link:schoolProfileParentReview>

                <div class="spacer_5"><!-- do not collapse --></div>
            </c:when>
            <c:otherwise>
                <link:schoolProfileParentReview
                        school="${school}">Be the first to review</link:schoolProfileParentReview>
            </c:otherwise>
        </c:choose>

        <button class="button-1Ext-1" type="submit" name="reviewBtn" id="reviewBtn">Review this school</button>
    </div>
    <div class="spacer_15"><!-- do not collapse --></div>
    <ad:AboveFold_Left_160x600/>

    <!--<p>school.physicalAddress.state: <c:out value="${school.physicalAddress.state}" default="not set."/></p>
    <p>school.type.schoolTypeName: <c:out value="${school.type.schoolTypeName}" default="not set."/></p>
    <p>school.levelCode: <c:out value="${school.levelCode}" default="not set."/></p>-->

    <c:set var="isDcNclbSchool" value="${school.physicalAddress.state eq 'DC' and (school.type.schoolTypeName eq 'public' or school.type.schoolTypeName eq 'charter') and school.levelCode ne 'p'}"/>
        <c:if test="${requestScope.context.showDcNclbModules and isDcNclbSchool}">
            <div class="spacer_10"><!-- do not collapse --></div>
            <school:dcNclbReportCard
                    school="${school}"
                    showAllSchoolLinks="${requestScope.context.showDcNclbAllSchoolLinks}"
                    schoolCodesToShow="${requestScope.context.dcNclbSchoolCodesToShow}"
                    districtCodesToShow="${requestScope.context.dcNclbDistrictCodesToShow}"
                    />
        </c:if>

</div>

<div id="overviewColumn2">
<div class="spacer_15"><!-- do not collapse --></div>

    <c:if test="${not empty bestKnownFor}">
        <div id="bestKnownFor" class="brdbtm_dotted">
            <div class="spacer_10"><!-- do not collapse --></div>

            <div id="js-bubbleInfo-0">

                <div class="media">
                    <div class="js-trigger imgExt sprite info mrm"><!-- do not collapse --></div>

                    <p class="bd introText">"${bestKnownFor}"</p>
                </div>

                <div class="js-popup">

                    <div id="popup-contents-0">
                        <span class="arrow-outline-left"><!-- do not collapse --></span>
                        <span class="arrow-left"><!-- do not collapse --></span>

                        <p class="text3">This statement has been provided by the principal or a school official at ${school.name}.
                            <link:enhancedSchoolProfile
                                    school="${school}">See this school's official school profile <span
                                    class="alertDoubleArrow">&amp;#187;</span></link:enhancedSchoolProfile></p>
                    </div>
                </div>

            </div>


            <div class="text3">
                <link:enhancedSchoolProfile school="${school}">Read more from the school principal <span
                        class="alertDoubleArrow">&amp;#187;</span></link:enhancedSchoolProfile>
            </div>

            <script type="text/javascript">
                jQuery(function () {
                    jQuery('#js-bubbleInfo-0').popup({appear:'right',leftPosition:397,topPosition:-18});
                });
            </script>

        </div>
        <div class="spacer_15"><!-- do not collapse --></div>
    </c:if>

<c:if test="${school.preschoolSubtype ne 'kindercare'}">
    <ad:adTag position="CustomSponsor_407x65"/>
</c:if>

<c:choose>
    <c:when test="${not empty photoGalleryImages}">
        <div class="mvm">
            <div class="line">
                <div class="unit size3of5">
                    <div class="text2 mrm">
                        <content:ratingsSummary school="${school}"/>
                    </div>
                </div>
                <div class="unit size2of5 lastUnit">
                    <div class="mediumThumbnail bgtint-eb" id="school-photo-medium"><p
                            class="text3">Photos of this school</p><a
                            href="javascript:void(0)" onclick="scroll(0,0)" class="js-photo-gallery-trigger"><img
                            src="${basePhotoPath}${photoGalleryImages[0].mediumSizeFile}"
                            alt="Photos of this school"
                            width="130" height="130"/></a>
                        <c:choose>
                            <c:when test="${fn:length(photoGalleryImages) > 1}">
                                <p class="smallText1-06b"><a href="javascript:void(0)" onclick="scroll(0,0)"
                                                             class="js-photo-gallery-trigger">View all photos (${fn:length(photoGalleryImages)})</a>
                                </p>
                            </c:when>
                            <c:when test="${fn:length(photoGalleryImages) eq 1}">
                                <p class="smallText1-06b"><a href="javascript:void(0)" onclick="scroll(0,0)"
                                                             class="js-photo-gallery-trigger">View photo</a></p>
                            </c:when>
                        </c:choose>
                    </div>
                </div>
            </div>
        </div>
    </c:when>
    <c:otherwise>
        <div class="text2">
            <content:ratingsSummary school="${school}"/>
        </div>
    </c:otherwise>
</c:choose>

<c:if test="${not empty school.levelCode and school.levelCode ne 'p'}">
    <p class="text2">Learn more about this school's <link:schoolProfileCensus school="${school}"
                                                             anchor="teachers">teachers</link:schoolProfileCensus> and
    <link:schoolProfileCensus school="${school}" anchor="students">students</link:schoolProfileCensus>.</p>
    <div class="spacer_15"><!-- do not collapse --></div>
</c:if>  

<!-- School highlights -->
<c:if test="${not empty schoolHighlights}">
    <p class="text2bold">School highlights:</p>

    <div>
        <div class="text2 fltlft">${schoolHighlights}</div>
    </div>
</c:if>


<!-- end school highlights -->

<c:if test="${(school.type.schoolTypeName ne 'private') and (school.levelCode ne 'p')}">
    <div class="spacer_15"><!-- do not collapse --></div>
    <link:newsletterManagement styleClass="email toolsTxt text3-06b" schoolId="${school.id}" schoolState="${school.databaseState}" onclick="return GS.showSendMeUpdates(this.href, '${school.name}', '${school.id}', '${school.databaseState}');">
        <span class="sprite emailIt"><!-- do not collapse --></span> Get email updates about this school
    </link:newsletterManagement>
</c:if>

<!--<c:if test="${empty bestKnownFor}">-->
    <!--<c:choose>-->
        <!--<c:when test="${espLink eq 'principal'}">-->
            <!-- principal link box -->
            <c:if test="${school.levelCode != 'p'}">
                <div class="spacer_10"><!-- do not collapse --></div>
                <div class="noticeBox">
                    <div class="media">
                        <span class="sprite pencil_med img mrm"><!-- do not collapse --></span>
                        <div class="bd">
                            <p class="text2">
                                <strong>Are you the principal? </strong>
                                <link:schoolEspRegister styleClass="no_interrupt">Complete your school's profile</link:schoolEspRegister>
                            </p>
                        </div>
                    </div>
                </div>
            </c:if>
            <!-- end profile link box-->
        <!--</c:when>

        <c:when test="${espLink eq 'profile'}">
            &lt;!&ndash; profile link box &ndash;&gt;
            <div class="spacer_10">&lt;!&ndash; do not collapse &ndash;&gt;</div>
            <div id="js-esp-profile-link" class="alertBox2 text2">
                <link:enhancedSchoolProfile school="${school}">See more official school information <span
                        class="alertDoubleArrow">&amp;#187;</span></link:enhancedSchoolProfile>
            </div>
            &lt;!&ndash; end profile link box &ndash;&gt;
        </c:when>
    </c:choose>-->
<!--</c:if>-->

<div class="clearfloat brdbtm_dotted"><!-- do not collapse --></div>
<div class="spacer_15"><!-- do not collapse --></div>

<!-- begin map -->

    <div>
        <div class="title2-d61 fltlft">Compare to nearby schools</div>
        <span class="smallAlertText fltrt iblock padtop_7">
            <link:mapSchool school="${school}">Larger map </link:mapSchool>
            <span class="alertDoubleArrow">&amp;#187;</span>
        </span>
    </div>

<div class="spacer_15"><!-- do not collapse --></div>

<c:set var="pageSize" value="${4}"/>
<div id="nearbySchoolsMap" class="border-c6">
    &#160;
    <noscript>JavaScript is required in order to view a map of the city and its
        schools.
    </noscript>
</div>
<map:school
        id="nearbySchoolsMap"
        tooltips="true"
        schools="${mapSchools}"
        school="${school}"
        start="${start}"
        count="${pageSize}"
        gsRating="${gs_rating}"
        ratings="${ratings}"
        />
<!-- end map -->


<div class="spacer_5"><!-- do not collapse --></div>
<div class="text3">
    <c:choose>
        <c:when test="${school.city eq 'Washington' and school.databaseState eq 'DC'}">
            <link:city city="${school.city}" state="${school.physicalAddress.state}" title="${school.city} schools">Top-rated Washington, D.C. schools</link:city> |
            <link:nearbyCities state="${school.physicalAddress.state}" city="${school.city}">Cities near Washington, D.C.</link:nearbyCities>
        </c:when>
        <c:otherwise>
            <link:city city="${school.city}" state="${school.physicalAddress.state}" title="${school.city} schools">Top-rated ${school.city} schools</link:city> |
            <link:nearbyCities state="${school.physicalAddress.state}" city="${school.city}">Cities near ${school.city}</link:nearbyCities>
        </c:otherwise>
    </c:choose>
</div>
<div class="spacer_5"><!-- do not collapse --></div>
<div>
    <c:if test="${requestScope.context.showRealtorDotComPromos}">
        <div class="smallAlertText fltlt unit size1of3">
            <gslink:realtorDotComLink address="${school.physicalAddress}">Homes for sale</gslink:realtorDotComLink>
        </div>
    </c:if>
    <!-- TODO: GS-12882 remove once New York City information is loaded -->
    <!-- If New York City data is not ready, we need to not show this link for any school in NYC -->
    <!--<c:if test="${!empty school.databaseState and school.databaseState ne 'NY'}">-->
        <div class="smallAlertText fltlt unit size2of3">
            <link:districtBoundaryTool school="${school}">School and District Boundaries Map</link:districtBoundaryTool>
        </div>
    <!--</c:if>-->
</div>

<div class="spacer_10 brdbtm_dotted"><!-- do not collapse --></div>
<div class="spacer_10"><!-- do not collapse --></div>

<c:set var="tab" value="overview"/>
<school:nearbySchoolsTable
        school="${school}"
        gsRating="${gs_rating}"
        ratings="${ratings}"
        mapSchools="${mapSchools}"
        pageSize="4"
        maxPages="5"
        tab="${tab}"
        />
    
</div>

<div class="spacer_15"><!-- do not collapse --></div>

<school:parentReviews school="${school}" reviews="${reviews}" maxReviews="10" ratings="${ratings}" validUser="${validUser}"/>
<c:if test="${numberOfReviews gt 10}">
    <div class="alertBox4 smallAlertTextBold">
        <link:schoolProfileParentReview school="${school}" page="3" styleClass="fltrt">Read more reviews <span
                class="alertDoubleArrow">&amp;#187;</span></link:schoolProfileParentReview>
        <br class="clearBoth"/>
    </div>
</c:if>


<div id="submit-review-link-box" class="alertBox3 text3bold">
    <p>Share your own experience with <span class="item"><span class="fn">${school.name}</span></span>.
    <span class="smallAlertText"><link:schoolProfileParentReview school="${school}">Submit a review <span
            class="alertDoubleArrow">&amp;#187;</span></link:schoolProfileParentReview></span></p>
</div>

</div>

<c:if test="${not empty lastModifiedDate}">
    <br/>
    <c:set var="lastModifiedDateMarkupFormat"><fmt:formatDate type="date" value="${lastModifiedDate}" pattern="yyyy-MM-dd"/></c:set>
    <![CDATA[<div class="smallText1" itemscope itemtype="http://www.schema.org/ProfilePage">]]>
      Last modified <![CDATA[<time itemprop="dateModified" datetime="${lastModifiedDateMarkupFormat}">]]><fmt:formatDate type="date" value="${lastModifiedDate}" pattern="MMMM d, yyyy"/><![CDATA[</time>]]>
    <![CDATA[</div>]]>
</c:if>

</school:profile2010>

<c:set var="schoolType" value="${school.type.schoolTypeName}" />
<c:set var="levelCode" value="${school.levelCode}" />

<c:set var="schoolPhotosTracking" value=""/>
<c:if test="${not empty photoGalleryImages and fn:length(photoGalleryImages) > 0}">
    <c:set var="schoolPhotosTracking" value="${fn:length(photoGalleryImages)}"/>
    <school:photoGallery cssClass="js-photo-gallery-trigger" images="${photoGalleryImages}" school="${school}" />
</c:if>

<script type="text/javascript">
    jQuery(function() {
        document.title = '${gsweb:escapeJavaScript(schoolPageTitle)}';
    });
</script>


<div style="display:none">
    <mod:tracking pageName="${pageName}"
                  hier1="School,SchoolProfileOverview,${gsweb:capitalize(school.type.schoolTypeName)}"
                  school="${school}" schoolGSRating="${gs_rating}" schoolPhotosTracking="${schoolPhotosTracking}"
                  localPageName="${isLocal ? pageName : ''}"/>
</div>

</div>
<div id="fade" class="black_overlay"><!-- do not collapse --></div>

<school:schoolEspThankYou/>

<community:reportContentHover openingElementSelector=".reportIt" reporterId="${validUser.id}"/>

</gsml:body>
</html>
</jsp:root>