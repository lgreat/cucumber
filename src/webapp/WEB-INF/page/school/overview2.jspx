<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="1.2"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:content="urn:jsptagdir:/WEB-INF/tags/content"
          xmlns:promo="urn:jsptagdir:/WEB-INF/tags/promo"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          xmlns:search="urn:jsptagdir:/WEB-INF/tags/search"
          xmlns:gsweb="gstaglib"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:school="urn:jsptagdir:/WEB-INF/tags/school"
          xmlns:variant="urn:jsptagdir:/WEB-INF/tags/variant"
        >
<jsp:directive.page import="gs.data.school.School"/>
<jsp:directive.page import="gs.web.util.PageHelper"/>
<jsp:directive.page import="gs.web.util.context.SessionContext"/>
<jsp:directive.page import="gs.web.util.context.SessionContextUtil"/>
<pageHelper:setPathway pathway="RESEARCH_COMPARE"/>

<html lang="en">
<jsp:output doctype-root-element="html"
            doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
            doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>

<jsp:directive.page contentType="text/html"/>

<c:set var="school" value="${school}"/>
<c:set var="city" value="${school.physicalAddress.city}"/>
<c:set var="state" value="${school.databaseState.abbreviationLowerCase}"/>
<c:set var="stateName" value="${school.databaseState.longName}"/>
<c:set var="stateAbbrev" value="${requestScope.context.stateOrDefault.abbreviation}"/>
<c:set var="sid" value="${school.id}"/>
<c:set var="pageName" value="Overview" scope="request"/>
<!-- determine the page name that is reported to omniture -->
<c:choose>
    <c:when test="${school.levelCode == 'p'}">
        <c:set var="pageName" value="Preschool Overview"/>
    </c:when>

    <c:otherwise>
        <c:if test="${school.type.schoolTypeName == 'private'}">
            <c:set var="pageName" value="Private School Overview"/>
        </c:if>
    </c:otherwise>
</c:choose>
<c:set var="hasPrincipalView" value="${hasPrincipalView}"/>
<c:set var="gs_rating" value="${gs_rating}"/>
<c:set var="parent_ratings" value="${parent_ratings}"/>
<c:set var="preschoolOnly" value="${preschoolOnly}"/>
<c:set var="showAd" value="${!requestScope.pageHelper.adFree and !requestScope.pageHelper.adServedByCobrand}"/>

<jsp:scriptlet>
    SessionContext context = SessionContextUtil.getSessionContext(request);
    PageHelper.setPageName(request, "spp_overview");
    School school = (School) request.getAttribute("school");
    if (school != null) {
        PageHelper.setYahooRealEstateCity(request, school.getCity());
    }
</jsp:scriptlet>

<head>
    <meta name="description" content="${gsweb:schoolPageDescription(school)}"/>
    <meta name="keywords" content="${gsweb:schoolPageKeywords(school)}"/>
    <title>${gsweb:schoolPageTitle(school)}</title>
    <pageHelper:externalCss file="/res/css/school/overview.css"/>

    <style type="text/css">
        #stateSelector2 {
            color:#666666;
            font-family:Trebuchet MS,Arial,sans-serif;
            font-size:12px;
            margin: 12px 8px 12px 0pt;
        }
    </style>
    <!-- SearchMonkey eRDF support-->
    <link rel="schema.foaf" href="http://xmlns.com/foaf/0.1/" />
    <link rel="schema.sioc" href="http://rdfs.org/sioc/ns#" />
</head>

<gsml:body adPageName="overview" pageLayout="nocol" >
    <![CDATA[
    <!--[if IE 7]>
        <link rel="stylesheet" type="text/css" href="/res/css/school/overview_ie7.css" />
        <link rel="stylesheet" type="text/css" href="/res/css/school/parentReviewForm_ie7.css" />
    <![endif]-->
    ]]>

    
<c:set var="school" value="${school}"/>
<school:profile school="${school}" tab="overview">

<div id="schoolOverview">
    <c:if test="${(fromSurveyPage)}">
        <div id="surveyThanks" style="border:4px solid #ddeeee;padding:5px;position:relative;margin-bottom:14px;">
            <div style="height:50px;background-color:#ddeeee;padding:10px;position:relative;">
                <gsml:img src="/res/img/bullet/confirmation.gif" alt="Thank you confirmation" style="position:absolute;top:23px;left:15px;"/>
                <p style="position:absolute;left:50px;top:20px;color:#CC5569;font-weight:bold;font-size:14px;">Thank you for filling out a survey about ${school.name}!<br/>
                <span style="font-size:12px;">We'll be displaying the results of the surveys soon.</span></p>
            </div>
        </div>
    </c:if>

    <gsml:equalizeColumns ids="'col_center','col_right'"/>
    <!-- being left column -->
    <div id="col_left">
        <school:quickFacts school="${school}"/>
        <ad:setSlotPrefix slotPrefix="School_Profile_Page_Overview"/>
        <ad:adTag position="Survey_179x151"/>
        <school:bigPicture school="${school}" divider="true"/>
        <c:set var="rdcCity" value="${school.physicalAddress.city}, ${school.physicalAddress.state}"/>
        <promo:searchRealtorDotCom omniturePageName="${pageName}" defaultCity="${rdcCity}" pageAdRatioKey="RDC_PCT_SCHOOL_OVERVIEW" showAdPct="95" size="160x600">
            <div id="leftcolAd">
                <c:set var="positionAF160x600" value="AboveFold_Left_160x600"/>
                <ad:AboveFold_Left_160x600 position="${positionAF160x600}"/>
            </div>
        </promo:searchRealtorDotCom>
    </div><!-- end: col_left" -->

    <school:overviewSummary school="${school}" gsRating="${empty gs_rating ? 0 : gs_rating}" parentRating="${parent_ratings}" clickTracking="true"/>

    <!-- begin center column -->
    <div id="col_center">
            <c:if test="${!requestScope.context.crawler and school.levelCode != 'p'}">
                <div id="topCompare" style="float:left;" >
                    <school:compareSchool school="${school}"/>
                </div>
            </c:if>

            <c:set var="latestReviewsModel" value="${latestReviewsModel}"/>
            <c:if test="${(not empty latestReviewsModel) }">

                <c:choose>
                    <c:when test="${school.levelCode ne 'p' and school.type.schoolTypeName ne 'private'}">
                         <c:if test="${(not empty latestReviewsModel.latestRating) and
                                 (not empty latestReviewsModel.randomCategory) and
                                 (not empty latestReviewsModel.randomRating) and
                                 (not empty latestReviewsModel.comment)}">
                             <div id="parentReviews">
                                 <h2>Latest ${school.name} Parent Reviews</h2>
                                 <gsml:img src="/res/img/map/ratings_parent_city_${latestReviewsModel.latestRating}.gif" alt="" styleClass="rating" />
                                 <p class="callout">Parents at this school think <em>${latestReviewsModel.randomCategory}
                                     ${latestReviewsModel.randomRating}</em>
                                     <link:schoolProfileParentReview school="${school}" title="Parent Reviews">Learn more &#62;</link:schoolProfileParentReview>
                                 </p>
                                 <p>${latestReviewsModel.comment}</p>
                                 <link:schoolProfileParentReview school="${school}" title="Read all reviews">
                                     <c:choose>
                                         <c:when test="${latestReviewsModel.totalReviews eq 1}">Read the full review &#62;</c:when>
                                         <c:otherwise>Read all ${latestReviewsModel.totalReviews} reviews &#62;</c:otherwise>
                                     </c:choose>
                                 </link:schoolProfileParentReview >
                             </div>
                         </c:if>
                    </c:when>
                    <c:otherwise>
                        <c:if test="${latestReviewsModel.totalReviews > 0}">
                            <div id="parentReviewsRateIt">
                                <h2>Latest ${school.name} Parent Reviews</h2>
                                <c:forEach var="psReview" items="${latestReviewsModel.schoolReviews}">
                                    <gsml:img src="/res/img/map/ratings_parent_city_${psReview.psRating}.gif" alt="" styleClass="psRating" />
                                    <div class="psComment">${psReview.psComment}</div>
                                </c:forEach>
                                <div class="bottomParentReview">
                                    <div class="${latestReviewsModel.totalReviews eq 1 ? 'rateItInReviewSingle' : 'rateItInReview'}">
                                        <link:schoolProfileAddParentReview
                                                school="${school}"
                                                styleId="Latest_PR_RateIt"
                                                styleClass="submodal-344-362 GS_CI9_"
                                                onclick="onClick=Popup=window.open(this.href,'Popup',
                                                                     'toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no, width=344,height=362,left=50,top=50');
                                                                     return false;">
                                            <gsml:img src="/res/img/school/overview/submit_RateIt.gif"
                                                      alt="Rate It" />
                                        </link:schoolProfileAddParentReview>
                                    </div>
                                    <div class="psWithMore"> |
                                        <link:schoolProfileParentReview school="${school}" title="Read all reviews" >  <!-- styleClass="psWithMore" -->
                                            <c:choose>
                                                <c:when test="${latestReviewsModel.totalReviews eq 1}">Read the full review &#62;</c:when>
                                                <c:otherwise>Read all ${latestReviewsModel.totalReviews} reviews &#62;</c:otherwise>
                                            </c:choose>
                                        </link:schoolProfileParentReview>
                                    </div>
                                </div>

                                <c:if test="${(not empty latestReviewsModel.randomRating)}">
                                    <div class="psCallout">Parents at this ${(school.levelCode eq 'p')?'pre':''}school think <em>${latestReviewsModel.randomCategory}
                                        ${latestReviewsModel.randomRating}</em>
                                        <div id="psLearnMore">
                                            <link:schoolProfileParentReview school="${school}" title="Parent Reviews">Learn more &#62;</link:schoolProfileParentReview>
                                        </div>
                                    </div>
                                </c:if>
                            </div>
                        </c:if>
                    </c:otherwise>
                </c:choose>

             </c:if>

            <c:if test="${!requestScope.context.crawler}">
                <school:parentReviewForm school="${school}" pageName="overview"/>
            </c:if>


        <div id="surveyTeaser_wrapper">
            <link:schoolStartSurvey school="${school}" cpn="OnPage_Parentsurvey_Overview"
                                    id="GS_ParentSurvey.surveyTeaser">
                <gsml:img styleClass="surveyTeaser" src="/res/img/survey/promo/survey_overview.gif" alt="What is the scoop on ${school.name}?" />
            </link:schoolStartSurvey>
        </div>

        <c:set var="styleIdSuffix" value=""/>
        <c:if test="${school.levelCode != 'p' or (hasStudentData or hasTeacherData or hasProgramData or hasSurveyData)}">
            <div id="learnSchool">
                <c:set var="hasStudentData" value="${hasStudentData}" />
                <c:set var="hasTestData" value="${hasTestData}"/>
                <c:set var="hasAPExams" value="${hasAPExams}"/>
                <c:set var="hasTeacherData" value="${hasTeacherData}"/>
                <c:set var="finance" value="hide" />
                <c:set var="hasFinanceData" value="${hasFinanceData}" />
                <c:set var="hasSurveyData" value="${hasSurveyData}" />

                <h2>Learn About ${school.name}</h2>

                <c:if test="${hasProgramData}">
                    <link:schoolProfileCensus school="${school}"
                                              anchor="programs"
                                              styleClass="GS_CI9_"
                                              styleId="LearnMore_Module_Programs1${styleIdSuffix}">
                        <gsml:img src="/res/img/school/overview/learn_Programs.gif" alt="abc and programs" />
                    </link:schoolProfileCensus>
                    <p class="${(hasStudentData or hasTeacherData or hasSurveyData) ? 'dashed' : 'last'}">
                        <link:schoolProfileCensus school="${school}" anchor="programs"
                                                  styleClass="GS_CI9_"
                                                  styleId="LearnMore_Module_Programs2${styleIdSuffix}">${school.name} program stats</link:schoolProfileCensus>
                    </p>
                </c:if>

                <c:if test="${(school.type.schoolTypeName ne 'private') and hasTestData and (!empty gs_rating)}">
                    <link:schoolProfileTestscore school="${school}"
                                                 styleClass="GS_CI9_" styleId="LearnMore_Module_TestScores1${styleIdSuffix}">
                        <gsml:img src="/res/img/school/overview/learn_TestScores.gif" alt=""/>
                    </link:schoolProfileTestscore>
                    <p class="dashed">
                        <link:schoolProfileTestscore school="${school}"
                                                     styleClass="GS_CI9_"
                                                     styleId="LearnMore_Module_TestScores2${styleIdSuffix}">${school.name} test scores</link:schoolProfileTestscore>
                    </p>
                </c:if>

                <c:if test="${hasAPExams}">
                    <link:schoolProfileCensus school="${school}" anchor="ap"
                                              styleClass="GS_CI9_" styleId="LearnMore_Module_APExams1${styleIdSuffix}">
                        <gsml:img src="/res/img/school/overview/learn_APExams.gif" alt="" />
                    </link:schoolProfileCensus>
                    <p>
                        <link:schoolProfileCensus school="${school}" anchor="ap"
                                                  styleClass="GS_CI9_" styleId="LearnMore_Module_APExams2${styleIdSuffix}">${school.name} AP exams</link:schoolProfileCensus>
                    </p>
                </c:if>

                <c:if test="${hasTeacherData}">
                    <link:schoolProfileCensus school="${school}" anchor="teachers"
                                              styleId="LearnMore_Module_TeacherStats1${styleIdSuffix}" styleClass="GS_CI9_">
                        <gsml:img src="/res/img/school/overview/learn_TeacherStats.gif" alt="" />
                    </link:schoolProfileCensus>
                    <p class="${(hasStudentData or hasFinanceData) ? 'dashed' : 'last'}">
                        <link:schoolProfileCensus school="${school}" anchor="teachers"
                                                  styleId="LearnMore_Module_TeacherStats2${styleIdSuffix}"
                                                  styleClass="GS_CI9_">${school.name} teachers</link:schoolProfileCensus>
                    </p>
                </c:if>

                <c:if test="${school.type.schoolTypeName ne 'private'
                    and school.levelCode !='p'
                    and (state eq 'az' or state eq 'ca' or
                    state eq 'fl' or state eq 'il' or state eq 'nj' or state eq 'nv' or
                    state eq 'oh' or state eq 'tx')}">
                    <c:set var="finance" value="show" />
                </c:if>

                <c:if test="${(hasStudentData)}">
                    <link:schoolProfileCensus school="${school}" anchor="students"
                                              styleId="LearnMore_Module_StudentStats1${styleIdSuffix}" styleClass="GS_CI9_">
                        <gsml:img src="/res/img/school/overview/learn_StudentStats.gif" alt="" />
                    </link:schoolProfileCensus>
                    <p class="${(hasPrincipalView or ((finance eq 'show') and hasFinanceData) or hasSurveyData)? 'dashed' : 'last'}">
                        <link:schoolProfileCensus school="${school}" anchor="students"
                                                  styleId="LearnMore_Module_StudentStats2${styleIdSuffix}" styleClass="GS_CI9_">${school.name} students</link:schoolProfileCensus>
                    </p>
                </c:if>

                <c:if test="${(finance eq 'show') and (hasFinanceData)}">
                    <link:schoolProfileCensus school="${school}" anchor="finance"
                                              styleId="LearnMore_Module_SchoolFinance1${styleIdSuffix}" styleClass="GS_CI9_">
                        <gsml:img src="/res/img/school/overview/learn_SchoolFinance.gif" alt="" />
                    </link:schoolProfileCensus>
                    <p class="${(hasPrincipalView or hasSurveyData) ? 'dashed' : 'last'}">
                        <link:schoolProfileCensus school="${school}" anchor="finance"
                                                  styleId="LearnMore_Module_SchoolFinance2${styleIdSuffix}" styleClass="GS_CI9_">${school.name} spending per pupil</link:schoolProfileCensus>
                    </p>
                </c:if>

                <c:if test="${hasSurveyData}">
                    <c:choose>
                        <c:when test="${school.levelCode == 'p'}">
                            <link:surveyResults school="${school}" level="p" styleClass="GS_CI9_">
                                <gsml:img src="/res/img/school/overview/learn_more/teachingapproach.gif" alt="Teaching Approach" />
                            </link:surveyResults>
                            <p class="dashed">
                                <link:surveyResults school="${school}" level="p" styleClass="GS_CI9_">
                                    ${school.name} Teaching Approach
                                </link:surveyResults>
                            </p>

                            <link:surveyResults school="${school}" level="p" page="1" styleClass="GS_CI9_">
                                <gsml:img src="/res/img/school/overview/learn_more/socialdevelopment.gif" alt="Social Development" />
                            </link:surveyResults>
                            <p class="dashed">
                                <link:surveyResults school="${school}" level="p" page="1" styleClass="GS_CI9_">
                                    ${school.name} Social Development
                                </link:surveyResults>
                            </p>

                            <link:surveyResults school="${school}" level="p" page="2" styleClass="GS_CI9_">
                                <gsml:img src="/res/img/school/overview/learn_more/schedule_policies.gif" alt="Schedule and Policies" />
                            </link:surveyResults>
                            <p class="dashed">
                                <link:surveyResults school="${school}" level="p" page="2" styleClass="GS_CI9_">
                                    ${school.name} Schedule and Policies
                                </link:surveyResults>
                            </p>

                            <link:surveyResults school="${school}" level="p" page="3" styleClass="GS_CI9_">
                                <gsml:img src="/res/img/school/overview/learn_more/admissions.gif" alt="Admissions" />
                            </link:surveyResults>
                            <p class="last">
                                <link:surveyResults school="${school}" level="p" page="3" styleClass="GS_CI9_">
                                    ${school.name} Admissions
                                </link:surveyResults>
                            </p>
                        </c:when>
                        <c:otherwise>
                            <link:startSurveyResults school="${school}" styleClass="GS_CI9_">
                                <gsml:img src="/res/img/school/overview/learn_extracurricular.gif" alt="Learn Extracurricular" />
                            </link:startSurveyResults>
                            <p class="${(hasPrincipalView) ? 'dashed' : 'last'}">
                                <link:startSurveyResults school="${school}" styleClass="GS_CI9_">
                                    ${school.name} extracurriculars
                                </link:startSurveyResults>
                            </p>
                        </c:otherwise>
                    </c:choose>
                </c:if>

                <c:if test="${hasPrincipalView}">
                    <link:schoolProfilePrincipalView school="${school}"
                                                     styleId="LearnMore_Module_SchoolsView1${styleIdSuffix}" styleClass="GS_CI9_">
                        <gsml:img src="/res/img/school/overview/learn_SchoolsView.gif" alt="" />
                    </link:schoolProfilePrincipalView>
                    <p class="last">
                        <link:schoolProfilePrincipalView school="${school}"
                                                         styleId="LearnMore_Module_SchoolsView2${styleIdSuffix}"
                                                         styleClass="GS_CI9_">The inside scoop on ${school.name}</link:schoolProfilePrincipalView>
                    </p>
                </c:if>
            </div>
        </c:if>
            <c:if test="${!hasPrincipalView and school.levelCode != 'p'}">
                <div id="insideScoop">
                    <div class="overviewBorder">
                        <link:schoolProfileEspLogin school="${school}"
                                                    styleId="LearnMore_Module_ESP${styleIdSuffix}" styleClass="GS_CI9_">
                            <gsml:img src="/res/img/school/overview/esp.gif" alt="What's the inside scoop on this school? Principals and school officials, tell us here" />
                        </link:schoolProfileEspLogin>
                    </div>
                </div>
            </c:if>
        </div><!-- end: col_center -->

		<!-- begin right column -->
        <div id="col_right" class="noprint">
            <ad:setSlotPrefix slotPrefix="School_Profile_Page_Overview"/>

            <ad:AboveFold_300x250/>

            <div class="ad_middle">
                <c:choose>
                    <c:when test="${showSchoolChooserPackPromo}">
                        <promo:schoolChoicePackPromo schoolName="${school.name}" showBorder="${true}" showSchoolChoiceLink="${true}" schoolObjectForRedirect="${school}" showConfirmation="${not empty param.confirm and param.confirm eq 'true'}"/>
                    </c:when>
                    <c:otherwise>
                        <ad:Top_300x137/>
                    </c:otherwise>
                </c:choose>
            </div>

            <c:if test="${!requestScope.pageHelper.adFree and !requestScope.pageHelper.adServedByCobrand}">
                <!-- Kellogs widget -->
                <![CDATA[<script type="text/javascript">
                <!--
                function fetchKellogs() {
                    document.getElementById('kellogsWidgetWrapper').style.display='none';
                }
                -->
                </script>]]>
                <div id="kellogsWidgetWrapper">
                    <ad:BelowFold_300x250 showAdWord="${false}"/>
                </div>
                <![CDATA[<script type="text/javascript">
                <!--
                fetchKellogs();
                -->
                </script>]]>
            </c:if>

            <div class="belowAdWrapper">

                <c:if test="${empty param.hideMap}">
                    <school:nearbySchools school="${school}"/>
                </c:if>
            </div>
        </div>
    </div><!-- end: schoolOverview -->

    <c:if test="${school.levelCode ne 'p' and not empty requestScope.pageHelper.yahooRealEstateCity and not requestScope.context.cobranded}">
        <c:set var="yahooRealEstateCity" value='${requestScope.pageHelper.yahooRealEstateCity}' />
        <c:set var="yahooRealEstateURL" value='http://realestate.yahoo.com/${requestScope.context.stateOrDefault.longName}/${requestScope.pageHelper.yahooRealEstateCityEscaped}' />
        <div id="YahooRealEstateLink">
            <b>Are you relocating?</b> Learn about <link:movingWithKids>Moving With Kids</link:movingWithKids> | Read our <link:schoolChoiceCenter>School Choice Tips</link:schoolChoiceCenter> | Find <gsml:a href="${yahooRealEstateURL}" target="_blank">${yahooRealEstateCity} Real Estate</gsml:a>
        </div>
    </c:if>

    <h1 id="sfooter" class="sfooter">${gsweb:schoolPageTitle(school)}</h1>

</school:profile>

<mod:tracking pageName="${pageName}"
              hier1="School,SchoolProfileOverview,${gsweb:capitalize(school.type.schoolTypeName)}"
              school="${school}" />
</gsml:body>
</html>
</jsp:root>
