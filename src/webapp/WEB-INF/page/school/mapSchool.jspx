<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="1.2"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:gsweb="gstaglib"
          xmlns:promo="urn:jsptagdir:/WEB-INF/tags/promo"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:school="urn:jsptagdir:/WEB-INF/tags/school"
          xmlns:map="urn:jsptagdir:/WEB-INF/tags/map"
        >
    <pageHelper:setPathway pathway=""/>
    <html lang="en">

    <jsp:output doctype-root-element="html"
                doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
                doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>

    <jsp:directive.page contentType="text/html"/>

    <c:set var="school" value="${school}"/>
    <c:set var="mapSchools" value="${mapSchools}"/>
    <c:set var="city" value="${school.physicalAddress.city}"/>
    <c:set var="state" value="${school.databaseState.abbreviationLowerCase}"/>
    <c:set var="stateName" value="${school.databaseState.longName}"/>
    <c:set var="stateAbbrev" value="${requestScope.context.stateOrDefault.abbreviation}"/>
    <c:set var="addr" value="${city}, ${stateName} - ${stateAbbrev}"/>
    <c:set var="pageName" value="School Tab - Map" scope="request"/>
    <c:set var="hasPrincipalView" value="${hasPrincipalView}"/>
    <c:set var="gs_rating" value="${gs_rating}"/>
    <c:set var="parent_ratings" value="${parent_ratings}"/>

    <head>
        <title>Map of ${school.name} - ${addr}</title>
        <meta name="description"
              content="A map of ${school.name} located in ${city}, ${stateName} - ${stateAbbrev}, including a map of the nearby schools"/>
        <pageHelper:externalCss file="/res/css/ads.css"/>
        <pageHelper:externalCss file="/res/css/school/mapSchool.css"/>
        <school:profile2010ShareThisJavaScript/>
    </head>

    <gsml:body adPageName="schoolMap" pageLayout="nocol">

        <ad:setSlotPrefix slotPrefix="MapSchool"/>
        <school:profile2010 school="${school}" tab="schoolMap" omniturePageName="${pageName}">

            <div class="spacer_15"><!-- do not collapse --></div>
            <!-- being large Google map -->
            <div id="largeMap">
                <!-- being left column -->
                <div id="col_left">
                    <div id="nearbySchools">
                        <div class="header">
                            <h2>${school.name}</h2>
                            <link:mySchoolList styleClass="save"
                                               school="${school}"
                                               title="Save">
                                Save
                            </link:mySchoolList>
                        </div>
                        <!-- end: header -->

                        <p class="head_nearby">
                            <c:choose>
                                <c:when test="${school.levelCode == 'p'}">
                                    Nearby Preschools
                                </c:when>
                                <c:otherwise>
                                    Nearby ${levelLongName} Schools
                                </c:otherwise>
                            </c:choose>

                        </p>
                        <ul>
                            <c:if test="${hasNearby}">
                                <c:forEach items="${nearbySchools}" var="nearbySchool">
                                    <li>
                                        <link:schoolProfileOverview
                                                school="${nearbySchool.neighbor}"
                                                title="${nearbySchool.neighbor.name}">${nearbySchool.neighbor.name}</link:schoolProfileOverview>
                                        <c:if test="${not empty nearbySchool.distance}">
                                            <br/>
                                            <fmt:formatNumber value="${nearbySchool.distance}"
                                                              maxFractionDigits="1"
                                                              minFractionDigits="1"/>
                                            Miles&amp;#160;&amp;#160;|&amp;#160;&amp;#160;
                                        </c:if>
                                        <link:mySchoolList styleClass="saveLink"
                                                           school="${nearbySchool.neighbor}"
                                                           title="Save">
                                            Save
                                        </link:mySchoolList>
                                    </li>
                                </c:forEach>
                            </c:if>
                        </ul>
                    </div>
                    <!-- end: nearbySchools -->

                    <ul id="extraLinks">
                        <c:if test="${hasNearby and (school.levelCode != 'p')}">
                            <li id="nearMore"><link:schoolCompareSchool
                                    school="${school}">More nearby schools&amp;nbsp;&amp;gt;</link:schoolCompareSchool></li>
                        </c:if>

                        <li id="topRatedSchools"><link:city city="${city}"
                                                            state="${state}">Top-rated ${city} schools&amp;nbsp;&amp;gt;</link:city>
                        </li>
                    </ul>

                </div>
                <!-- end: col_left" -->

                <!-- begin center column -->
                <div id="col_center">
                    <div id="map">
                        &#160;
                        <noscript>JavaScript is required in order to view a map of the city and its
                            schools.
                        </noscript>
                    </div>
                    <map:oldSchool id="map"
                                tooltips="true"
                                schools="${mapSchools}"
                                school="${school}"/>
                </div>
                <!-- end: col_center -->

            </div>
            <!-- end: largeMap -->
            <br style="clear: left;"/>

        </school:profile2010>
        <mod:tracking pageName="${pageName}"
                      hier1="School,Map"
                      school="${school}"/>
    </gsml:body>
    </html>
</jsp:root>