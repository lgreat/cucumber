<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns="http://www.w3.org/1999/xhtml" version="2.0"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:promo="urn:jsptagdir:/WEB-INF/tags/promo"
          xmlns:school="urn:jsptagdir:/WEB-INF/tags/school"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          xmlns:gslink="urn:jsptagdir:/WEB-INF/tags/link"
          xmlns:profile="urn:jsptagdir:/WEB-INF/tags/school/profile"
          xmlns:gsweb="gstaglib"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
        >
<jsp:directive.page import="gs.data.school.School"/>
<jsp:directive.page import="gs.web.util.PageHelper"/>
<pageHelper:setPathway pathway="RESEARCH_COMPARE"/>

<jsp:output doctype-root-element="html"
            doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"

            doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>
<jsp:directive.page contentType="text/html"/>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<c:set var="state" value="${school.databaseState}"/>
<c:set var="city" value="${school.physicalAddress.city}"/>
<c:set var="headerLinkAnchor" value="from..HeaderLink"/>


<!-- determine the page name that is reported to omniture -->
<c:set var="pageName" value="Overview" scope="request"/>
<c:choose>
    <c:when test="${school.preschoolOnly}">
        <c:set var="pageName" value="Preschool Overview"/>
    </c:when>
    <c:when test="${school.type.schoolTypeName == 'private'}">
        <c:set var="pageName" value="Private School Overview"/>
    </c:when>
</c:choose>
<jsp:scriptlet>
    PageHelper.setPageName(request, "spp_overview");
    School school = (School) request.getAttribute("school");
    if (school != null) {
        PageHelper.setYahooRealEstateCity(request, school.getCity());
    }
</jsp:scriptlet>

<head>
    <meta name="decorator" content="standardDecorator-v1"/>
    <meta name="description" content="${gsweb:schoolPageDescription(school)}"/>
    <meta name="keywords" content="${gsweb:schoolPageKeywords(school)}"/>
    <script type="text/javascript" src="/res/js/school/profilePage.js"><!-- do not collapse --> </script>
    <title>School Profile</title>
</head>
<gsml:body adPageName="overview" pageLayout="overview">

<!-- Breadcrumbs -->
<div class="grid_24 clearfix">
    <ul class="none smaller bottom mbs">
        <li class="di"><link:home>Home</link:home> &amp;gt; </li>
        <c:choose>
            <c:when test="${state eq 'DC'}">
                <![CDATA[<li class="di" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">]]>
                <link:research state="${state}"
                               title="District of Columbia" markUpWithItemScopeUrl="true"><span
                        itemprop="title">District of Columbia</span></link:research> &amp;gt;
                <![CDATA[</li>]]>
                <![CDATA[<li class="di" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">]]>
                <c:choose>
                    <c:when test="${school.levelCode eq 'p'}">
                        <link:schools cityName="${city}" state="${school.physicalAddress.state}" levelCode="p"
                                      title="Washington, D.C. preschools" markUpWithItemScopeUrl="true"><span
                                itemprop="title">Washington, D.C. Preschools</span></link:schools>&amp;#160;
                    </c:when>
                    <c:otherwise>
                        <link:city city="${city}" state="${school.physicalAddress.state}"
                                   title="${city} schools" markUpWithItemScopeUrl="true"><span
                                itemprop="title">Washington, D.C. Schools</span></link:city>&amp;#160;
                    </c:otherwise>
                </c:choose>
                <![CDATA[</li>]]>
                <c:if test="${school.districtId != 0 and school.levelCode != 'p'}">
                    <li class="di">&amp;gt; <link:districtHome district="${school.district}"
                                                               title="District information">DCPS</link:districtHome>
                    </li>
                </c:if>
            </c:when>
            <c:otherwise>
                <![CDATA[<li class="di" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">]]>
                <c:choose>
                    <c:when test="${state eq 'NY' and city eq 'New York'}">
                        <link:research state="${state}"
                                       title="${state.longName}" markUpWithItemScopeUrl="true"><span
                                itemprop="title">${state.longName}</span></link:research> &amp;gt;
                    </c:when>
                    <c:otherwise>
                        <link:research state="${state}"
                                       title="${state.longName} schools" markUpWithItemScopeUrl="true"><span
                                itemprop="title">${state.longName} Schools</span></link:research> &amp;gt;
                    </c:otherwise>
                </c:choose>
                <![CDATA[</li>]]>
                <![CDATA[<li class="di" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">]]>
                <c:choose>
                    <c:when test="${school.levelCode eq 'p' and state eq 'NY' and city eq 'New York'}">
                        <link:schools cityName="${city}" state="${school.physicalAddress.state}" levelCode="p"
                                      title="${city} preschools" markUpWithItemScopeUrl="true"><span
                                itemprop="title">NYC Preschools</span></link:schools>&amp;#160;
                    </c:when>
                    <c:when test="${school.levelCode eq 'p'}">
                        <link:schools cityName="${city}" state="${school.physicalAddress.state}" levelCode="p"
                                      title="${city} preschools" markUpWithItemScopeUrl="true"><span
                                itemprop="title">${city} Preschools</span></link:schools>&amp;#160;
                    </c:when>
                    <c:when test="${state eq 'NY' and city eq 'New York'}">
                        <link:city city="${city}" state="${school.physicalAddress.state}"
                                   title="NYC schools" markUpWithItemScopeUrl="true"><span
                                itemprop="title">NYC Schools</span></link:city>&amp;#160;
                    </c:when>
                    <c:otherwise>
                        <link:city city="${city}" state="${school.physicalAddress.state}"
                                   title="${city} schools" markUpWithItemScopeUrl="true"><span
                                itemprop="title">${city} Schools</span></link:city>&amp;#160;
                    </c:otherwise>
                </c:choose>
                <![CDATA[</li>]]>
                <c:if test="${school.districtId != 0 and school.levelCode != 'p'}">
                    <li class="di">&amp;gt; <link:districtHome district="${school.district}"
                                                               title="District information"><c:out
                            value="${school.district.name}" escapeXml="true"/></link:districtHome>
                    </li>
                </c:if>
            </c:otherwise>
        </c:choose>
    </ul>
</div>
<!-- end: breadcrumbs -->

<!-- Begin profile header -->
<div class="grid_16 ptm">

    <div class="alpha grid_4">
        <!-- New GS Rating -->
        <!-- TODO: Placeholder for new GreatSchools Rating -->
        <div class="mod badge-x96">
            <div class="inner">
                <div class="bd">
                    <div class="horizon">
                        <div class="bd-inner">
                            <p class="number-x96">10</p>
                            <p class="scale-x96">out of 10</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <p class="tac small bottom pbs mbm">GreatSchools Rating</p>
    </div>

    <div class="grid_12 omega">
        <!-- School name and sub data -->
        <h2 class="mbm">${school.name}</h2>
        <div class="small mbs" style="height:23px;">
            <span class="dib" style="line-height: 24px;">
            <!-- School Type -->
            <c:if test="${school.levelCode ne 'p'}">
                ${gsweb:capitalize(school.type.schoolTypeName)}
            </c:if>
            <!-- Grade levels -->
            <c:choose>
                <c:when test="${school.levelCode eq 'p'}">
                    Preschool
                </c:when>
                <c:when test="${empty school.gradeLevels or school.gradeLevels eq 'n/a' or school.gradeLevels eq 'N/A'}">
                    <!-- Leave blank -->
                </c:when>
                <c:otherwise>
                    | ${school.gradeLevels}
                </c:otherwise>
            </c:choose>
            <!-- Enrollment -->
            <!-- TODO: Get this value from model -->
            <c:set var="enrollmentOrCapacity" value="${school.enrollmentOrCapacity}"/>
            <c:if test="${not empty enrollmentOrCapacity and enrollmentOrCapacity > 0}">
                | ${enrollmentOrCapacity} ${gsweb:pluralize(enrollmentOrCapacity, 'student')}
            </c:if>
            </span>
            <promo:facebookLikeButton showLongText="false" state="${school.databaseState}" schoolId="${school.id}"/>
        </div>

        <hr class="keyline1"/>

        <!-- tool links -->
        <div class="toolLinks">
            <ul class="none small mtm">
                <li>
                <span class="media">
                    <span class="img iconx16 i-16-save mrs"><!-- do not collapse --></span>
                    <link:mySchoolList styleClass="bd" school="${school}"
                                       onclick="return GS.showAddMslJoinHover(null, '${gsweb:escapeJavaScript(school.name)}', ${school.id}, '${school.databaseState}', this);"
                                       anchor="${headerLinkAnchor}"><strong>Save</strong></link:mySchoolList>
                </span>
                </li>
                <li class="mll">
                <span class="media">
                    <span class="img iconx16 i-16-email mrs"><!-- do not collapse --></span>
                    <a class="bd" href="javascript:void(0);"><strong>Send me updates</strong></a>
                </span>
                </li>
                <li class="mll">
                <span class="media">
                    <span class="img iconx16 i-16-review mrs"><!-- do not collapse --></span>
                    <a class="bd" href="javascript:void(0);"><strong>Write a review</strong></a>
                </span>
                </li>
                <!-- TODO: Generate compareNearbyString -->
                <c:if test="${not empty compareNearbyString}">
                    <c:set var="compareSource" value="overview"/>
                    <li class="mll">
                    <span class="media">
                        <span class="img iconx16 i-16-compare mrs"><!-- do not collapse --></span>
                        <link:compareSchools schools="${compareNearbyString}"
                                             source="sphead_${compareSource}_${school.databaseState}${school.id}"
                                             onclick="if (s.tl) {s.tl(this,'o','SchoolProfile_Compare_Inline_Link');} return true;"
                                             tab="overview"><strong>Compare schools</strong></link:compareSchools>
                    </span>
                    </li>
                </c:if>
            </ul>
        </div>

    </div>
    <div class="clear"><!-- do not collapse --></div>

    <jsp:useBean id="schoolProfileTabMap" class="java.util.HashMap" scope="request" />
    <c:set target="${requestScope.schoolProfileTabMap}" property="key" value="on"/>

    <c:forEach var="itemtab" items="${fn:split(param.tab,'_')}">
        <c:set target="${requestScope.schoolProfileTabMap}" property="${itemtab}" value="selected"/>
    </c:forEach>
    <profile:primary schoolName="${school.name}" schoolId="${school.id}" schoolState="${school.databaseState}"
                 tabName="${param.tab}"/>
</div>

<div class="grid_8">

    <!-- Map -->

    <c:set var="schoolAddress" value="${gsweb:escapeHtml(school.physicalAddress.asSingleLineString)}"/>
    <c:set var="schoolAddressWithName"
           value="${schoolAddress}+(${gsweb:escapeHtml(school.name)})"/>
    <!-- TODO: references mobile -->
    <c:set var="mapMarkerUrl"
           value="http://www.greatschools.org/res/mobile/img/map_pins/32x32/schoolRating_na.png"/>
    <c:set var="mapMarkerParam" value="icon:${mapMarkerUrl}|${schoolAddress}"/>

    <div class="media">
        <div class="img mrm">
            <div class="mod standard_1-1 mbs">
                <div class="inner">
                    <div class="bd">
            <a href="http://maps.google.com/?q=${schoolAddressWithName}">
                <img height="98" width="148" alt="Map thumbnail"
                     src="http://maps.googleapis.com/maps/api/staticmap?markers=${gsweb:urlEncode(mapMarkerParam)}&amp;size=148x98&amp;maptype=roadmap&amp;scale=1&amp;sensor=false"/>
            </a>
                    </div>
                </div>
            </div>

            <p class="smaller">
                <a href="javascript:void(0);">Larger map</a>
            </p>
        </div>


        <!-- Address, phone, fax, directions, homes for sale -->
        <div class="bd loud">
            <p class="small bottom mbm">${school.physicalAddress.street}

                <c:if test="${not empty school.physicalAddress.streetLine2 and school.physicalAddress.streetLine2 ne ','}">
                    <br/>
                    ${school.physicalAddress.streetLine2}
                </c:if>

                <br/>
                <span>${school.physicalAddress.city}</span>,
                <span>${school.physicalAddress.state.abbreviation} </span>
                <span>${school.physicalAddress.zip}</span>

                <c:if test="${not empty school.phone}">
                    <br/>
                    <strong>Phone: </strong>${school.phone}
                </c:if>

                <c:if test="${not empty school.fax}">
                    <br/>
                    <strong>Fax: </strong>${school.fax}
                </c:if>

                <c:if test="${not empty school.webSitePrettyUrl}">
                    <br/>
                    <a href="${school.webSitePrettyUrl}" target="_blank">School Website</a>
                </c:if>
            </p>

            <div>
                <div class="media">
                    <span class="img iconx16 i-16-getDirections mrs"><!-- do not collapse --></span>
                    <a class="bd small" href="http://maps.google.com/?daddr=${schoolAddressWithName}">Get directions</a>
                </div>

                <c:if test="${requestScope.context.showRealtorDotComPromos}">
                    <gslink:realtorDotComLink address="${school.physicalAddress}"
                                              customLinkSuffix="inlinelinkheader">Nearby homes for sale</gslink:realtorDotComLink>
                </c:if>
            </div>
        </div>
    </div>

    <div class="">
        Right column
        <c:set var="isDcNclbSchool" value="${school.physicalAddress.state eq 'DC' and (school.type.schoolTypeName eq 'public' or school.type.schoolTypeName eq 'charter') and school.levelCode ne 'p'}"/>
        <c:if test="${requestScope.context.showDcNclbModules and isDcNclbSchool}">
            <!-- WARNING: dcNclbReportCard.tagx IS SHARED WITH OTHER PAGES, Bracket all changes under style eq '2012' -->
            <school:dcNclbReportCard
                    school="${school}"
                    showAllSchoolLinks="${requestScope.context.showDcNclbAllSchoolLinks}"
                    schoolCodesToShow="${requestScope.context.dcNclbSchoolCodesToShow}"
                    districtCodesToShow="${requestScope.context.dcNclbDistrictCodesToShow}"
                    style="2012"
                    />
        </c:if>

    </div>
</div>

<!-- TODO: Finalize omniture -->
<div style="display: none;">
    <mod:tracking pageName="${pageName}"
                  hier1="School,SchoolProfileOverview,${gsweb:capitalize(school.type.schoolTypeName)}"
                  school="${school}" schoolGSRating="${gs_rating}" schoolPhotosTracking="${schoolPhotosTracking}"/>
</div>

</gsml:body>
</html>
</jsp:root>