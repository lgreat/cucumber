<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:content="urn:www.greatschools.org/taglib/content"
          xmlns:footer="urn:jsptagdir:/WEB-INF/tags/content"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:form="http://www.springframework.org/tags/form"
          xmlns:gsweb="gstaglib"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:cache="http://jakarta.apache.org/taglibs/cache-1.0"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          version="2.0" >
<pageHelper:setPathway pathway="COUNTDOWN_COLLEGE"/>
<jsp:directive.page contentType="text/html; charset=UTF-8"/>
<jsp:output doctype-root-element="html"
            doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
            doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>
<html lang="en">
<c:set var="stateOrDefault" value="${requestScope.context.stateOrDefault}" />
<c:set var="stateOrNull" value="${requestScope.context.state}" />
<c:set var="stateAbbrev" value="${stateOrDefault.abbreviationLowerCase}" />

<ad:setSlotPrefix slotPrefix="Parent_Review_Submit"/>
<pageHelper:hideFooterAd/>

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>${title}</title>
    <pageHelper:externalCss file="/res/css/school/parentReviews/submitParentFeedback.css"/>
    <pageHelper:externalJavascript file="/res/js/prototype.js"/>    

    <![CDATA[
    <script type="text/javascript">
        <!--
        Array.prototype.has = function(v){
            for (i=0; i < this.length; i++){
                if (this[i]==v) return true;
            }
            return false;
        }

        function adjustLeftColIE6() {
            if(navigator.userAgent.toLowerCase().indexOf('msie 6') != -1) {
                var rightcol = document.getElementById('right');
                var rightHeight = rightcol.scrollHeight;
                var leftcol = document.getElementById('leftcol');
                leftcol.style.height = (rightHeight-30)+'px';
            }
        }

        var cityHasSchoolsInCorrectLevel = true;
        var levelsInCity = [];

        function buildLevels(levels) {
            var strings = {'p':'preschools', 'e':'elementary', 'm':'middle','h':'high', 'e,m':'elementary or middle',
            'm,h':'middle or high', 'e,h':'elementary or high', 'e,m,h':'elementary, middle, or high',
            'p,e,m,h':'schools'};
            return strings[levels];
        }

        function stateChange(stateSelect, selectId, schoolsWrapper, chooseSchoolLabel) {
            var url = '/community/registrationAjax.page';
            var pars = 'state=' + stateSelect.value + "&type=city";
            $(selectId).innerHTML = '<select name="city" id="citySelect"><option value="">Loading ...</option></select>';
            $(schoolsWrapper).innerHTML = '<select class="selectSchool" name="sid" id="schoolSelect"><option value="">' + chooseSchoolLabel + '</option></select>';
            var myAjax = new Ajax.Updater (
                    selectId,
                    url,
                    {
                        method: 'get',
                        parameters: {
                            state : stateSelect.value,
                            type : 'city',
                            onchange : "changeFindCity(this, 'stateSelect', '${levelCodes}', 'schools', 'true', 'Choose school');"
                        }
                    });
        }

        function changeFindCity(citySelect, stateSelectId, levels, selectId, includePrivateSchools, chooseSchoolLabel) {
            var state = document.getElementById(stateSelectId).value;
            $(selectId).innerHTML = '<select class="selectSchool" name="sid" id="schoolSelect"><option value="">Loading ...</option></select>';
            new Ajax.Updater ( selectId, '/test/schoolsInCity.page', {
                method: 'get',
                parameters: {state : state, city : citySelect.value, levels: levels, includePrivateSchools: includePrivateSchools, chooseSchoolLabel: chooseSchoolLabel },
                onComplete: function(transport) {
                    if (transport.responseText.lastIndexOf("option") < 100) {
                        cityHasSchoolsInCorrectLevel = false;
                        var levs = buildLevels(levels);
                        if (levs.endsWith('schools')) {
                            alert( 'No ' + levs + ' found in this city. Please choose again.' );
                        } else {
                            alert( 'No ' + levs + ' schools found in this city. Please choose again.' );
                        }
                    } else {
                        cityHasSchoolsInCorrectLevel = true;
                    }
                }
            });
        }

        function checkSchoolSelected(elem) {
            var val = elem.sid;
            if (val.value == "") {
                alert("Please select a state, city and school.");
                return false;
            }
            return true;
        }

        -->
    </script>
    ]]>
</head>


<gsml:body adPageName="submitParentReview">

    <div id="pageWrapper">

        <h1>Help Other Parents Find a Preschool</h1>

        <div id="steps">

            <div class="step" id="step1">
                <div class="content">
                    <h2>You Tell Us About a Preschool</h2>

                    <p>It only takes a few minutes.</p>

                    <div id="chooseSchoolForm">
                        <gsweb:form action="/school/parentReviews/submit.page" method="post" id="form1" onsubmit="return checkSchoolSelected(this)">
                            <gsweb:stateSelector usingLongNames="true" state="${requestScope.context.state}"
                                                 onChange="stateChange(this, 'cities', 'schools', 'Choose school');"
                                                 styleId="stateSelect"
                                                 name="state"
                                                 useNoState="${empty requestScope.context.state}"
                                                 noStateLabel="Choose state"/>

                            <div id="cities">
                                <select name="city" tabindex="10" id="citySelect"
                                        onchange="changeFindCity(this, 'stateSelect', '${levelCodes}', 'schools', 'true', 'Choose school');">
                                    <option selected="selected" value="">Choose city</option>
                                    <c:forEach var="cityOption" items="${cities}">
                                        <![CDATA[<option value="${cityOption.name}">${cityOption.name}</option>]]>
                                    </c:forEach>
                                </select>
                            </div>

                            <div id="schools">
                                <select id="schoolSelect" name="sid" class="selectSchool">
                                    <option value="">Choose school</option>
                                </select>
                            </div>

                            <gsml:url var="go" value="/res/img/splash/go.gif"/>
                            <gsml:url var="goOver" value="/res/img/splash/goOver.gif"/>

                            <input id="goButton" type="image" src="${go}" alt="Submit"
                                   class="button" onmouseover="this.src='${goOver}';"
                                   onmouseout="this.src='${go}';"/>
                        </gsweb:form>
                    </div>
                </div>

            </div>

            <div class="step" id="step2">
                <div class="content">
                    <h2>We post it on GreatSchools</h2>
                    <p>We feature nearly 100,000 preschools.</p>
                </div>
            </div>

            <div class="step" id="step3">
                <div class="content">
                    <h2>All Parents Benefit</h2>
                    <p>They find the right preschool, thanks to your expertise.</p>
                </div>
            </div>

        </div>

        <div id="photo">
            <img src="/res/img/preschool/review/survey_landing_kids.jpg" alt="Children"/>
        </div>

    </div>

    <div style="display: none;">
        <mod:tracking pageName="${pageName}" hier1="${hier1}" schoolLevel="Preschool"/>
    </div>
</gsml:body>
</html>
</jsp:root>