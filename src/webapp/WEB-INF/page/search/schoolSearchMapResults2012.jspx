<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="2.0"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:search="urn:jsptagdir:/WEB-INF/tags/search"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:gslink="urn:jsptagdir:/WEB-INF/tags/link"
          xmlns:k12="urn:jsptagdir:/WEB-INF/tags/promo/k12"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:gsweb="gstaglib"
          xmlns:pagination="pagination"
          xmlns:school="urn:jsptagdir:/WEB-INF/tags/school"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          xmlns:compare="urn:jsptagdir:/WEB-INF/tags/compare">

<jsp:output doctype-root-element="html"
            doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
            doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>

<jsp:directive.page contentType="text/html"/>

<head>
    <c:if test="${not empty title}">
        <title>REDESIGN: ${title}</title>
    </c:if>
    <c:if test="${not empty metaDescription}">
        <meta name="description" content="${metaDescription}"/>
    </c:if>
    <c:if test="${not empty metaKeywords}">
        <meta name="keywords" content="${metaKeywords}"/>
    </c:if>

    <c:if test="${not empty relCanonical}">
        <link rel="canonical" href="${relCanonical}"/>
    </c:if>

    <c:if test="${isSearch}">
        <meta name="robots" content="follow,noindex"/>
    </c:if>

    <c:if test="${!isSearch}">
        <c:if test="${!page.lastPage}">
            <link rel="next"
                  href="${pagination:recordPageInUrl(page.nextPage, gsweb:getRequestURL(pageContext.request), 'offset')}"/>
        </c:if>
        <c:if test="${!page.firstPage}">
            <link rel="prev"
                  href="${pagination:recordPageInUrl(page.previousPage, gsweb:getRequestURL(pageContext.request), 'offset')}"/>
        </c:if>
    </c:if>

    <ad:enableGptAsynchronousMode/>

    <pageHelper:externalJavascript file="http://maps.google.com/maps/api/js?sensor=false&amp;libraries=geometry"/>
    <pageHelper:externalJavascript file="/res/js/googleMapsInfobox.min.js"/>
    <pageHelper:externalJavascript file="/res/js/gs_jquery_extensions.js"/>
    <pageHelper:externalJavascript file="/res/js/uri/uri.js"/>
    <pageHelper:externalJavascript file="/res/js/search/schoolSearchForm.js"/>

    <pageHelper:externalJavascript file="/res/js/util/htmlMirrors.js"/>
    <pageHelper:externalJavascript file="/res/js/search/filters.js"/>
    <pageHelper:externalJavascript file="/res/js/ui/contentDropdowns.js"/>
    <pageHelper:externalJavascript file="/res/js/search/compare.js"/>
    <pageHelper:externalJavascript file="/res/js/tracking/customLinks.js"/>
    <pageHelper:externalJavascript file="/res/js/search/schoolResults.js"/>
    <pageHelper:externalJavascript file="/res/js/map/schoolSearchMap2012.js"/>
    <pageHelper:externalJavascript file="/res/js/search/schoolSearchResultsPage2012.js"/>

    <pageHelper:externalJavascript file="/res/js/search/schoolSearchResultsTable2012.js"/>
    <pageHelper:externalJavascript file="/res/js/hogan.js"/>

    <!-- Following JS used by schoolSearchResultsTable.js: GS-11604 -->
    <pageHelper:externalJavascript file="/res/js/history.min.js"/>

    <k12:trafficDriverIncludes/>

    <!-- Allow interstitials for this page.
   Note the property in the db must still be enabled for an interstitial to appear
   GS-3852 -->
    <c:if test="${requestScope.context.interstitialEnabled}">
        <pageHelper:externalJavascript file="/res/js/interstitial.js"/>
        <pageHelper:addOnLoadHandler handler="doInterstitial('search')"/>
    </c:if>
    <script type="text/javascript">
        jQuery(function () {
            jQuery('#js-bubbleInfo-8').popup({appear:'below',leftPosition:-15,topPosition:8});
            jQuery('#js-bubbleInfo-9').popup({appear:'below',leftPosition:-8,topPosition:8});
        });
    </script>

</head>


<pageHelper:setPathway pathway="RESEARCH_COMPARE"/>
<ad:setSlotPrefix slotPrefix="Search_Site"/>

<c:choose>
    <c:when test="${commandAndFields.cityBrowse || commandAndFields.districtBrowse || commandAndFields.nearbySearchByLocation}">
        <c:set var="nearbyCitiesLabel" value="Nearby cities:"/>
        <c:set var="moreNearbyCitiesLabel" value="Nearby cities"/>
        <c:set var="nearbyDistrictsLabel" value="Nearby districts:"/>
        <c:set var="moreNearbyDistrictsLabel" value="Nearby districts"/>
    </c:when>
    <c:otherwise>
        <c:set var="nearbyCitiesLabel" value="Schools in city:"/>
        <c:set var="moreNearbyCitiesLabel" value="more cities"/>
        <c:set var="nearbyDistrictsLabel" value="Schools in district:"/>
        <c:set var="moreNearbyDistrictsLabel" value="more districts"/>
    </c:otherwise>
</c:choose>

<div class="grid_16 slStylesV1-0 slFormsV1-0 container_24">


<div class="grid_10 alpha">
    <search:schoolResultsFor_text/>
</div>

<div class="text3 grid_6 omega">
    <school:nearbyCitiesPopup/>
    <school:nearbyDistrictsPopup/>
</div>

<div class="alpha grid_16 omega">
    <school:findASchoolForm/>
</div>

<div class="spacer_15"><!-- do not collapse --></div>

<ad:adTag position="SponsoredSearch_Top_423x120"/>

<div class="alpha grid_16 omega">
    <div class="contain_6-1 pbs">
        <div class="fl">
            <a data-role="button" data-inline="true" class="but but-sm but-2 js-listResultsLink">List</a>  &amp;nbsp;
            <a data-role="button" data-inline="true" class="but but-sm but-2 js-mapResultsLink">Map</a>
        </div>

        <br class="clearfloat"/>
    </div>


    <div id="js-school-search-results-table-body" class="errorBox2" style="display: none;">
        <div class="media">
            <span class="sprite i-alert img"><!-- do not collapse --></span>

            <p class="formErrorText bd">No results match your selection. Change or remove filters to get more matches.</p>

        </div>
    </div>

    <div class="js-leftResultsGrid">
    <c:set var="searchResultsPagingSummary">
        <div class="js-search-results-paging-summary text3">
            Showing ${page.offset+1}-${page.lastOffsetOnPage+1} of <span id="total-results-count">${page.pager.totalItems}</span> schools
        </div>
    </c:set>

    <div class="line">
        <div class="unit size1of2">
            ${searchResultsPagingSummary}
        </div>
        <div class="unit size2of2 lastUnit">
            <div class="pagination js-pageNumbers" id="pagination">
                <search:easierPagination page="${page}" mode="offset" useJavascriptPaging="true" javascriptMethod="GS.search.results.pagination" />
            </div>
        </div>
    </div>

    <div id="js-showDistrictBoundaryLink" style="${(isCityBrowse eq true or isDistrictBrowse eq true or commandAndFields.nearbySearch eq true) ? '' : 'display:none;'}">
        <p class="medium">Go to the
            <c:choose>
                <c:when test="${fn:length(commandAndFields.levelCode.commaSeparatedString) > 1 || fn:length(commandAndFields.levelCode.commaSeparatedString) eq 0}">
                    <c:set var="districtBoundary" value="/school-district-boundaries-map/?lat=${commandAndFields.latitude}&amp;lon=${commandAndFields.longitude}&amp;level=e"/>
                    <a href="${districtBoundary}">district boundary tool</a>
                </c:when>
                <c:otherwise>
                    <c:set var="districtBoundary" value="/school-district-boundaries-map/?lat=${commandAndFields.latitude}&amp;lon=${commandAndFields.longitude}&amp;level=${commandAndFields.levelCode.commaSeparatedString}"/>
                    <a href="${districtBoundary}">district boundary tool</a>
                </c:otherwise>
            </c:choose>
            to see boundaries in this area.</p>
    </div>

    <c:set var="points" value="0"/>
    <c:set var="latLonExists" value="${false}"/>
    <c:set var="pointsArray">
        var points = [];
        <c:forEach var="school" items="${schoolSearchResults}">
            <c:set var="infoWindowMarkup">
                <div class="contain_7-1 js-schoolInfo">
                    <div class="inner">
                        <div class="line">
                            <div class="unit size4of7">
                                <div class="text2">
                                    <link:schoolProfileOverviewForPrimitives styleClass="js-overview-link"
                                                                             schoolId="${school.id}"
                                                                             databaseState="${school.databaseState}"
                                                                             name="${school.name}"
                                                                             physicalAddress="${school.address}"
                                                                             levelCode="${school.levelCode}">
                                        <strong>${school.name}</strong>
                                    </link:schoolProfileOverviewForPrimitives>
                                    <p class="small ac1">
                                        ${school.schoolType} ${school.grades.rangeString}
                                    </p>
                                    <!--<div class="clearfloat pbm">&lt;!&ndash; &ndash;&gt;</div>-->
                                    <p class="small">
                                        ${school.street}<br/>
                                        ${school.city}, ${school.databaseState} ${school.zip}
                                        <br/>
                                        <a href="http://maps.google.com/maps?saddr=&amp;daddr=${school.street}%20${school.city}%20${school.databaseState}%20${school.zip}"
                                           target="_blank">Get directions</a>
                                    </p>
                                </div>
                            </div>
                            <div class="unit size3of7 lastUnit">
                                <div class="smallText1-333 small pbs">
                                    <link:schoolProfileParentReview2010 levelCode="${school.levelCode}"
                                                                        state="${school.databaseState}" schoolId="${school.id}" styleClass="block"
                                                                        anchor="revPagination">
                                        <c:choose>
                                            <c:when test="${not empty school.parentRating}">
                                                <span class="sprite stars_sm_${school.parentRating}"><!-- do not collapse --></span>
                                            </c:when>
                                            <c:otherwise>
                                                <span class="sprite stars_sm_rate_it"><!-- do not collapse --></span>
                                            </c:otherwise>
                                        </c:choose>
                                    </link:schoolProfileParentReview2010>
                                </div>

                                <div class="smallText1-333 pbs">
                                    <c:set var="schoolKey" value="${school.databaseState}${school.id}"/>
                                    <c:choose>
                                        <c:when test="${school.levelCode eq 'p'}">
                                            <input id="${school.databaseState}${school.id}"
                                                   class="compare-school-checkbox" type="checkbox"
                                                   disabled="disabled" title="${preschoolNoCompareMessage}"/>
                                            <label class="smallText2-777"
                                                   for="${school.databaseState}${school.id}"
                                                   title="${preschoolNoCompareMessage}"><i>COMPARE</i></label>
                                        </c:when>
                                        <c:otherwise>
                                            <input id="${school.databaseState}${school.id}" class="js-compare-school-checkbox"
                                                   type="checkbox"/>
                                            <label class="js-compareLabel smaller"
                                                   for="${school.databaseState}${school.id}">COMPARE</label>
                                            <button class="js-compareButton button-1Ext-2" style="display: none;">COMPARE<br/>NOW</button>
                                        </c:otherwise>
                                    </c:choose>
                                </div>

                                <c:set var="mslHasSchool" value="${false}"/>
                                <c:forEach items="${mslSchools}" var="mslSchool">
                                    <c:if test="${mslSchool.schoolId eq school.id and mslSchool.state eq school.databaseState}">
                                        <c:set var="mslHasSchool" value="${true}"/>
                                    </c:if>
                                </c:forEach>

                                <c:set var="existsInMsl" value="none"/>
                                <c:set var="notInMsl" value="none"/>
                                <span class="media js-add-msl-${school.databaseState}${school.id} js-add-msl smaller">
                                    <c:choose>
                                        <c:when test="${mslHasSchool}">
                                            <c:set var="existsInMsl" value="block"/>
                                        </c:when>
                                        <c:otherwise>
                                            <c:set var="notInMsl" value="block"/>
                                        </c:otherwise>
                                    </c:choose>
                                    <span class="js-existsInMsl" style="display: ${existsInMsl};">
                                        <span class="sprite i-checkmark-sm"><!-- do not collapse --></span>
                                        <span class="msl-text">
                                            Added to <a href="/mySchoolList.page">My School List</a>
                                        </span>
                                    </span>
                                    <span class="js-notInMsl" style="display: ${notInMsl};">
                                        <span class="sprite i-add-sm mrgtop_2 img mrs"><!-- do not collapse --></span>

                                        <span class="js-msl-text bd">
                                            <a href="#" class="js-add-msl-link"
                                               id="js-add-msl-link-${school.databaseState}${school.id}"
                                               onclick="if(GS.showAddMslJoinHover('${omniturePageName}', '${gsweb:escapeJavaScript(school.name)}', ${school.id}, '${school.databaseState}', this) == false){
                                                            GS.map.getMap.addSavedSchool('js-add-msl-link-${school.databaseState}${school.id}');
                                                         }
                                                         return false;">
                                                     My School List
                                            </a>
                                        </span>
                                    </span>
                                </span>

                                <c:if test="${requestScope.context.showRealtorDotComPromos}">
                                    <div class="smallText1-333 smaller">
                                        <gslink:realtorDotComLink address="${school.address}"
                                                                  customLinkSuffix="inlinelinkheader"
                                                                  styleClass="sprite i-house-sm">Homes for sale</gslink:realtorDotComLink>
                                    </div>
                                </c:if>

                            </div>
                        </div>
                        <div class="clearfloat pbm"><!-- --></div>
                    </div>
                    <div class="arrow">
                        <div class="arrow-down-bg"><!-- not empty --></div>
                        <div class="arrow-down"><!-- not empty --></div>
                    </div>
                </div>
            </c:set>
            points.push({name:'${gsweb:escapeJavaScript(school.name)}', lat: ${school.latitude},
            lng: ${school.longitude}, gsRating: '${school.greatSchoolsRating}', schoolType: '${school.schoolType}',
            infoWindowMarkup: '${gsweb:escapeJavaScript(infoWindowMarkup)}', state: '${gsweb:escapeJavaScript(school.databaseState)}',
            id: '${school.id}'});
            <c:set var="points" value="${points + 1}"/>
        </c:forEach>

        <!-- Determine a location to center map on if there are no schools -->
        <c:choose>
            <c:when test="${not empty district and not empty district.lat and not empty district.lon}">
                var calculatedLat = ${district.lat};
                var calculatedLon = ${district.lon};
                <c:set var="latLonExists" value="${true}"/>
            </c:when>
            <c:when test="${not empty city and not empty city.lat and not empty city.lon}">
                var calculatedLat = ${city.lat};
                var calculatedLon = ${city.lon};
                <c:set var="latLonExists" value="${true}"/>
            </c:when>
            <c:when test="${not empty schoolSearchCommand.lat and not empty schoolSearchCommand.lon}">
                var calculatedLat = ${schoolSearchCommand.lat};
                var calculatedLon = ${schoolSearchCommand.lon};
                <c:set var="latLonExists" value="${true}"/>
            </c:when>
            <c:otherwise>
                var calculatedLat = 0;
                var calculatedLon = 0;
            </c:otherwise>
        </c:choose>
    </c:set>

    <!--${fn:length(pointsArray)}-->
    <c:choose>
        <!--<c:when test="${requestScope.schoolSearchCommand.view eq 'map'}">-->

        <c:when test="${fn:length(pointsArray) > 0 || latLonExists eq true}">
            <script type="text/javascript">
                ${pointsArray}
                $.getScript('/res/js/mobile/googleMapsInfobox.min.js').done(function() {
                    GS.map.getMap.initMap(points, calculatedLat, calculatedLon);
                });
            </script>
            <div data-role="content">
                <div id="js-map-canvas"><!-- no collapse --></div>
            </div>
        </c:when>
    </c:choose>
    </div>
</div>

<div id="js-schoolInfoBox" style="display: none;"><!-- not empty --></div>
<div id="js-infoBoxTemplate" style="display: none;">
    <div class="contain_7-1 js-schoolInfo">
        <div class="inner">
            <div class="line">
                <div class="unit size4of7">
                    <div class="text2">
                        <a href="" data-href="{{schoolUrl}}">
                            <strong>{{schoolName}}</strong>
                        </a>
                        <p class="small ac1">
                            {{schoolType}} {{gradesRange}}
                        </p>
                        <!--<div class="clearfloat pbm">&lt;!&ndash; &ndash;&gt;</div>-->
                        <p class="small">
                            {{street}}<br/>
                            {{city}}, {{state}} {{zip}}
                            <br/>
                            <a href=""
                               data-href="http://maps.google.com/maps?saddr=&amp;daddr={{street}}%20{{city}}%20{{state}}%20{{zip}}"
                               target="_blank">Get directions</a>
                        </p>
                    </div>
                </div>
                <div class="unit size3of7 lastUnit">
                    <div class="smallText1-333 small pbs">
                        <a href="" data-href="{{communityRatingUrl}}">
                            <span class="sprite stars_sm_{{parentRating}}"><!-- do not collapse --></span>
                        </a>
                    </div>

                    <div class="smallText1-333 pbs">
                        <input id="disabled-{{state}}{{id}}"
                               class="compare-school-checkbox" type="checkbox"
                               disabled="disabled" style="display: {{isPkCompare}}"/>
                        <label class="smallText2-777"
                               for="disabled-{{state}}{{id}}" style="display: {{isPkCompare}}"><i>COMPARE</i></label>
                        <input id="{{state}}{{id}}" class="js-compare-school-checkbox" type="checkbox" style="display: {{showCompare}}"/>
                        <label class="js-compareLabel" style="display: {{showCompare}}"
                               for="{{state}}{{id}}">COMPARE</label>
                        <button class="js-compareButton button-1Ext-2" style="display: none;">COMPARE<br/>NOW</button>
                    </div>

                    <span class="media js-add-msl js-add-msl-{{state}}{{id}} smaller">
                        <span class="js-existsInMsl" style="display: {{existsInMsl}}">
                            <span class="sprite i-checkmark-sm"><!-- do not collapse --></span>
                            <span class="msl-text">
                                Added to <a href="/mySchoolList.page">My School List</a>
                            </span>
                        </span>
                        <span class="js-notInMsl" style="display: {{notInMsl}}">
                            <span class="sprite i-add-sm mrgtop_2 img mrs"><!-- do not collapse --></span>
                            <span class="js-msl-text bd">
                                <a href="#" class="js-add-msl-link" id="js-add-msl-link-{{state}}{{id}}"
                                   onclick="if(GS.showAddMslJoinHover('{{omniturePageName}}', '{{jsEscapeName}}', {{id}}, '{{state}}', this) == false){
                                                GS.map.getMap.addSavedSchool('js-add-msl-link-{{state}}{{id}}');
                                            }
                                            return false;">
                                    My School List
                                </a>
                            </span>
                        </span>
                    </span>

                    <div class="smallText1-333 smaller" style="display: {{homesForSale}}">
                        <a href=""
                           data-href="http://www.realtor.com/realestateandhomes-search/{{zip}}?gate=gs&amp;amp;cid=PRT300014"
                           onclick="if (s.tl) {s.tl(this,'o', 'RealtorModule_{{omniturePageName}}_inlinelinkheader');} return true;" target="_blank"
                           rel="nofollow">
                            <span class="sprite i-house-sm"><!--not empty--></span>Homes for sale
                        </a>
                    </div>

                </div>
            </div>
            <div class="clearfloat pbm"><!-- --></div>
        </div>
        <div class="arrow">
            <div class="arrow-down-bg"><!-- not empty --></div>
            <div class="arrow-down"><!-- not empty --></div>
        </div>
    </div>
</div>

<compare:compareSchoolsLimitReachedHover/>

    <div id="js-redoSearch" style="display: none;">
        <div class="js-redobtn dn mvn pvn"><button class="but but-sm but-2">Redo Search</button></div>
        <p class="small_bold">Your search filters are unavailable for this area.</p>
        Redoing search in this area will remove all applied filters.
        <input type="hidden" value="0" id="js-redoLat"/>
        <input type="hidden" value="0" id="js-redoLng"/>
        <input type="hidden" value="0" id="js-redoState"/>
        <input type="hidden" value="0" id="js-redoCity"/>
        <input type="hidden" value="0" id="js-redoZipCode"/>
    </div>

</div>


<div class="grid_8 slStylesV1-0 container_24">
    <ad:AboveFold_300x250/>
    <div class="js-rightResultsGrid">
    <div class="text3">
        <label for="map-sort">Sort by: </label>
        <select id="map-sort" name="sortBy">

            <c:choose>
                <c:when test="${isNearbySearch}">
                    <c:choose>
                        <c:when test="${sort eq 'DISTANCE'}">
                            <option value="DISTANCE" selected="selected">Distance
                            </option>
                        </c:when>
                        <c:otherwise>
                            <option value="DISTANCE">Distance</option>
                        </c:otherwise>
                    </c:choose>

                    <c:choose>
                        <c:when test="${sort eq 'DISTANCE_DESCENDING'}">
                            <option value="DISTANCE_DESCENDING" selected="selected">Distance: Far to Near
                            </option>
                        </c:when>
                        <c:otherwise>
                            <option value="DISTANCE_DESCENDING">Distance: Far to Near</option>
                        </c:otherwise>
                    </c:choose>
                </c:when>
                <c:otherwise>
                    <c:choose>
                        <c:when test="${sort eq null}">
                            <option value="" selected="selected">Relevance</option>
                        </c:when>
                        <c:otherwise>
                            <option value="">Relevance</option>
                        </c:otherwise>
                    </c:choose>
                </c:otherwise>
            </c:choose>

            <c:choose>
                <c:when test="${sort eq 'SCHOOL_NAME_ASCENDING'}">
                    <option value="SCHOOL_NAME_ASCENDING" selected="selected">School name: A-Z</option>
                </c:when>
                <c:otherwise>
                    <option value="SCHOOL_NAME_ASCENDING">School name: A-Z</option>
                </c:otherwise>
            </c:choose>

            <c:choose>
                <c:when test="${sort eq 'SCHOOL_NAME_DESCENDING'}">
                    <option value="SCHOOL_NAME_DESCENDING" selected="selected">School name: Z-A</option>
                </c:when>
                <c:otherwise>
                    <option value="SCHOOL_NAME_DESCENDING">School name: Z-A</option>
                </c:otherwise>
            </c:choose>

            <c:choose>
                <c:when test="${sort eq 'GS_RATING_DESCENDING'}">
                    <option value="GS_RATING_DESCENDING" selected="selected">GreatSchools Rating: High to Low
                    </option>
                </c:when>
                <c:otherwise>
                    <option value="GS_RATING_DESCENDING">GreatSchools Rating: High to Low</option>
                </c:otherwise>
            </c:choose>

            <c:choose>
                <c:when test="${sort eq 'GS_RATING_ASCENDING'}">
                    <option value="GS_RATING_ASCENDING" selected="selected">GreatSchools Rating: Low to High
                    </option>
                </c:when>
                <c:otherwise>
                    <option value="GS_RATING_ASCENDING">GreatSchools Rating: Low to High</option>
                </c:otherwise>
            </c:choose>

            <c:choose>
                <c:when test="${sort eq 'PARENT_RATING_DESCENDING'}">
                    <option value="PARENT_RATING_DESCENDING" selected="selected">Community Rating: High to Low
                    </option>
                </c:when>
                <c:otherwise>
                    <option value="PARENT_RATING_DESCENDING">Community Rating: High to Low</option>
                </c:otherwise>
            </c:choose>

            <c:choose>
                <c:when test="${sort eq 'PARENT_RATING_ASCENDING'}">
                    <option value="PARENT_RATING_ASCENDING" selected="selected">Community Rating: Low to High
                    </option>
                </c:when>
                <c:otherwise>
                    <option value="PARENT_RATING_ASCENDING">Community Rating: Low to High</option>
                </c:otherwise>
            </c:choose>

        </select>
    </div>

    <hr class="keyline2"/>
    <c:choose>
        <!--<c:when test="${requestScope.schoolSearchCommand.view eq 'map'}">-->

        <c:when test="${fn:length(pointsArray) > 0 || latLonExists eq true}">
            <ul class = "schoolList" id = "js-schoolList" style="width: 290px">
                <c:forEach var="school" items="${schoolSearchResults}">
                    <li class="js-mouseover-open-bubble" id="school-listitem-${school.databaseState}-${school.id}">
                        <!--<div id="mapBubble_${school.databaseState}_${school.id}" class="schoolInfoWindow">-->
                        <link:schoolProfileOverviewForPrimitives styleClass="js-overview-link"
                                                                 schoolId="${school.id}"
                                                                 databaseState="${school.databaseState}"
                                                                 name="${school.name}"
                                                                 physicalAddress="${school.address}"
                                                                 levelCode="${school.levelCode}">
                            <p class="medium_bold">
                                ${school.name}
                            </p>
                        </link:schoolProfileOverviewForPrimitives>
                        <p class="medium ac1">
                            ${school.schoolType}, ${school.grades.rangeString} | ${school.city}, ${school.databaseState}
                        </p>

                        <c:if test="${school.distance ne null}">
                            <span class="fltrt">
                                ${gsweb:roundTwoDecimal(school.distance)} miles
                            </span>
                        </c:if>

                        <div class="img gsRating mrs">
                            <link:schoolProfileRating2010 state="${school.databaseState}" schoolId="${school.id}" levelCode="${school.levelCode}">
                                <c:choose>
                                    <c:when test="${school.schoolType} eq 'private'">
                                        <span class="fltlft sprite badge_sm_pr"><!-- do not collapse --></span>
                                    </c:when>
                                    <c:when test="${empty school.greatSchoolsRating}">
                                        <span class="fltlft sprite badge_sm_na"><!-- do not collapse --></span>
                                    </c:when>
                                    <c:otherwise>
                                        <span class="fltlft sprite badge_sm_${school.greatSchoolsRating}"><!-- do not collapse --></span>
                                    </c:otherwise>
                                </c:choose>
                            </link:schoolProfileRating2010>
                        </div>
                        <div class="bd brdlft-solid communityRating pts">
                            <link:schoolProfileParentReview2010 levelCode="${school.levelCode}" state="${school.databaseState}" schoolId="${school.id}" styleClass="block" anchor="revPagination">
                                <c:choose>
                                    <c:when test="${not empty school.parentRating}">
                                        <span class="sprite stars_sm_${school.parentRating}"><!-- do not collapse --></span>
                                    </c:when>
                                    <c:otherwise>
                                        <span class="sprite stars_sm_rate_it"><!-- do not collapse --></span>
                                    </c:otherwise>
                                </c:choose>
                            </link:schoolProfileParentReview2010>
                        </div>
                        <!--</div>-->
                    </li>
                </c:forEach>
            </ul>
        </c:when>
    </c:choose>

    <ul id="js-schoolListTemplate" style="display: none;">
        <li class="js-mouseover-open-bubble" id="school-listitem-{{state}}-{{id}}">
            <p class="medium_bold">
                <a href="" data-href="{{schoolUrl}}">
                    {{schoolName}}
                </a>
            </p>
            <p class="medium ac1">
                {{schoolType}}, {{gradesRange}} | {{city}}, {{state}}
            </p>
                <span class="fltrt" style="display: {{showDistance}}">
                    {{distance}} miles
                </span>
            <div class="img gsRating mrs">
                <a href ="" data-href="{{gsRatingUrl}}">
                    <span class="fltlft sprite badge_sm_{{gsRating}}"><!-- do not collapse --></span>
                </a>
            </div>
            <div class="bd brdlft-solid communityRating pts">
                <a href ="" data-href="{{communityRatingUrl}}">
                    <span class="sprite stars_sm_{{parentRating}}"><!-- do not collapse --></span>
                </a>
            </div>
        </li>
    </ul>

    <hr class="keyline2"/>
    <div class="unit size2of5 lastUnit">
        <label for="page-size">Display: </label>
        <select id="page-size" name="pageSize">
            <c:choose>
                <c:when test="${pageSize eq 25}">
                    <option value="25" selected="selected">25 schools</option>
                </c:when>
                <c:otherwise>
                    <option value="25">25 schools</option>
                </c:otherwise>
            </c:choose>
            <c:choose>
                <c:when test="${pageSize eq 50}">
                    <option value="50" selected="selected">50 schools</option>
                </c:when>
                <c:otherwise>
                    <option value="50">50 schools</option>
                </c:otherwise>
            </c:choose>
            <c:choose>
                <c:when test="${pageSize eq 100}">
                    <option value="100" selected="selected">100 schools</option>
                </c:when>
                <c:otherwise>
                    <option value="100">100 schools</option>
                </c:otherwise>
            </c:choose>
        </select>
    </div>
    </div>
    <ad:BelowFold_Top_300x125/>
</div>


<mod:tracking pageName="school search map page"/>
</jsp:root>