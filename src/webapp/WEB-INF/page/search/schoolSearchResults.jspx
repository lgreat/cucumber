<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="2.0"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:fmt="http://java.sun.com/jsp/jstl/fmt"
          xmlns:fn="http://java.sun.com/jsp/jstl/functions"
          xmlns:spring="http://www.springframework.org/tags"
          xmlns:promo="urn:jsptagdir:/WEB-INF/tags/promo"
          xmlns:search="urn:jsptagdir:/WEB-INF/tags/search"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:content="urn:jsptagdir:/WEB-INF/tags/content"
          xmlns:k12="urn:jsptagdir:/WEB-INF/tags/promo/k12"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:gsweb="gstaglib"
          xmlns:map="urn:jsptagdir:/WEB-INF/tags/map" xmlns:form="http://www.springframework.org/tags/form"
          xmlns:pagination="pagination"
        >

<jsp:output doctype-root-element="html"
            doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
            doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>

<jsp:directive.page contentType="text/html"/>

<head>
    <c:if test="${not empty title}">
        <title>${title}</title>
    </c:if>
    <c:if test="${not empty metaDescription}">
        <meta name="description" content="${metaDescription}"/>
    </c:if>
    <c:if test="${not empty metaKeywords}">
        <meta name="keywords" content="${metaKeywords}"/>
    </c:if>

    <c:if test="${not empty relCanonical}">
        <link rel="canonical" href="${relCanonical}"/>
    </c:if>

    <c:if test="${isSearch}">
        <meta name="robots" content="follow,noindex"/>
    </c:if>

    <c:if test="${!isSearch}">
        <c:if test="${!page.lastPage}">
            <link rel="next" href="${pagination:recordPageInUrl(page.nextPage, gsweb:getRequestURL(pageContext.request), 'offset')}"/>
        </c:if>
        <c:if test="${!page.firstPage}">
            <link rel="prev" href="${pagination:recordPageInUrl(page.previousPage, gsweb:getRequestURL(pageContext.request), 'offset')}"/>
        </c:if>
    </c:if>

    <pageHelper:externalJavascript file="/res/js/search/schoolSearchResults.js"/>
    <pageHelper:externalJavascript file="/res/js/search/schoolSearchResultsTable.js"/>
    <!-- Following JS used by schoolSearchResultsTable.js: GS-11604 -->
    <pageHelper:externalJavascript file="/res/js/history.min.js"/> <!-- TODO: Move this to bottom of page? -->

    <k12:trafficDriverIncludes/>

    <!-- Allow interstitials for this page.
     Note the property in the db must still be enabled for an interstitial to appear
     GS-3852 -->
    <c:if test="${requestScope.context.interstitialEnabled}">
        <pageHelper:externalJavascript file="/res/js/interstitial.js"/>
        <pageHelper:addOnLoadHandler handler="doInterstitial('search')"/>
    </c:if>
</head>

<pageHelper:setPathway pathway="RESEARCH_COMPARE"/>
<ad:setSlotPrefix slotPrefix="Search_Site"/>

<c:choose>
    <c:when test="${isCityBrowse || isDistrictBrowse || isFromByLocation}">
        <c:set var="nearbyCitiesLabel" value="Nearby cities:"/>
        <c:set var="moreNearbyCitiesLabel" value="more nearby cities"/>
        <c:set var="nearbyDistrictsLabel" value="Nearby districts:"/>
        <c:set var="moreNearbyDistrictsLabel" value="more nearby districts"/>
    </c:when>
    <c:otherwise>
        <c:set var="nearbyCitiesLabel" value="Schools in city:"/>
        <c:set var="moreNearbyCitiesLabel" value="more cities"/>
        <c:set var="nearbyDistrictsLabel" value="Schools in district:"/>
        <c:set var="moreNearbyDistrictsLabel" value="more districts"/>
    </c:otherwise>
</c:choose>

<div class="grid_16">

    <div class="spacer_15"><!-- do not collapse --></div>
    <c:set var="schoolResultsFor">
        <c:choose>
            <c:when test="${not empty searchString}"><c:out value="${searchString}" escapeXml="true"/></c:when>
            <c:otherwise>${schoolSearchResults[0].address.city}</c:otherwise>
        </c:choose>
    </c:set>
    <c:if test="${isSearch}">
        <div class="title2-333">
            <c:choose>
                <c:when test="${isNearbySearch and param.zipCode}">
                    ${nearbySearchTitlePrefix} near <span
                        class="title2-d61">${param.zipCode}</span>
                </c:when>
                <c:when test="${isNearbySearch eq true and not empty normalizedAddress}">
                    ${nearbySearchTitlePrefix} near <span
                        class="title2-d61">${normalizedAddress}</span>
                </c:when>
                <c:otherwise>
                    School results for <span
                        class="title2-d61">&amp;ldquo;${schoolResultsFor}&amp;rdquo;</span>
                </c:otherwise>
            </c:choose>
        </div>
        <c:if test="${nearbySearchIsEstablishment eq true and not empty param.searchQuery}">
            <div>
                Did you mean to search for a school/district named
                "<link:schoolSearch query="${param.searchQuery}" state="${state}">${param.searchQuery}</link:schoolSearch>"?
            </div>
        </c:if>
        <div class="spacer_15 brdbtm_solid-c6c6c6"><!-- do not collapse --></div>
        <div class="spacer_10"><!-- do not collapse --></div>
    </c:if>
    <c:if test="${isCityBrowse}">
        <div class="line">
            <div class="unit size1of2">
                <div class="title2-d61">${schoolResultsFor} Schools</div>
            </div>
            <div class="unit size1of2 lastUnit">
                <div class="smallAlertText fltrt">
                    View city information for <link:city city="${city.name}" state="${city.state}">${schoolResultsFor} </link:city><span class="alertDoubleArrow">&amp;raquo;</span>
                </div>
            </div>
        </div>
        <div class="spacer_10"><!-- do not collapse --></div>
    </c:if>
    <c:if test="${isDistrictBrowse}">
        <div class="line">
            <div class="unit size3of4">
                <div class="title2-d61">${fn:escapeXml(district.name)} Schools</div>
            </div>
            <div class="unit size1of4 lastUnit">
                <div class="smallAlertText fltrt">
                    <link:districtHome
                    district="${district}">View district information <span class="alertDoubleArrow">&amp;raquo;</span></link:districtHome>
                </div>
            </div>
        </div>
        <div class="spacer_10"><!-- do not collapse --></div>
    </c:if>

    <!-- nearby cities box -->
    <div class="text3">
        <c:if test="${fn:length(citySearchResults) gt 0}">
            ${nearbyCitiesLabel} <link:schools cityName="${citySearchResults[0].city}" state="${citySearchResults[0].state}">
                ${citySearchResults[0].city}, ${citySearchResults[0].state}</link:schools>
        </c:if>
        <c:if test="${fn:length(citySearchResults) gt 1}">
            | <link:schools cityName="${citySearchResults[1].city}" state="${citySearchResults[1].state}">
                ${citySearchResults[1].city}, ${citySearchResults[1].state}</link:schools>
        </c:if>
        <c:if test="${fn:length(citySearchResults) gt 2}">
            | <link:schools cityName="${citySearchResults[2].city}" state="${citySearchResults[2].state}">
                ${citySearchResults[2].city}, ${citySearchResults[2].state}</link:schools>
        </c:if>
        <c:if test="${fn:length(citySearchResults) gt 3}">
            | <div id="js-bubbleInfo-8"><span id="nearby-cities-link" class="js-trigger smallAlertText">${moreNearbyCitiesLabel} <span
                class="alertDoubleArrow">&amp;raquo;</span></span>

            <div id="nearby-cities" class="js-popup">
                <div id="popup-contents-8">
                    <span class="arrow-outline-top"><!-- do not collapse --></span>
                    <span class="arrow-top"><!-- do not collapse --></span>
                    <c:set var="openCloseTr">
                        <![CDATA[</tr><tr>]]>
                    </c:set>
                    <c:choose>
                        <c:when test="${fn:length(citySearchResults) lt 11}">
                            <c:set var="cityTableColumns" value="${1}"/>
                        </c:when>
                        <c:when test="${fn:length(citySearchResults) ge 11 and fn:length(citySearchResults) lt 21}">
                            <c:set var="cityTableColumns" value="${2}"/>
                        </c:when>
                        <c:otherwise>
                            <c:set var="cityTableColumns" value="${3}"/>
                        </c:otherwise>
                    </c:choose>
                    <c:set var="tableWidth" value="${132 * cityTableColumns}"/>
                    <c:if test="${fn:length(citySearchResults) > 0}">
                        <table cellspacing="0" width="${tableWidth}">
                            <tbody>
                            <c:set var="citiesPerColumn" value="${fn:length(citySearchResults)/3}"/>
                            <tr>
                                <c:forEach var="city" items="${citySearchResults}" begin="3"
                                           end="${fn:length(citySearchResults)-1}" varStatus="status">
                                    <td><link:schools cityName="${city.city}"
                                                   state="${city.state}">${city.city}, ${city.state}</link:schools></td>
                                    <c:if test="${(status.count+cityTableColumns) % cityTableColumns == 0}">
                                        ${openCloseTr}
                                    </c:if>
                                </c:forEach>
                            </tr>
                            </tbody>
                        </table>
                    </c:if>
                </div>
            </div>
        </div>
        </c:if>
    </div>

    <c:if test="${fn:length(districtSearchResults) gt 0}">
    <div class="spacer_5"><!-- do not collapse --></div>
    </c:if>

    <!-- nearby districts box -->
    <div class="text3">
        <c:if test="${fn:length(districtSearchResults) gt 0}">
            ${nearbyDistrictsLabel} <link:schools
                state="${districtSearchResults[0].state}"
                districtId="${districtSearchResults[0].id}"
                districtName="${districtSearchResults[0].name}"
                cityName="${districtSearchResults[0].city}">${districtSearchResults[0].name}</link:schools>
        </c:if>
        <c:if test="${fn:length(districtSearchResults) gt 1}">
            | <div id="js-bubbleInfo-9"><span id="nearby-districts-link" class="js-trigger smallAlertText">${moreNearbyDistrictsLabel} <span
                class="alertDoubleArrow">&amp;raquo;</span></span>

            <div id="nearby-districts" class="js-popup">
                <div id="popup-contents-9">
                    <span class="arrow-outline-top"><!-- do not collapse --></span>
                    <span class="arrow-top"><!-- do not collapse --></span>
                    <c:set var="openCloseTr">
                        <![CDATA[</tr><tr>]]>
                    </c:set>
                    <c:choose>
                        <c:when test="${fn:length(districtSearchResults) lt 5}">
                            <c:set var="districtTableColumns" value="${1}"/>
                        </c:when>
                        <c:otherwise>
                            <c:set var="districtTableColumns" value="${2}"/>
                        </c:otherwise>
                    </c:choose>
                    <c:set var="tableWidth" value="${198 * districtTableColumns}"/>
                    <c:if test="${fn:length(districtSearchResults) > 0}">
                        <table cellspacing="0" width="${tableWidth}">
                            <tbody>
                            <tr>
                                <c:forEach var="district" items="${districtSearchResults}" begin="1"
                                           end="${fn:length(districtSearchResults)-1}" varStatus="status">
                                    <td><link:schools state="${district.state}" districtId="${district.id}" districtName="${district.name}"
                                              cityName="${district.city}">${district.name}</link:schools></td>
                                    <c:if test="${(status.count+districtTableColumns) % districtTableColumns == 0}">
                                        ${openCloseTr}
                                    </c:if>
                                </c:forEach>
                            </tr>
                            </tbody>
                        </table>
                    </c:if>
                </div>
            </div>
        </div>
        </c:if>
    </div>

    <script type="text/javascript">
        jQuery(function () {
            jQuery('#js-bubbleInfo-8').popup({appear:'below',leftPosition:-15,topPosition:8});
            jQuery('#js-bubbleInfo-9').popup({appear:'below',leftPosition:-8,topPosition:8});
            jQuery('#filtersForm')[0].reset();
        });
    </script>

    <c:if test="${fn:length(districtSearchResults) gt 0 || fn:length(citySearchResults) gt 0}">
    <div class="spacer_15"><!-- do not collapse --></div>
    </c:if>

    <div id="js-searchFilterBox" class="alpha grid_5">
        <form id="filtersForm" action="">
        <!-- FILTER CHECKED LOGIC:
            Generally, a filter is pre-checked if there is no param specifying the filter.
            e.g. no levelCode param means include all level codes (no param means check ALL)
            HOWEVER, for by location searches (with lat/lon in params) we allow people to begin a search with all values
            filtered out (don't ask). Therefore, for by location searches no param means check NONE.
            In every case, if there is a param, then only the check boxes containing the param value are pre-checked.
        -->
        <div id="js-gradeLevels" class="mod">
            <div class="filter-hd">
                <h5>GRADE LEVEL</h5>
            </div>
            <div class="filter-bd smallAlertText">
                <div>
                    <c:choose>
                        <c:when test="${empty param.lat and (levelCode eq null or levelCode eq '') or
                        (fn:contains(levelCode,'p') and fn:contains(levelCode,'e') and fn:contains(levelCode,'m') and fn:contains(levelCode,'h'))}">
                            <input type="checkbox" checked="checked" name="gradeLevels" id="grade-level-all" value=""/>
                        </c:when>
                        <c:otherwise>
                            <input type="checkbox" name="gradeLevels" id="grade-level-all" value=""/>
                        </c:otherwise>
                    </c:choose>
                    <label for="grade-level-all">All Grade Levels</label>
                </div>
                <div>
                    <c:choose>
                        <c:when test="${empty param.lat and (levelCode eq null or levelCode eq '') or fn:contains(levelCode,'p')}">
                            <input type="checkbox" class="jq-grade-level" checked="checked" name="gradeLevels" id="grade-level-p" value="p"/>
                        </c:when>
                        <c:otherwise>
                            <input type="checkbox" class="jq-grade-level" name="gradeLevels" id="grade-level-p" value="p"/>
                        </c:otherwise>
                    </c:choose>
                    <label for="grade-level-p">Preschool</label>
                </div>
                <div>
                    <c:choose>
                        <c:when test="${empty param.lat and (levelCode eq null or levelCode eq '') or fn:contains(levelCode,'e')}">
                            <input type="checkbox" class="jq-grade-level" checked="checked" name="gradeLevels" id="grade-level-e" value="e"/>
                        </c:when>
                        <c:otherwise>
                            <input type="checkbox" class="jq-grade-level" name="gradeLevels" id="grade-level-e" value="e"/>
                        </c:otherwise>
                    </c:choose>
                    <label for="grade-level-e">Elementary School</label>
                </div>
                <div>
                    <c:choose>
                        <c:when test="${empty param.lat and (levelCode eq null or levelCode eq '') or fn:contains(levelCode,'m')}">
                            <input type="checkbox" class="jq-grade-level" checked="checked" name="gradeLevels" id="grade-level-m" value="m"/>
                        </c:when>
                        <c:otherwise>
                            <input type="checkbox" class="jq-grade-level" name="gradeLevels" id="grade-level-m" value="m"/>
                        </c:otherwise>
                    </c:choose>
                    <label for="grade-level-m">Middle School</label>
                </div>
                <div>
                    <c:choose>
                        <c:when test="${empty param.lat and (levelCode eq null or levelCode eq '') or fn:contains(levelCode,'h')}">
                            <input type="checkbox" class="jq-grade-level" checked="checked" name="gradeLevels" id="grade-level-h" value="h"/>
                        </c:when>
                        <c:otherwise>
                            <input type="checkbox" class="jq-grade-level" name="gradeLevels" id="grade-level-h" value="h"/>
                        </c:otherwise>
                    </c:choose>
                    <label for="grade-level-h">High School</label>
                </div>
            </div>
        </div>
        <div class="mod">
            <div class="filter-hd">
                <h5>SCHOOL TYPE</h5>
            </div>
            <div class="filter-bd smallAlertText">
                <div id="js-schoolTypes">
                    <div>
                        <c:choose>
                            <c:when test="${empty param.lat and (schoolType eq null or fn:length(schoolType) eq 0) or
                            (fn:contains(schoolType,'public') and fn:contains(schoolType,'charter') and (fn:contains(schoolType,'private') or isDistrictBrowse))}">
                                <input type="checkbox" checked="checked" name="st" id="school-type-all" value=""/>
                            </c:when>
                            <c:otherwise>
                                <input type="checkbox" name="st" id="school-type-all" value=""/>
                            </c:otherwise>
                        </c:choose>
                        <label for="school-type-all">All School Types</label>
                    </div>
                    <div>
                        <c:choose>
                            <c:when test="${empty param.lat and (schoolType eq null or fn:length(schoolType) eq 0) or fn:contains(schoolType,'public')}">
                                <input type="checkbox" class="jq-school-type" checked="checked" name="st" id="school-type-public" value="public"/>
                            </c:when>
                            <c:otherwise>
                                <input type="checkbox" class="jq-school-type" name="st" id="school-type-public" value="public"/>
                            </c:otherwise>
                        </c:choose>
                        <label for="school-type-public">Public</label>
                    </div>
                    <div>
                        <c:choose>
                            <c:when test="${empty param.lat and (schoolType eq null or fn:length(schoolType) eq 0) or fn:contains(schoolType,'charter')}">
                                <input type="checkbox" class="jq-school-type" checked="checked" name="st" id="school-type-charter" value="charter"/>
                            </c:when>
                            <c:otherwise>
                                <input type="checkbox" class="jq-school-type" name="st" id="school-type-charter" value="charter"/>
                            </c:otherwise>
                        </c:choose>
                        <label for="school-type-charter">Public Charter</label>
                    </div>
                    <c:if test="${!isDistrictBrowse}">
                        <div>
                            <c:choose>
                                <c:when test="${empty param.lat and (schoolType eq null or fn:length(schoolType) eq 0) or fn:contains(schoolType,'private')}">
                                    <input type="checkbox" class="jq-school-type" checked="checked" name="st" id="school-type-private" value="private"/>
                                </c:when>
                                <c:otherwise>
                                    <input type="checkbox" class="jq-school-type" name="st" id="school-type-private" value="private"/>
                                </c:otherwise>
                            </c:choose>
                            <label for="school-type-private">Private</label>
                        </div>
                    </c:if>
                </div>
                <!--<div id="js-affiliations">
                    <div>
                        <c:choose>
                            <c:when test="${affiliation eq null or fn:length(affiliation) eq 0 or fn:contains(affiliation,'religious')}">
                                <input type="checkbox" checked="checked" name="affiliation" id="affiliation-religious" value="religious"/>
                            </c:when>
                            <c:otherwise>
                                <input type="checkbox" name="st" id="affiliation-religious" value="religious"/>
                            </c:otherwise>
                        </c:choose>
                        <label for="affiliation-religious">Religious</label>
                    </div>
                    <div>
                        <c:choose>
                            <c:when test="${affiliation eq null or fn:length(affiliation) eq 0 or fn:contains(affiliation,'nonsectarian')}">
                                <input type="checkbox" checked="checked" name="affiliation" id="affiliation-nonsectarian" value="nonsectarian"/>
                            </c:when>
                            <c:otherwise>
                                <input type="checkbox" name="st" id="affiliation-nonsectarian" value="nonsectarian"/>
                            </c:otherwise>
                        </c:choose>
                        <label for="affiliation-nonsectarian">Nonsectarian</label>
                    </div>
                </div>-->
            </div>
        </div>
        
        <div class="mod">
            <div class="filter-hd">
                <h5>ENROLLMENT</h5>
            </div>
            <div class="filter-bd smallAlertText">
                <form:select path="schoolSearchCommand.schoolSize" id="schoolSizeSelect">
                    <form:option value="All" label="All school sizes"/>
                    <form:option value="UNDER_20" label="Under 20"/>
                    <form:option value="UNDER_50" label="Under 50"/>
                    <form:option value="UNDER_200" label="Under 200"/>
                    <form:option value="UNDER_500" label="Under 500"/>
                    <form:option value="UNDER_1000" label="Under 1000"/>
                    <form:option value="OVER_1000" label="1000 or more"/>
                </form:select>
            </div>
        </div>

        <c:if test="${isNearbySearch}">
        <div class="mod">
            <div class="filter-hd">
                <h5>DISTANCE</h5>
            </div>
            <jsp:scriptlet>
                int[] allDistance = new int[]{1, 2, 3, 4, 5, 10, 15, 20, 25, 30, 60};
                request.setAttribute("allDistance", allDistance);
            </jsp:scriptlet>
            <div class="filter-bd smallAlertText">
                <form:select path="schoolSearchCommand.distance" id="distanceSelect">
                    <c:forEach var="aDistance" items="${allDistance}">
                        <form:option value="${aDistance}" label="${aDistance} mile${aDistance eq '1' ? '' : 's'}"/>
                    </c:forEach>
                </form:select>
            </div>
        </div>
        </c:if>

        <!--<div class="mod">
            <div class="filter-hd">
                <h5>STUDENTS PER TEACHER</h5>
            </div>
            <div class="filter-bd smallAlertText">
                <form:select path="schoolSearchCommand.studentTeacherRatio" id="studentTeacherRatioSelect"  >
                    <form:option value="All" label="All"/>
                    <form:option value="UNDER_10" label="Under 10"/>
                    <form:option value="UNDER_15" label="Under 15"/>
                    <form:option value="UNDER_20" label="Under 20"/>
                    <form:option value="UNDER_25" label="Under 25"/>
                </form:select>
            </div>
        </div>-->

        <!--<div class="mod">
            <div class="filter-hd">
                <h5>PRESCHOOLS</h5>
            </div>
            <div class="filter-bd smallAlertText">
                <select name="lowestAge" id="lowestAgeSelect">
                    <option selected="${!lowestAge}">All</option>
                    <option value="UNDER_ONE" selected="${lowestAge eq 'UNDER_ONE'}">Under one year</option>
                    <option value="ONE" selected="${lowestAge eq 'ONE'}">One year</option>
                    <option value="TWO" selected="${lowestAge eq 'TWO'}">Two years</option>
                    <option value="THREE" selected="${lowestAge eq 'THREE'}">Three years</option>
                    <option value="FOUR_AND_ABOVE">Four years and up</option>
                </select>
            </div>
        </div>-->

        </form>

        <div class="spacer_15"><!-- do not collapse --></div>

        <ad:AboveFold_Left_160x600/>

    </div>

    <div class="grid_11 omega">
        <ad:adTag position="SponsoredSearch_Top_423x120"/>
        <ad:adTag position="SponsoredSearch_Top_423x68"/>
        <ad:adTag position="SponsoredSearch_Bottom_423x68"/>
        <c:choose>
            <c:when test="${page.pager.totalItems gt 0}">
                <search:schoolSearchResultsTable omniturePageName="${omniturePageName}"/>
            </c:when>
            <c:otherwise>
                <!-- Allow this page to load with 0 results -->
                <div id="js-school-search-results-table">
                    <search:schoolSearchNoResultsTable/>
                </div>
            </c:otherwise>
        </c:choose>
    </div>
</div>

<div class="grid_8">
    <ad:AboveFold_300x250/>

    <div class="mod standard">
        <div class="hd">
            <h3>Map of Results</h3>
        </div>
        <div class="mod_bd"><!-- do not collapse --></div>
    </div>

    <div id="nearbySchoolsSearchMap" class="border-c6">
        &#160;
        <noscript>JavaScript is required in order to view a map of the city and its
            schools.
        </noscript>
    </div>

    <map:schoolSearchMap
            id="nearbySchoolsSearchMap"
            tooltips="true"
            schools="${schoolSearchResults}"
            ratings="${ratings}"
            lat="${param.lat}"
            lon="${param.lon}"
            />

    <!-- end map -->

    <promo:zillow formattedUrl="${formattedUrl}" regionId="${regionID}" />
    <!-- Low Down module -->
    <content:makingSenseOfSchoolChoice style="2011"/>

    <!-- Community module -->
    <c:set var="recentDiscussions" value=""/>
    <c:if test="${not empty localBoardId and not empty localCityName}">
        <gsweb:currentAbsolutePath var="myUrl" urlEncode="true"/>
        <c:set var="recentDiscussions">
            <c:import
                    url="/community/profileRecentDiscussions.module?board_id=${localBoardId}&amp;limit=3&amp;uri=${myUrl}&amp;topic=${gsweb:urlEncode(localCityName)}&amp;discussionTopicFull=${gsweb:urlEncode(localCityName)}&amp;isLocal=true&amp;isFromProfile=false"/>
        </c:set>
    </c:if>
    ${recentDiscussions}

    <jsp:include page="/promo/emailSignUp.module"/>
</div>

<c:set var="omnitureLocale"><c:choose>
    <c:when test="${isCityBrowse}">${city.name}</c:when>
    <c:when test="${isDistrictBrowse}">${not empty district.physicalAddress ? district.physicalAddress.city : null}</c:when>
    <c:otherwise>${null}</c:otherwise>
</c:choose></c:set>

<mod:tracking pageName="${omniturePageName}"
              query="${omnitureQuery}"
              hier1="${omnitureHierarchy}"
              schoolType="${omnitureSchoolType}"
              schoolLevel="${omnitureSchoolLevel}"
              sortSelection="${omnitureSortSelection}"
              nearbySearchZipCode="${nearbySearchZipCode}"
              resultsPerPage="${omnitureResultsPerPage}"
              findASchoolByAddress="${omnitureAddressSearch}"
              findASchoolByName="${omnitureNameSearch}"
              locale="${omnitureLocale}"
        />

</jsp:root>