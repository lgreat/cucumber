<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:spring="http://www.springframework.org/tags"
          xmlns:link="urn:www.greatschools.net/taglib/link"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns="http://www.w3.org/1999/xhtml" version="2.0"
          xmlns:gsweb="gstaglib">
<jsp:directive.page contentType="text/html"/>
<html>
  <pageHelper:setPathway pathway="COMMUNITY_LANDING"/>
  <head>
      <title>Join - GreatSchools</title>
      <pageHelper:externalJavascript file="/res/js/prototype.js"/>
      <pageHelper:externalCss file="/res/css/community/registration/registration2.css"/>
      <script type="text/javascript">
          <![CDATA[
          <!--
                  function scrollToError() {
                      window.location.href = document.location.pathname + '#error';
                  }

                  function gradeChange(gradeSelect, childNum) {
                      if (gradeSelect.value == '') {
                          $('schoolDiv' + childNum).innerHTML = '<select name="school' + childNum + '" id="school' + childNum + '" class="selectChildSchool"><option value="">-' + '-</option></select>';
                          return;
                      }
                      var url = 'registration2Ajax.page';
                      var pars = 'state=' + $('state' + childNum).value;
                      pars += '&city=' + $('city' + childNum).value;
                      pars += '&grade=' + gradeSelect.value;
                      pars += '&childNum=' + childNum;
                      $('schoolDiv' + childNum).innerHTML = '<select name="school' + childNum + '" id="school' + childNum + '" class="selectChildSchool"><option value="">Loading ...</option></select>';
                      var myAjax = new Ajax.Updater (
                              'schoolDiv' + childNum,
                              url,
                              {
                                  method: 'get',
                                  parameters: pars
                              });
                  }

                  function cityChange(citySelect, childNum) {
                      resetGradeSchool(childNum);
                      $('cityText' + childNum).innerHTML = citySelect.value;
                      $('city' + childNum).value = citySelect.value;
                  }

                  function stateChange(stateSelect, childNum) {
                      resetGradeSchool(childNum);
                      $('cityText' + childNum).innerHTML = '-' + '-';
                      $('city' + childNum).value = '-' + '-';
                      $('stateText' + childNum).innerHTML = stateSelect.value;
                      $('state' + childNum).value = stateSelect.value;

                      var url = 'registration2Ajax.page';
                      var pars = 'state=' + stateSelect.value;
                      pars += '&childNum=' + childNum;
                      $('citySelectDiv' + childNum).innerHTML = '<select name="citySelect' + childNum + '" id="citySelect' + childNum + '" class="selectChildCity"><option value="">Loading ...</option></select>';
                      var myAjax = new Ajax.Updater (
                              'citySelectDiv' + childNum,
                              url,
                              {
                                  method: 'get',
                                  parameters: pars
                              });
                  }

                  function resetGradeSchool(childNum) {
                      $('grade' + childNum).value='';
                      gradeChange($('grade' + childNum), childNum);
                  }

                  function changeLocation(childNum) {
                      hideDiv('location' + childNum);
                      showDiv('chooseLocation' + childNum);
                  }

                  function changeLocationDone(childNum) {
                      hideDiv('chooseLocation' + childNum);
                      showDiv('location' + childNum);
                  }

                  function hideDiv(divId) {
                      $(divId).style.display = 'none';
                  }

                  function showDiv(divId) {
                      $(divId).style.display = 'block';
                  }

                  function doSingleClick(elem) {
                      elem.onclick = new Function('return false;');
                      $('registration2').submit();
                      return false;
                  }
          -->
          ]]>
      </script>
  </head>
  <gsml:body adPageName="registration2">
  <![CDATA[
  <!--[if IE]>
    <style type="text/css">
      #newsletters input {
        top: 4px;
      }

      #yesRecontact, #noRecontact {
        top: -1px;
      }

      #yesRecontactLabel, #noRecontactLabel {
        position: relative;
        top: -2px;
      }
    </style>
    <a name="error"></a>
  <![endif]-->
  ]]>

  <div id="outline"><!-- creates darker blue outer outline -->

  <link:webbyAwardThanks><gsml:img alt="The Webby Awards - Best Family and Parenting Site - 2007 People's Voice Awards"
                                   src="/res/img/promo/webby/reg_signuppage.gif"
                                   id="regWebbyAward"/></link:webbyAwardThanks>
  
  <h2><span>You're Almost Done Registering!</span></h2>

  <p>In the community, you'll be able to connect with other parents in your school and
      school district&amp;#151;to share success stories and join groups focused on helping your
      children thrive in school.</p>

  <p>We'll always keep your name and your email address private to preserve your anonymity on
      our site.</p>

  <h3>In the ${current_academic_year} school year, my children attend:</h3>

  <spring:hasBindErrors name="followUpCmd">
      <pageHelper:addOnLoadHandler handler="scrollToError();"/>
  </spring:hasBindErrors>
  <!-- begin registration form -->
  <gsweb:form id="registration2" action="/community/registration2.page" styleClass="registration" method="post">

  <!-- begin child module -->
  <!-- Default to always show one row -->
  <c:set var="loopTimes" value="1"/>
  <c:if test="${followUpCmd.userProfile.numSchoolChildren gt 1}">
      <c:set var="loopTimes" value="${followUpCmd.userProfile.numSchoolChildren}"/>
  </c:if>
  <c:forEach var="child" begin="1" end="${loopTimes}">
      <c:set var="gradeVal" value="${followUpCmd.students[child-1].grade}"/>
      <c:set var="schoolVal" value="${followUpCmd.schoolNames[child-1]}"/>
      <c:if test="${followUpCmd.students[child-1].state ne null}">
          <c:set var="stateVal" value="${followUpCmd.students[child-1].state}"/>
      </c:if>

      <div class="child">
          <label class="childNumber">Child #${child}:</label>
          <span id="chooseLocation${child}" class="chooseNewCity" style="display:none;">
              <span id="citySelectDiv${child}" style="display: inline;">
                  <select id="citySelect${child}" name="citySelect${child}" class="selectChildCity"
                          onchange="cityChange(this, ${child});">
                      <c:forEach var="cityOption" items="${followUpCmd.cityList[child-1]}">
                          <![CDATA[<option ]]>
                          <c:if test="${followUpCmd.cityNames[child-1] eq cityOption.name}">
                              selected="selected"
                          </c:if>
                          <![CDATA[ value="${cityOption.name}">${cityOption.name}</option>]]>
                      </c:forEach>
                  </select>
              </span>
              <gsweb:stateSelector state="${followUpCmd.students[child-1].state}"
                                   styleId="userState${child}" styleClass="selectChildState"
                                   name="state${child}"
                                   onChange="stateChange(this, ${child});"/>
              <a href="#" title="Choose current city/state"
                 onclick="changeLocationDone(${child}); return false;">Done</a>
          </span>

          <label id="location${child}" class="childCityLabel">
              <span id="cityText${child}">${followUpCmd.cityNames[child-1]}</span>,
              <span id="stateText${child}">${followUpCmd.students[child-1].state}</span>
              <input id="state${child}" type="hidden" name="state${child}"
                     value="${followUpCmd.students[child-1].state}"/>
              <input id="city${child}" type="hidden" name="city${child}" value="${followUpCmd.cityNames[child-1]}"/>
              <a href="#" title="Change city" onclick="changeLocation(${child}); return false;">Change city</a>
          </label>

          <label for="grade${child}" class="childGradeLabel"><span class="required">*</span>Grade</label>
          <gsweb:gradeSelector styleId="grade${child}" name="grade${child}"
                               styleClass="selectChildGrade" grade="${gradeVal}"
                               useNoGrade="true" useAlternateNames="true"
                               onChange="gradeChange(this, ${child});"/>

          <label for="school${child}" class="childSchoolLabel"><span class="required">*</span>School</label>
          <span id="schoolDiv${child}">
              <select name="school${child}" id="school${child}" class="selectChildSchool">
                  <c:if test="${schoolVal eq null or schoolVal eq ''}">
                      <option selected="selected" value="">--</option>
                  </c:if>
                  <c:forEach var="schoolOption" items="${followUpCmd.schools[child-1]}">
                      <![CDATA[<option ]]>
                      <c:if test="${schoolVal eq schoolOption.name}">
                          selected="selected"
                      </c:if>
                      <![CDATA[ value="${schoolOption.id}">${schoolOption.name}</option>]]>
                  </c:forEach>
              </select>
          </span>
          <gsml:errorMessage command="followUpCmd" field="students[${child-1}]" useImage="true"/>
          <!-- remember error for omniture tagging: see end of body. -->
          <spring:hasBindErrors name="followUpCmd">
              <c:if test="${errors.errorCount gt 0}">
                  <spring:bind path="followUpCmd.students[${child-1}]">
                      <c:if test="${status.errorMessage gt '' or status.errorCode gt ''}">
                          <c:set var="schoolError" value="true"/>
                      </c:if>
                  </spring:bind>
              </c:if>
          </spring:hasBindErrors>
      </div>
  </c:forEach>
  <!-- end: child module -->

  <!-- Yes ... willing to answer questions... -->
  <div id="parentAmbassador">
      <label class="description">Yes!
          I want to be a Parent Ambassador for the schools my children attend.
          I want to represent my children's schools on the GreatSchools Web site
          for other interested parents.</label>

      <gsml:radio name="recontactStr" value="y" styleId="yesRecontact"
                  checked="${followUpCmd.recontact eq null or followUpCmd.recontact eq 'y'}"/>
      <label for="yesRecontact" id="yesRecontactLabel">Yes</label>
      <gsml:radio name="recontactStr" value="n" styleId="noRecontact" styleClass="radioLabel"
                  checked="${followUpCmd.recontact eq 'n'}"/>
      <label for="noRecontact" id="noRecontactLabel">No</label>
  </div>

  <ul id="newsletters">
      <li>
          <label>Yes! Subscribe me to the "Best of GreatSchools Community" newsletter!</label>
          <gsml:checkbox name="newsletterStr" checked="${followUpCmd.newsletter eq true}"/>
      </li>
      <li>
          <label><span class="required">*</span>I am over 13 years of age and I agree to the
              <link:termsOfUse title="GreatSchools Terms of Service" target="_blank">Terms of Use</link:termsOfUse>,
              including the
              <gsml:popupWindow width="800" height="600" left="50" top="50"
                title="GreatSchools Community Standards"
                href="/cgi-bin/static/terms.html/$STATE#communityStandards"
                tabIndex="17">Community Guidelines</gsml:popupWindow>.
          </label>
          <gsml:checkbox name="termsStr" checked="${followUpCmd.terms eq true}"/>
          <gsml:errorMessage command="followUpCmd" field="terms" useImage="true"/>
      </li>
  </ul>

  <gsml:inputImage src="/res/img/community/registration/joinbutton.gif" alt="Join"
                   name="submit" onclick="return doSingleClick(this);" id="submitButton"/>


  <div class="join"><a href="communityLanding.page" title="Join the GreatSchools community"
                       onclick="return doSingleClick(this);">&amp;#160;</a></div>

  <spring:bind path="followUpCmd.user.id">
      <input type="hidden" name="id" value="${followUpCmd.user.id}"/>
  </spring:bind>

  <c:choose>
      <c:when test="${idString != null}">
          <input type="hidden" name="marker" value="${idString}"/>
      </c:when>
      <c:otherwise>
          <input type="hidden" name="marker" value="${followUpCmd.marker}"/>
      </c:otherwise>
  </c:choose>

  <spring:bind path="followUpCmd.redirect">
      <input type="hidden" name="redirect" value="${followUpCmd.redirect}"/>
  </spring:bind>

  </gsweb:form>
  </div>
  <!-- end: outline -->

  <c:set var="pageName" value="Registration page 2"/>
  <c:set var="hier" value="Entry"/>
  <spring:hasBindErrors name="followUpCmd">
      <c:if test="${errors.errorCount gt 0}">
          <c:choose>
              <c:when test="${schoolError gt ''}">
                  <c:set var="hier" value="Error Select child's school"/>
              </c:when>
              <c:otherwise>
                  <c:set var="hier" value="Error"/>
              </c:otherwise>
          </c:choose>
          <c:set var="pageName" value="Registration page 2 Error"/>
      </c:if>
  </spring:hasBindErrors>
  <mod:tracking pageName="${pageName}"
                pageType="account"
                hier1="Account,Registration,Page 2,${hier}"/>
  </gsml:body>
</html>
</jsp:root>