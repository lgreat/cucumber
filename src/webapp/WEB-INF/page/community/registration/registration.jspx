<!--
  Created by IntelliJ IDEA.
  User: UrbanaSoft
  Date: Jun 15, 2006
  Time: 9:21:58 AM
  To change this template use File | Settings | File Templates.
-->
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:spring="http://www.springframework.org/tags"
          xmlns:link="urn:www.greatschools.net/taglib/link"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns="http://www.w3.org/1999/xhtml" version="2.0"
          xmlns:gsweb="gstaglib">
    <jsp:directive.page contentType="text/html"/><html>
  <head>
      <title>Registration</title>
      <pageHelper:externalJavascript file="/res/js/prototype.js"/>
      <pageHelper:externalCss file="/res/css/community/registration/registration.css"/>
      <script type="text/javascript">
          function insertFormField() {
             $('regForm').innerHTML += '<![CDATA[<input type="hidden" name="javascriptEnabled" value="true"/>]]>';
          }
          function stateChange(stateSelect) {
              var url = 'registrationAjax.page';
              var pars = 'state=' + stateSelect.value;
              $('city').innerHTML = '<![CDATA[<select name="city" class="city"><option value="">Loading ...</option></select>]]>';
              var myAjax = new Ajax.Updater (
                      'city',
                      url,
                      {
                          method: 'get',
                          parameters: pars
                      });
          }

          function otherSelected() {
              hideDiv('numChildren');
              hideDiv('nextButton');
              showDiv('terms');
              showDiv('joinButton');
          }

          function parentSelected() {
              hideDiv('terms');
              hideDiv('joinButton');
              showDiv('numChildren');
              showDiv('nextButton');
          }

          function hideDiv(divId) {
              $(divId).style.display = 'none';
          }

          function showDiv(divId) {
              $(divId).style.display = 'block';
          }
      </script>
  </head>
  <gsml:body adPageName="registration">
    <pageHelper:addOnLoadHandler handler="insertFormField()"/>
    <table>
        <tr>
            <td class="join">
                <h2 class="join">Join</h2>
            </td>
            <td class="register">
            <div id="registerDiv" class="registerDiv">
                <h1 class="intro">Welcome to the GreatSchools Community!</h1>
                <p class="intro">You're joining a national network of parents who are passionate
                    about education. We're excited to have you!</p>
                <gsweb:form id="regForm" action="/community/registration.page" method="post">

                <gsml:errorMessage command="userCmd" field="gender"/>
                <label class="form left">I'm a (P)</label>
                <gsml:radio name="gender" value="f" styleId="mom" styleClass="form radio"
                            checked="${userCmd.gender eq 'f'}" onclick="parentSelected()"/>
                <label for="mom" class="form radio">Mom</label>
                <gsml:radio name="gender" value="m" styleId="dad" styleClass="form radio"
                            checked="${userCmd.gender eq 'm'}" onclick="parentSelected()"/>
                <label for="dad" class="form radio">Dad</label>
                <gsml:radio name="gender" value="u" styleId="other" styleClass="form radio"
                            checked="${userCmd.gender eq 'u'}" onclick="otherSelected()"/>
                <label for="other" class="form radio">Other</label>
                <br style="clear:left;"/>

                <gsml:errorMessage command="userCmd" field="firstName"/>
                <label for="firstName" class="form left">First name (P)</label>
                <spring:bind path="userCmd.user.firstName">
                    <input id="firstName" class="form firstName" type="text" name="${status.expression}"
                           value="${status.value}"/>
                </spring:bind>

                <br style="clear: left;"/>

                <gsml:errorMessage command="userCmd" field="screenName"/>
                <label for="screenName" class="form left">Screen name<br/><span class="screenNameSpec">(6-14 characters)</span></label>
                <spring:bind path="userCmd.screenName">
                    <input id="screenName" class="form screenName" type="text" name="${status.expression}"
                           value="${status.value}"/>
                </spring:bind>
                <br style="clear:left;"/>

                <gsml:errorMessage command="userCmd" field="email"/>
                <label for="email" class="form left">Email address (P)</label>
                <spring:bind path="userCmd.user.email">
                    <input id="email" class="form email" type="text" name="${status.expression}"
                           value="${status.value}"/>
                </spring:bind>

                <br style="clear: left;"/>
                <span class="privacy">We will NOT share your email address.
                    <gsml:popupWindow width="800" height="600" left="50" top="50"
                        href="/about/privacyStatement.page?state=$STATE">Privacy Policy</gsml:popupWindow>
                </span>

                <c:if test="${userCmd.user.id == null}">
                    <!-- This is a new user -->

                    <gsml:errorMessage command="userCmd" field="confirmEmail"/>
                    <label for="confirmEmail" class="form left">Re-type email address</label>
                    <spring:bind path="userCmd.confirmEmail">
                        <input id="confirmEmail" class="form email" type="text" name="${status.expression}"
                               value="${status.value}"/>
                    </spring:bind>

                    <br style="clear: left;"/>
                </c:if>

                <gsml:errorMessage command="userCmd" field="password"/>
                <label for="password" class="form left">Password (P)<br/><span class="passwordSpec">(6-14 characters)</span></label>
                <spring:bind path="userCmd.password">
                    <input id="password" class="form password" type="password" name="${status.expression}"
                           value="${status.value}"/>
                </spring:bind>

                <br style="clear: left;"/>

                <gsml:errorMessage command="userCmd" field="confirmPassword"/>
                <label for="confirmPassword" class="form left">Re-type password</label>
                <spring:bind path="userCmd.confirmPassword">
                    <input id="confirmPassword" class="form password" type="password"
                           name="${status.expression}" value="${status.value}"/>
                </spring:bind>

                <br style="clear: left;"/>

                <gsml:errorMessage command="userCmd" field="state"/>
                <gsml:errorMessage command="userCmd" field="city"/>
                <label class="form live">Where do you live?</label>
                <label for="userState" class="state">State</label>
                <spring:bind path="userCmd.state">
                    <gsweb:stateSelector state="${requestScope.context.stateOrDefault}" styleId="userState"
                                         styleClass="state" onChange="stateChange(this);"/>
                </spring:bind>

                <br style="clear: right;"/>

                <label for="citySelect" class="city">City</label>
                <div id="city" class="city">
                    <select id="citySelect" name="city" class="city">
                        <c:if test="${userCmd.cityList ne null and (userCmd.city eq null or userCmd.city eq '')}">
                            <option selected="selected" value="">Choose city</option>
                        </c:if>
                        <c:forEach var="cityOption" items="${userCmd.cityList}">
                            <![CDATA[<option ]]>
                            <c:if test="${userCmd.city eq cityOption.name}">
                                selected
                            </c:if>
                            <![CDATA[ value="${cityOption.name}">${cityOption.name}</option>]]>
                        </c:forEach>
                    </select>
                </div>

                <br style="clear: left;"/>
                <c:set var="termsStyle" value="display:none"/>
                <c:set var="childrenStyle" value="display:block"/>
                <c:if test="${userCmd.gender eq 'u'}">
                    <c:set var="termsStyle" value="display:block"/>
                    <c:set var="childrenStyle" value="display:none"/>
                </c:if>

                <div id="numChildren" style="${childrenStyle}">
                    <gsml:errorMessage command="userCmd" field="numSchoolChildren"/>
                    <label for="numSchoolChildren" class="form">How many children do you have in K-12 schools?</label>
                    <spring:bind path="userCmd.numSchoolChildren">
                        <select name="${status.expression}" id="numSchoolChildren" class="form small">
                            <c:if test="${userCmd.numSchoolChildren eq null or userCmd.numSchoolChildren eq -1}">
                                <![CDATA[<option selected value="-1">--</option>]]>
                            </c:if>
                            <c:forEach var="schoolChildOption" items="0,1,2,3,4,5,6,7,8,9">
                                <![CDATA[<option ]]>
                                <c:if test="${userCmd.numSchoolChildren eq schoolChildOption}">
                                    selected
                                </c:if>
                                <![CDATA[ value="${schoolChildOption}">${schoolChildOption}</option>]]>
                            </c:forEach>
                        </select>
                    </spring:bind>
                    <br style="clear:left;"/>
                </div>

                <div id="terms" style="${termsStyle}">
                    <gsml:errorMessage command="userCmd" field="terms"/>
                    <label class="form terms">I agree to the <link:termsOfUse>terms of service</link:termsOfUse></label>
                    <gsml:radio name="termsStr" value="y" styleId="yesTerms" styleClass="form radio"
                                checked="${userCmd.terms eq true}"/>
                    <label for="yesTerms" class="form radio">Yes</label>
                    <gsml:radio name="termsStr" value="n" styleId="noTerms" styleClass="form radio"
                                checked="${userCmd.terms eq false}"/>
                    <label for="noTerms" class="form radio">No</label>                    
                    <br style="clear:left;"/>
                </div>

                <spring:bind path="userCmd.redirectUrl">
                    <input id="redirectUrl" type="hidden" name="${status.expression}" value="${status.value}"/>
                </spring:bind>
                <br style="clear:left;"/>

                <div class="privacyIcon">Items with a (P) will be private and not viewable to other users.</div>

                <div id="joinButton" style="${termsStyle}">
                    <input class="submit join" type="submit" value="Join!" name="join"/>
                </div>
                <div id="nextButton" style="${childrenStyle}">
                    <input class="submit next" type="submit" value="Next &gt;" name="next"/>
                </div>

                <br style="clear:left;"/>
            </gsweb:form>
            </div>
            </td>
        </tr>
    </table>
  </gsml:body>
</html>
</jsp:root>