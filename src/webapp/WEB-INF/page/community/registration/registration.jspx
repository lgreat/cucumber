<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:spring="http://www.springframework.org/tags"
          xmlns:form="http://www.springframework.org/tags/form"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns="http://www.w3.org/1999/xhtml" version="2.0"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:gsweb="gstaglib">
    <jsp:directive.page contentType="text/html"/><html>
    <jsp:directive.page import="gs.web.util.PageHelper"/>
    <pageHelper:setPathway pathway="COMMUNITY_LANDING"/>
  <head>
      <title>Join - GreatSchools</title>
      <pageHelper:externalJavascript file="/res/js/prototype.js"/>
      <pageHelper:externalCss file="/res/css/community/registration/registration.css"/>
      <pageHelper:externalJavascript file="/res/js/community/registration/registration.js"/>
      <jsp:scriptlet>
          PageHelper.hideFooterAd(request);
      </jsp:scriptlet>
  </head>
  <gsml:body adPageName="registration" pageLayout="nocol">

  <ad:setSlotPrefix slotPrefix="CommunityRegistration"/>

    <![CDATA[
    <a name="error"></a>
    ]]>
    <!--
        <script>
            s.events="registration";
        </script>
    -->
    <div id="outline"><!-- creates darker blue outer outline -->
        <h2>Join GreatSchools!</h2>

        <div class="loginLink">
            Already a member? <link:loginOrRegister email="${userCmd.user.email}">Sign in.</link:loginOrRegister>
        </div>

        <gsml:img src="/res/img/community/registration/join_burst_transparent.gif"
                                  alt="Join" styleClass="joinMedallion"/>

        <div id="bulletsHeader">

            <ul id="bullets">
                <li>
                    <span class="strongHeader">Receive weekly emails</span> <span class="overrideGreenList"> with the tips and tools
                    you need to make smart choices about your child's education.</span>
                </li>
                <li>
                    <span class="strongHeader">Find the right school</span> <span class="overrideGreenList"> for your child and track its stats &amp;mdash; from
                    test scores to teacher quality.</span>
                </li>
                <li>
                    <span class="strongHeader">Share stories</span> <span class="overrideGreenList"> about your child's success in and out
                    of the classroom.</span>
                </li>
            </ul>

            <gsml:img src="/res/img/community/registration/mom_daughter_joininline.jpg"
                                  alt="Join" styleClass="headerImage"/>

        </div>

        <br/>

        <spring:hasBindErrors name="userCmd">
            <div class="genericError">There were some problems with your submission. Please make corrections noted below.</div>
            <pageHelper:addOnLoadHandler handler="scrollToError();"/>
        </spring:hasBindErrors>

    <!-- begin registration form -->
        <gsweb:form action="/community/registration.page" method="post" styleClass="registration" id="reg1Form">
        <p class="requiredFld">* Indicates a required field.</p>
                            
            <ul>
                <li>
                    <label for="firstName">First name <span class="required">*</span></label>
                    <spring:bind path="userCmd.user.firstName">
                        <input id="firstName" type="text" name="${status.expression}" value="${status.value}"
                               tabindex="1" onblur="validateFirstName();"/>
                    </spring:bind>
                    <gsml:feedbackMessage command="userCmd" field="firstName" styleId="firstNameMessage" styleClass="ajaxMessage ajaxError"/>
                </li>

                <li id="emailLine">
                    <label for="email">Email address <span class="required">*</span></label>
                    <spring:bind path="userCmd.user.email">
                        <input id="email" type="text" name="${status.expression}" value="${status.value}" tabindex="2"
                               onblur="validateEmail();"/>
                    </spring:bind>
                    <gsml:feedbackMessage command="userCmd" field="email" styleId="emailMessage" styleClass="ajaxMessage ajaxError"/>
                </li>

                <li id="usernameLine">
                    <label for="screenName">Username <span class="required">*</span></label>
                    <spring:bind path="userCmd.screenName">
                        <input id="screenName" type="text" name="${status.expression}" value="${status.value}"
                               tabindex="3" onblur="validateUN();"/>
                    </spring:bind>
                    <gsml:feedbackMessage command="userCmd" field="screenName" styleId="usernameMessage" styleClass="ajaxMessage ajaxError"/>
                    <span id="userDetails">6-14 characters</span>
                    <span id="userDisclaimer">Choose carefully&amp;#8212;This will be your public identity on GreatSchools</span>
                </li>

                <li>
                    <label for="password">Password <span class="required">*</span></label>
                    <spring:bind path="userCmd.password">
                        <input id="password" type="password" name="${status.expression}" value="" tabindex="4"
                                 onblur="validatePW();"/>
                    </spring:bind>
                    <gsml:feedbackMessage command="userCmd" field="password" styleId="passwordMessage" styleClass="ajaxMessage ajaxError"/>
                    <span id="passwordDetails">6-14 characters</span>
                </li>

                <li>
                    <label for="confirmPassword">Retype password <span class="required">*</span></label>
                    <spring:bind path="userCmd.confirmPassword">
                        <input id="confirmPassword" type="password" name="${status.expression}" value="" tabindex="5"
                                onblur="validateConfirmPW();"/>
                    </spring:bind>
                    <gsml:feedbackMessage command="userCmd" field="confirmPassword" styleId="confirmPWMessage" styleClass="ajaxMessage ajaxError"/>
                </li>

                <li id="genderLine">
                    <label>My gender</label>
                    <gsweb:maleFemaleSelector name="gender" selectedValue="${userCmd.gender}"
                                              useNoResponse="true" noResponseLabel="- Select one -"
                                              tabIndex="6"/>
                    <gsml:feedbackMessage command="userCmd" field="gender" styleClass="ajaxMessage ajaxError"/>
                </li>

                <c:set var="loopTimes" value="9"/>
                <li id="whereLiveLine">
                    <label>Where do you live?</label>
                    <!-- State -->
                    <spring:bind path="userCmd.state">
                        <gsweb:stateSelector state="${requestScope.context.state}" styleId="userState"
                                             onChange="parentStateChange(this,${loopTimes});" tabIndex="7"
                                             allowNoState="true" noStateLabel="--"/>
                    </spring:bind>
                    <gsml:feedbackMessage command="userCmd" field="state" styleClass="ajaxMessage ajaxError"/>

                    <!-- City -->
                    <span id="city">
                        <select id="citySelect" name="city" tabindex="8" onchange="gradeChange(${loopTimes},true);">
                            <c:if test="${userCmd.cityList ne null and (userCmd.city eq null or userCmd.city eq '')}">
                                <option selected="selected" value="">- Choose city -</option>
                            </c:if>
                            <c:forEach var="cityOption" items="${userCmd.cityList}">
                                <![CDATA[<option ]]>
                                <c:if test="${userCmd.city eq cityOption.name}">
                                    selected="selected"
                                </c:if>
                                <![CDATA[ value="${cityOption.name}">${cityOption.name}</option>]]>
                            </c:forEach>
                        </select>
                    </span>
                    <gsml:feedbackMessage command="userCmd" field="city" styleClass="ajaxMessage ajaxError"/>
                </li>

                <c:forEach var="child" begin="1" end="${loopTimes}">
                    <c:set var="gradeVal" value="${userCmd.studentRows[child-1].gradeSelected}"/>
                    <c:set var="schoolVal" value="${userCmd.studentRows[child-1].schoolIdSelected}"/>
                    <c:set var="cityVal" value="${userCmd.studentRows[child-1].citySelected}"/>
                    <c:set var="stateVal" value="${userCmd.state}"/>
                    <c:set var="locationOverrideDisplay" value="none"/>
                    <c:if test="${userCmd.studentRows[child-1].locationOverride eq true}">
                        <c:set var="stateVal" value="${userCmd.studentRows[child-1].stateSelected}"/>
                        <c:set var="locationOverrideDisplay" value="block"/>
                    </c:if>
                    <li id="childCityRow_${child}" style="display:${locationOverrideDisplay}">
                        <form:hidden path="userCmd.studentRows[${child-1}].locationOverride" id="locationOverride_${child}"/>
                        <label class="childSchoolLabel">State, City</label>
                        <gsweb:stateSelector state="${stateVal}" styleId="stateSelectChild_${child}"
                                             onChange="childStateChange(this,${child});" tabIndex="7"
                                             styleClass="childStates" name="state${child}"
                                             allowNoState="true" noStateLabel="--"/>
                         <span id="citySelectSpan_${child}" class="citySelectSpan">
                             <select id="citySelectChild_${child}" name="city${child}"
                                     tabindex="8" onchange="gradeChange(${child},false);">
                                 <c:if test="${empty cityVal}">
                                     <option selected="selected" value="">- Choose city -</option>
                                 </c:if>
                                 <c:forEach var="cityOption" items="${userCmd.studentRows[child-1].cities}">
                                     <![CDATA[<option ]]>
                                     <c:if test="${cityVal eq cityOption.name}">
                                         selected="selected"
                                     </c:if>
                                     <![CDATA[ value="${cityOption.name}">${cityOption.name}</option>]]>
                                 </c:forEach>
                             </select>
                         </span>
                    </li>
                    <c:set var="childRowDisplay" value="none"/>
                    <c:if test="${child eq 1 or not empty gradeVal}">
                        <!-- Always display first child row, and always display children with grades selected -->
                        <c:set var="childRowDisplay" value="block"/>
                    </c:if>
                    <li class="childRow" id="childRow_${child}" style="display:${childRowDisplay};">
                        <label for="school${child}" class="childSchoolLabel">Child ${child}</label>
                        <c:if test="${child lt 10 and empty userCmd.studentRows[child].gradeSelected}">
                            <span class="addAnotherChild" id="addAnotherChild_${child}">
                                <a href="#" onclick="addAnotherChild(${child}); return false;">+ Add another child</a>
                            </span>
                        </c:if>
                        <gsweb:gradeSelector styleId="grade${child}" name="grade${child}"
                                             styleClass="selectChildGrade" grade="${gradeVal}"
                                             useNoGrade="true" noGradeLabel="- Grade -"
                                             useAlternateNames="true" usePreK="true"
                                             onChange="gradeChange(${child},false);"/>

                        <span class="schoolContainer"> <!-- To allow for an expanding width school select -->
                            <span id="schoolDiv${child}">
                                <select name="school${child}" id="school${child}" class="selectChildSchool" onclick="childSchoolChange(${child}, false);">
                                    <c:if test="${schoolVal eq -1}">
                                        <option selected="selected" value="">- Choose School -</option>
                                    </c:if>
                                    <c:forEach var="schoolOption" items="${userCmd.studentRows[child-1].schools}">
                                        <![CDATA[<option ]]>
                                        <c:if test="${schoolVal eq schoolOption.id}">
                                            selected="selected"
                                        </c:if>
                                        <![CDATA[ value="${schoolOption.id}">${schoolOption.name}</option>]]>
                                    </c:forEach>
                                </select>
                            </span>
                            <gsml:errorMessage command="userCmd" field="studentRows[${child-1}]" useImage="true"/>
                            <!-- remember error for omniture tagging: see end of body. -->
                            <spring:hasBindErrors name="userCmd">
                                <c:if test="${errors.errorCount gt 0}">
                                    <spring:bind path="userCmd.studentRows[${child-1}]">
                                        <c:if test="${status.errorMessage gt '' or status.errorCode gt ''}">
                                            <c:set var="schoolError" value="true"/>
                                        </c:if>
                                    </spring:bind>
                                </c:if>
                            </spring:hasBindErrors>
                            <c:if test="${userCmd.studentRows[child-1].locationOverride eq false}">
                                <span class="changeChildCity" id="changeChildCity_${child}">
                                    <a href="#" onclick="changeChildCityAndState(${child}); return false;">Change city</a>
                                </span>
                            </c:if>
                        </span>
                        <gsml:feedbackMessage command="userCmd" field="studentRows[${child-1}]" styleId="childMessage${child}" styleClass="ajaxMessage ajaxError"/>
                    </li>
                </c:forEach>

                <!--<li id="newsletter">-->
                       <!--<form:checkbox path="userCmd.weeklyUpdatesNewsletter"-->
                                        <!--tabindex="11"/>-->
                    <!--<label for="newsletterField">Send me weekly updates about my child's school.</label>-->
                <!--</li>-->

                <li id="freeNewsletters">
                    <h2>Free Newsletters From GreatSchools</h2>
                    <div id="newsletterCol1">
                        <div class="newletterNoDivider gsweekly">
                            <gsml:img src="/res/img/email/boy_with_pen.jpg"
                                      alt="weeklyUpdatesImage" styleClass="weeklyUpdatesImage"/>
                            <div class="weeklyUpdates">
                                <h3>GreatSchools Weekly</h3>
                                <p class="newsletterText">The tips and tools you need to make smart choices about your
                                    child's education.</p>
                                <form:checkbox path="userCmd.newsletter"
                                        tabindex="11" id="newsletterField"/>
                                 <label for="newsletterField">Subscribe to this newsletter</label>
                            </div>
                        </div>
                        <div class="newletterDivider">
                            <gsml:img src="/res/img/email/boy_with_dad.jpg"
                                      alt="learningDisablitiesImage" styleClass="LearningDisabilitiesImage"/>
                            <div class="learningDisablities">
                                <h3>Help kids with learning difficulties</h3>
                                <p class="newsletterText">Get the resources you need to support your child with a
                                    learning disability or an attention problem.</p>
                                <form:checkbox path="userCmd.ldNewsletter"
                                        tabindex="12" id="ldNewsletterField"/>
                                <label for="ldNewsletterField">Subscribe to this newsletter</label>
                            </div>
                        </div>
                    </div>
                   
                    <div id="newsletterCol2">
                        <!-- GS-8784
                        <div class="brainDrainModule">
                            <gsml:img src="/res/img/email/boy_with_book.jpg"
                                      alt="weeklyUpdatesImage" styleClass="brainDrainImage"/>
                            <div class="brainDrain"><h3>Back-to-school countdown tips</h3>
                                <p class="newsletterText">
                                    Engage your child in learning over the break and ease him into
                                    the next school year with our daily tips and activities.
                                </p>
                                <form:checkbox path="userCmd.brainDrainNewsletter" id="brainDrainNewsletterField"
                                               onclick="displayStartWeekDropdowns();" tabindex="13"/>
                                <label for="brainDrainNewsletterField">Subscribe to this newsletter</label>
                                <c:set var="showWeeks" value="${ userCmd.brainDrainNewsletter ? 'showIt' : 'hideIt' }" />
                                <div id="weeks" class="${showWeeks}"><p class="newsletterText">Tell us when your child's school starts so we can personalize your newsletter!</p>
                                    <div id="brainDrainStartWeek">Week of:
                                    <form:select path="userCmd.startweek" id="startweek" tabindex="14">
                                        <form:option value="">Choose one</form:option>
                                        <form:option value="summer1">July 19</form:option>
                                        <form:option value="summer2">July 26</form:option>
                                        <form:option value="summer3">August 2</form:option>
                                        <form:option value="summer4">August 9</form:option>
                                        <form:option value="summer5">August 16</form:option>
                                        <form:option value="summer6">August 23</form:option>
                                        <form:option value="summer7">August 30</form:option>
                                        <form:option value="summer8">September 6</form:option>
                                    </form:select></div>
                                </div>
                            </div>
                        </div>
                        -->


                        <div class="newletterNoDivider valuableOffersWrapper">
                            <div class="valuableOffers">
                                <gsml:img src="/res/img/email/pencils.jpg"
                                  alt="weeklyUpdatesImage" styleClass="valuableOffersImage"/>
                                <h3>Send me valuable offers and information from GreatSchools partners</h3>
                                <form:checkbox path="userCmd.partnerNewsletter"
                                        tabindex="15" id="partnerNewsletterField"/>
                                <label for="partnerNewsletterField">Subscribe to this newsletter</label>
                            </div>
                        </div>
                    </div>
                </li>

                <spring:hasBindErrors name="userCmd">
                    <spring:bind path="userCmd.terms">
                        <c:set var="message">
                            <spring:message code="${status.errorCode}" text="${status.errorMessage}"/>
                        </c:set>
                        <c:if test="${message ne ''}">
                        <li id="termsError"><span class="termsWarning">${message}</span></li>
                        </c:if>
                    </spring:bind>
                </spring:hasBindErrors>

                <li id="terms">
                    <form:checkbox path="userCmd.terms"
                                        tabindex="16" id="termsField"/>
                    <label for="termsField" class="terms">I agree to the
                    <gsml:popupWindow width="800" height="600" left="50" top="50"
                            title="GreatSchools Terms of Use"
                            href="/terms/?state=$STATE"
                            tabIndex="17">GreatSchools Terms of Use</gsml:popupWindow>
                    and
                    <gsml:popupWindow width="800" height="600" left="50" top="50"
                            title="GreatSchools Community Standards"
                            href="/terms/?state=$STATE#communityStandards"
                            tabIndex="18">Community Guidelines</gsml:popupWindow>.
                    </label>
                    <span class="termsRequired">*</span>
                </li>

            </ul>
            <p class="privacyBox" id="privacyBox">Your privacy is important to us. GreatSchools
                <gsml:popupWindow width="800" height="600" left="50" top="50"
                    title="GreatSchools Privacy Policy"
                    href="/privacy/?state=$STATE"
                    tabIndex="19">Privacy Policy</gsml:popupWindow>
            </p>

            <gsml:input type="button"
                        name="submit"
                        value="Join now"
                        onclick="return validateAndSubmit(this);"
                        styleId="submitButton"
                        tabIndex="20"
                        styleClass="button-1"
                    />

            <spring:bind path="userCmd.redirectUrl">
                <input id="redirectUrl" type="hidden" name="${status.expression}" value="${status.value}"/>
            </spring:bind>

        </gsweb:form>
    </div>
        <!-- end: outline -->
    <c:set var="pageName" value="Registration page 1"/>
    <c:set var="hier" value="Entry"/>
    <spring:hasBindErrors name="userCmd">
        <c:if test="${errors.errorCount gt 0}">
            <spring:bind path="userCmd.city">
                <c:if test="${status.errorMessage gt '' or status.errorCode gt ''}">
                    <c:set var="cityError" value="true"/>
                </c:if>
            </spring:bind>
            <spring:bind path="userCmd.numSchoolChildren">
                <c:if test="${status.errorMessage gt '' or status.errorCode gt ''}">
                    <c:set var="numChildError" value="true"/>
                </c:if>
            </spring:bind>
            <c:choose>
                <c:when test="${cityError gt '' and numChildError gt ''}">
                    <c:set var="hier" value="Error Select City, # of children"/>
                </c:when>
                <c:when test="${cityError gt ''}">
                    <c:set var="hier" value="Error Select City"/>
                </c:when>
                <c:when test="${numChildError gt ''}">
                    <c:set var="hier" value="Error # of children"/>
                </c:when>
                <c:otherwise>
                    <c:set var="hier" value="Error"/>
                </c:otherwise>
            </c:choose>
            <c:set var="pageName" value="Registration page 1 Error"/>
        </c:if>
    </spring:hasBindErrors>

    <mod:tracking pageName="${pageName}"
                  hier1="Account,Registration,Page 1,${hier}"/>

  <script type="text/javascript">
      $('firstName').focus();
  </script>
  </gsml:body>
</html>
</jsp:root>