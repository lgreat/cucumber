<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:spring="http://www.springframework.org/tags"
          xmlns:link="urn:www.greatschools.net/taglib/link"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns="http://www.w3.org/1999/xhtml" version="2.0"
          xmlns:gsweb="gstaglib">
    <jsp:directive.page contentType="text/html"/><html>
    <pageHelper:setPathway pathway="COMMUNITY_LANDING"/>
  <head>
      <title>Join - GreatSchools</title>
      <pageHelper:externalJavascript file="/res/js/prototype.js"/>
      <pageHelper:externalCss file="/res/css/community/registration/registration.css"/>
      <script type="text/javascript">
          <![CDATA[
          <!--
          function scrollToError() {
              window.location.href = document.location.pathname + '#error';
          }

          function stateChange(stateSelect) {
              var url = 'registrationAjax.page';
              var pars = 'state=' + stateSelect.value;
              $('city').innerHTML = '<select name="city" class="selectCity"><option value="">Loading ...</option></select>';
              var myAjax = new Ajax.Updater (
                      'city',
                      url,
                      {
                          method: 'get',
                          parameters: pars
                      });
          }

          function determinePageState() {
              var otherGender = $('other');
              var numChildren = $('numSchoolChildren');

              if (otherGender.checked || numChildren.value == '0') {
                  // show terms and join, hide next
                  $('submitButton').src = '/res/img/community/registration/joinbutton.gif';
                  $('newsletter').show();
                  $('betaGroup').show();
                  $('terms').show();
                  if (otherGender.checked) {
                      // hide numChildren
                      $('numChildren').hide();
                  } else {
                      $('numChildren').show();
                  }
              } else {
                  // hide terms and join, show next
                  $('newsletter').hide();
                  $('betaGroup').hide();
                  $('terms').hide();
                  $('numChildren').show();
                  $('submitButton').src = '/res/img/community/registration/nextbutton.gif';
              }
          }

          function doSingleClick(element) {
              element.onclick = new Function('return false;');
              return true;
          }
          -->
          ]]>
      </script>
      <pageHelper:addOnLoadHandler handler="determinePageState()"/>
  </head>
  <gsml:body adPageName="registration">
    <![CDATA[
  <!--[if IE]>
    <style type="text/css">
      #outline li#newsletter, #outline li#betaGroup, #outline li#terms {
        height: 36px;
      }
    </style>
  <![endif]-->
  ]]>
    <![CDATA[
    <a name="error"></a>
    ]]>

    <div id="outline"><!-- creates darker blue outer outline -->
        <h2>Welcome to the GreatSchools Parent Community!</h2>

        <h3>You're joining a national network of parents who are passionate about education. We're
            excited to have you!</h3>

        <spring:hasBindErrors name="userCmd">
            <pageHelper:addOnLoadHandler handler="scrollToError();"/>
        </spring:hasBindErrors>
    <!-- begin registration form -->
        <gsweb:form action="/community/registration.page" method="post" styleClass="registration" id="reg1Form">
        <!-- init vars -->
            <c:set var="termsStyle" value="display:none"/>
            <c:set var="newsletterStyle" value="display:none"/>
            <c:set var="childrenStyle" value="display:inherit"/>
            <c:set var="submitSrc" value="/res/img/community/registration/nextbutton.gif"/>
            <c:if test="${userCmd.gender eq 'u'}">
                <c:set var="termsStyle" value="display:inherit"/>
                <c:set var="newsletterStyle" value="display:inherit"/>
                <c:set var="childrenStyle" value="display:none"/>
                <c:set var="submitSrc" value="/res/img/community/registration/joinbutton.gif"/>
            </c:if>

            <ul>
                <li id="genderLine">
                    <label><span class="required">*</span>I'm a</label>
                    <gsml:radio name="gender" value="f" styleId="mom" styleClass="radio" checked="${userCmd.gender eq 'f'}"
                                onclick="determinePageState();" tabIndex="1"/>
                    <label for="mom" class="radiolabel">Mom</label>
                    <gsml:radio name="gender" value="m" styleId="dad" styleClass="radio" checked="${userCmd.gender eq 'm'}"
                                onclick="determinePageState();" tabIndex="2"/>
                    <label for="dad" class="radiolabel">Dad</label>
                    <gsml:radio name="gender" value="u" styleId="other" styleClass="radio" checked="${userCmd.gender eq 'u'}"
                                onclick="determinePageState();" tabIndex="3"/>
                    <label for="other" class="radiolabel">Other</label>
                    <gsml:errorMessage command="userCmd" field="gender" useImage="true" styleClass="warning"/>
                </li>

                <li>
                    <label for="firstName"><span class="required">*</span>First name<gsml:img
                            src="/res/img/community/registration/icon_private_9x11.gif" alt="Private"
                            styleClass="private"/></label>
                    <spring:bind path="userCmd.user.firstName">
                        <input id="firstName" type="text" name="${status.expression}" value="${status.value}" tabindex="4"/>
                    </spring:bind>
                    <gsml:errorMessage command="userCmd" field="firstName" useImage="true" styleClass="warning"/>
                </li>

                <li>
                    <label for="screenName"><span class="required">*</span>Username</label>
                    <spring:bind path="userCmd.screenName">
                        <input id="screenName" type="text" name="${status.expression}" value="${status.value}" tabindex="5"/>
                    </spring:bind>
                    <gsml:errorMessage command="userCmd" field="screenName" useImage="true" styleClass="warning"/>
                    <span id="userDetails">6-14 characters</span>
                    <span id="userDisclaimer">Choose carefully&amp;#151;username can't be changed</span>
                </li>

                <li id="emailLine">
                    <label for="email"><span class="required">*</span>Email address<gsml:img
                            src="/res/img/community/registration/icon_private_9x11.gif" alt="Private"
                            styleClass="private"/></label>
                    <spring:bind path="userCmd.user.email">
                        <input id="email" type="text" name="${status.expression}" value="${status.value}" tabindex="6"/>
                    </spring:bind>
                    <gsml:errorMessage command="userCmd" field="email" useImage="true" styleClass="warning"/>
                    <span id="emailDisclaimer">We will not share your email.
                        <gsml:popupWindow width="800" height="600" left="50" top="50"
                                title="GreatSchools Privacy Policy"
                                href="/about/privacyStatement.page?state=$STATE"
                                tabIndex="18">GreatSchools Privacy Policy</gsml:popupWindow></span>
                </li>

                <li>
                    <label for="password"><span class="required">*</span>Password<gsml:img
                            src="/res/img/community/registration/icon_private_9x11.gif" alt="Private"
                            styleClass="private"/></label>
                    <spring:bind path="userCmd.password">
                        <input id="password" type="password" name="${status.expression}" value="" tabindex="7"/>
                    </spring:bind>
                    <gsml:errorMessage command="userCmd" field="password" useImage="true" styleClass="warning"/>
                    <span id="passwordDetails">6-14 characters</span>
                </li>

                <li>
                    <label for="confirmPassword"><span class="required">*</span>Re-type password</label>
                    <spring:bind path="userCmd.confirmPassword">
                        <input id="confirmPassword" type="password" name="${status.expression}" value="" tabindex="8"/>
                    </spring:bind>
                    <gsml:errorMessage command="userCmd" field="confirmPassword" useImage="true" styleClass="warning"/>
                </li>

                <li id="whereLiveLine">
                    <label>Where do you live?</label>
                    <!-- State -->
                    <label id="stateLabel"><span class="required">*</span>State</label>
                    <spring:bind path="userCmd.state">
                        <gsweb:stateSelector state="${requestScope.context.stateOrDefault}" styleId="userState"
                                             onChange="stateChange(this);" tabIndex="9"/>
                    </spring:bind>
                    <gsml:errorMessage command="userCmd" field="state" useImage="true" styleClass="warning"/>

                    <!-- City -->
                    <label id="cityLabel"><span class="required">*</span>City</label>
                    <span id="city">
                        <select name="city" tabindex="10">
                            <c:if test="${userCmd.cityList ne null and (userCmd.city eq null or userCmd.city eq '')}">
                                <option selected="selected" value="">Choose city</option>
                            </c:if>
                            <c:forEach var="cityOption" items="${userCmd.cityList}">
                                <![CDATA[<option ]]>
                                <c:if test="${userCmd.city eq cityOption.name}">
                                    selected="selected"
                                </c:if>
                                <![CDATA[ value="${cityOption.name}">${cityOption.name}</option>]]>
                            </c:forEach>
                        </select>
                    </span>
                    <gsml:errorMessage command="userCmd" field="city" useImage="true" styleClass="warning"/>
                </li>

                <li id="numChildren" style="${childrenStyle}">
                    <label><span class="required">*</span>How many children do you have in K-12 schools?</label>
                    <spring:bind path="userCmd.numSchoolChildren">
                        <select name="${status.expression}" id="numSchoolChildren"
                                onchange="determinePageState();" tabindex="11">
                            <c:if test="${userCmd.numSchoolChildren eq null or userCmd.numSchoolChildren eq -1}">
                                <option selected="selected" value="-1">--</option>
                            </c:if>
                            <c:forEach var="schoolChildOption" items="0,1,2,3,4,5,6,7,8,9">
                                <![CDATA[<option ]]>
                                <c:if test="${userCmd.numSchoolChildren eq schoolChildOption}">
                                    selected="selected"
                                </c:if>
                                <![CDATA[ value="${schoolChildOption}">${schoolChildOption}</option>]]>
                            </c:forEach>
                        </select>
                    </spring:bind>
                    <gsml:errorMessage command="userCmd" field="numSchoolChildren" useImage="true" styleClass="warning"/>
                </li>

                <li id="newsletter" style="${newsletterStyle}">
                    <label for="newsletterField">Yes!
                        Send me local updates and subscribe me to the "Best<br/>
                        of GreatSchools Community" newsletter!
                    </label>
                    <gsml:checkbox styleId="newsletterField" name="newsletterStr" 
                                   checked="${userCmd.newsletter eq true}" tabIndex="12"/>
                </li>

                <li id="betaGroup" style="${newsletterStyle}">
                    <label for="betaField">Yes!
                        I'd like to sign up for the GreatSchools beta group<br/>
                        and get a sneak peek at brand new community features!
                    </label>
                    <gsml:checkbox styleId="betaField" name="betaStr"
                                   checked="${userCmd.beta eq true}" tabIndex="13"/>
                </li>

                <li id="terms" style="${termsStyle}">
                    <label for="termsField" class="terms"><span class="required">*</span>I am over 13 years of age and I agree to the
                    <gsml:popupWindow width="800" height="600" left="50" top="50"
                            title="GreatSchools Terms of Use"
                            href="/cgi-bin/static/terms.html/$STATE"
                            tabIndex="19">GreatSchools <br/>Terms of Use</gsml:popupWindow>,
                    including the
                    <gsml:popupWindow width="800" height="600" left="50" top="50"
                            title="GreatSchools Community Standards"
                            href="/cgi-bin/static/terms.html/$STATE#communityStandards"
                            tabIndex="20">Community Guidelines</gsml:popupWindow>.
                    </label>
                    <gsml:checkbox styleId="termsField" name="termsStr"
                                   checked="${userCmd.terms eq true}" tabIndex="14"/>
                    <gsml:errorMessage command="userCmd" field="terms" useImage="true" styleClass="warning"/>
                </li>

                <li id="controlLine">
                    <p class="privacyBox">Items with a
                        <gsml:img src="/res/img/community/registration/icon_private_9x11.gif"
                                  alt="Private" styleClass="private"/>
                        will be private and not viewable by other users.</p>
                    <gsml:inputImage src="${submitSrc}" alt="submit"
                                     name="submit" onclick="return doSingleClick(this);" tabIndex="17"
                                     id="submitButton"/>
                </li>
            </ul>

            <spring:bind path="userCmd.redirectUrl">
                <input id="redirectUrl" type="hidden" name="${status.expression}" value="${status.value}"/>
            </spring:bind>

        </gsweb:form>
        <link:webbyAwardThanks><gsml:img alt="The Webby Awards - Best Family and Parenting Site - 2007 People's Voice Awards"
                                         src="/res/img/promo/webby/reg_signuppage.gif"
                                         id="regWebbyAward"/></link:webbyAwardThanks>
    </div>
        <!-- end: outline -->
    <c:set var="pageName" value="Registration page 1"/>
    <c:set var="hier" value="Entry"/>
    <spring:hasBindErrors name="userCmd">
        <c:if test="${errors.errorCount gt 0}">
            <spring:bind path="userCmd.city">
                <c:if test="${status.errorMessage gt '' or status.errorCode gt ''}">
                    <c:set var="cityError" value="true"/>
                </c:if>
            </spring:bind>
            <spring:bind path="userCmd.numSchoolChildren">
                <c:if test="${status.errorMessage gt '' or status.errorCode gt ''}">
                    <c:set var="numChildError" value="true"/>
                </c:if>
            </spring:bind>
            <c:choose>
                <c:when test="${cityError gt '' and numChildError gt ''}">
                    <c:set var="hier" value="Error Select City, # of children"/>
                </c:when>
                <c:when test="${cityError gt ''}">
                    <c:set var="hier" value="Error Select City"/>
                </c:when>
                <c:when test="${numChildError gt ''}">
                    <c:set var="hier" value="Error # of children"/>
                </c:when>
                <c:otherwise>
                    <c:set var="hier" value="Error"/>
                </c:otherwise>
            </c:choose>
            <c:set var="pageName" value="Registration page 1 Error"/>
        </c:if>
    </spring:hasBindErrors>
    <mod:tracking pageName="${pageName}"
                  hier1="Account,Registration,Page 1,${hier}"/>
  </gsml:body>
</html>
</jsp:root>