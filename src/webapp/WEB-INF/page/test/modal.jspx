<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="1.2"
          xmlns="http://www.w3c.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:yui="urn:jsptagdir:/WEB-INF/tags/yui"
        >
    <html lang="en">

    <jsp:output doctype-root-element="html"
                doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
                doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>

    <jsp:directive.page contentType="text/html"/>

    <head>
        <title>Modal Dialog Test Page</title>
    </head>

    <gsml:body adPageName="modal">
        <gsml:url var="mss" value="/community/newsletters/popup/mss/page1.page?schoolId=1&amp;state=CA"/>
        <gsml:url var="nthgrader" value="/community/newsletters/popup/newsletter.page"/>
        <gsml:url var="ratingPage" value="/school/updateRatings.page?id=1&amp;state=CA&amp;email=dlee@greatschools.net"/>
        <pageHelper:externalJavascript file="/res/js/submodal/submodal.js"/>
        <pageHelper:externalCss file="/res/css/submodal/submodal.css"/>
        <pageHelper:addOnLoadHandler handler="showPopWinOnExit('${mss}', 480, 500, null, 'hoverNewsMss');"/>
        <br/><br/><br/>
        <center>
            <h1>Modal Dialog Test Page</h1>
            <br/><br/>
            URL: http://localhost:8080/gs-web/test/modal.page
            <br/><br/>
            <!--
            <gsml:url var="mss" value="/cgi-bin/mss_popup1/ca?id=6544"/>
            <gsml:url var="mss" value="/test/boxes.page"/>
            -->
            <button onclick="showPopWin('${mss}', 480, 500, null, 'hoverNewsMss');">
                show
                mss modal</button>
            <button onclick="showPopWin('${nthgrader}', 480, 500, null, 'hoverNewsNth');">
                show
                nthgrader</button>

            <button onclick="showPopWin('${ratingPage}', 344, 362, null, 'ratingPage');">
                show rating page</button>

            <br/><br/>
            Note, the title doesn't show when running on localhost:8080 because of Javascript security. For titles to
            work in submodal the modal page must be on the same host as the parent page.
        </center>

        <yui:connectionManager/>
        <form>
<![CDATA[
<script type="text/javascript">
    function updateSchool(level) {
        var callback = {
            success: function(o) {
                var sltSchool = document.getElementById('sltSchool');
                var jsonResponse = o.responseText.parseJSON();
                var schools = jsonResponse.schools;
                sltSchool.options.length=0;
                for (var i=0; i<schools.length;i++) {
                    var option = document.createElement("OPTION");
                    sltSchool[i] = new Option(schools[i].name, schools[i].id);
                    sltSchool.add(option,i);
                }
            },
            failure: function(o) {
                alert(o);
            }
        };
        var sltState=document.getElementById('sltState');
        var sltCity=document.getElementById('sltCity');

        var state = sltState.options[sltState.selectedIndex].value;
        var city = sltCity.options[sltCity.selectedIndex].value;

        tempSelectMsg(document.getElementById('sltSchool'),'Retrieving schools');

        var url = "/school/ajaxFindSchoolAndCity.page?filter=school&level="+level+"&state="+state+"&city="+city;
        YAHOO.util.Connect.asyncRequest('GET', url, callback, "");
        return 0;
    }

    function updateCity(state) {
        var callback = {
            success: function(o) {
                var sltCity = document.getElementById('sltCity');
                var jsonResponse = o.responseText.parseJSON();
                var cities = jsonResponse.cities;
                sltCity.options.length=0;
                for (var i=0; i<cities.length;i++) {
                    var option = document.createElement("OPTION");
                    sltCity[i] = new Option(cities[i].name,cities[i].name);
                }
            },
            failure: function(o) {
                alert(o);
            }            
        };

        tempSelectMsg(document.getElementById('sltCity'),'Retrieving cities');

        var url = "/school/ajaxFindSchoolAndCity.page?filter=city&state=" + state;
        YAHOO.util.Connect.asyncRequest('GET', url, callback, "");
        return 0;
    }

    function resetLevelAndSchool() {
        var sltLevelCode = document.getElementById('sltLevelCode');
        sltLevelCode.selectedIndex = 0;
        var sltSchool = document.getElementById('sltSchool');
        sltSchool.selectedIndex = 0;
        sltSchool.innerHTML = "";
        return 0;
    }

    function tempSelectMsg(select,msg) {
        select.options.length=0;
        select.innerHTML="<option value=\"\">"+msg+"</option>";
        return 0;
    }
</script>
]]>

<select id="sltCity" onchange="resetLevelAndSchool();">
    <option value="1">city 1</option>
    <option value="2">city 2</option>
</select>
<select id="sltState" onchange="resetLevelAndSchool();updateCity(this.value);">
    <option value="CA">CA</option>
    <option value="NY">NY</option>
    <option value="TX">TX</option>
</select>
<select id="sltLevelCode" onchange="updateSchool(this.value);">
    <option value="--" selected="selected">--</option>
    <option value="e">Elementary</option>
    <option value="m">Middle</option>
    <option value="h">High</option>
</select>
<select id="sltSchool">
    <option value="--">--</option>
</select>
        </form>

        <br/><br/><br/>
    </gsml:body>
    </html>
</jsp:root>