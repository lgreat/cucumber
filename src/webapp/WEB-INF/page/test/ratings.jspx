<?xml version="1.0" encoding="UTF-8"?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="1.2"
          xmlns="http://www.w3.org/1999/xhtml"
          xmlns:c="http://java.sun.com/jsp/jstl/core"
          xmlns:gsml="urn:jsptagdir:/WEB-INF/tags/gsml"
          xmlns:mod="urn:jsptagdir:/WEB-INF/tags/mod"
          xmlns:promo="urn:jsptagdir:/WEB-INF/tags/promo"
          xmlns:pageHelper="urn:jsptagdir:/WEB-INF/tags/pageHelper"
          xmlns:link="urn:www.greatschools.org/taglib/link"
          xmlns:search="urn:jsptagdir:/WEB-INF/tags/search"
          xmlns:gsweb="gstaglib"
          xmlns:display="urn:jsptld:http://displaytag.sf.net"
          xmlns:ad="urn:jsptagdir:/WEB-INF/tags/ad"
          xmlns:school="urn:jsptagdir:/WEB-INF/tags/school"
          xmlns:content="urn:jsptagdir:/WEB-INF/tags/content"
          xmlns:ratings="urn:jsptagdir:/WEB-INF/tags/ratings"
          xmlns:spring="http://www.springframework.org/tags"

        >
    <jsp:useBean id="communityUtil" class="gs.data.util.CommunityUtilBean"/>

<html lang="en">

<jsp:output doctype-root-element="html"
            doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN"
            doctype-system="http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/>

<jsp:directive.page contentType="text/html"/>
<pageHelper:setPathway pathway="RESEARCH_COMPARE"/>


<c:set var="school" value="${ratingsCmd.school}"/>
<c:set var="ratingsDisplay" value="${ratingsCmd.ratingsDisplay}"/>
<c:set var="hasError" value="false"/>
<c:set var="hasRating" value="false"/>
<c:set var="overallRating" value="0"/>
<c:set var="ratingImagePath" value="/res/img/school/ratings/ratings_unavailable.gif"/>
<c:set var="imageDesc" value="This school has not been rated because sufficient test score data is not available."/>

<c:choose>
    <c:when test="${not empty school}">
        <c:set var="title" value="Test Score Ratings for ${school.name} - ${school.physicalAddress.city}, ${school.physicalAddress.state.longName} - ${school.physicalAddress.state}"/>
    </c:when>
    <c:otherwise>
        <c:set var="title" value="Test Score Ratings"/>
    </c:otherwise>
</c:choose>

<head>
    <title>${title}</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <meta name="Description"
          content="See ${title}"/>
</head>


<c:if test="${not empty ratingsCmd.overallRating.rating}">
    <c:set var="overallRating" value="${ratingsCmd.overallRating.rating}"/>
    <c:set var="hasRating" value="true"/>
    <c:set var="ratingImagePath" value="/res/img/school/ratings/ratings_${overallRating}.gif"/>
    <c:set var="imageDesc" value="GreatSchools Rating: ${overallRating} out of 10. Greatschools Ratings are based on test results. 10 is best."/>
</c:if>


<pageHelper:externalCss file="/res/css/school/ratings/ratings.css"/>
<gsml:body adPageName="ratings" pageLayout="ratings">
        <spring:hasBindErrors name="ratingsCmd">
            <c:set var="hasError" value="true"/>
            <ul>
                <c:forEach var="errMsgObj" items="${errors.allErrors}">
                    <li>
                        <spring:message code="${errMsgObj.code}" text="${errMsgObj.defaultMessage}"/>
                    </li>
                </c:forEach>
            </ul>
        </spring:hasBindErrors>

        <c:if test="${hasError eq 'false'}">
            <school:profile school="${school}" tab="ratings" gs_rating="${overallRating}">
                <gsml:equalizeColumns ids="'ratingContent','promoContent'"/>
                <div id="ratingContent">
                    <div class="ratingSummaryWrapper">
                        <div class="ratingSummaryContent">
                            <gsml:img src="${ratingImagePath}" alt="${imageDesc}" style="float:left;padding-right:12px;"/>

                            <h2>About GreatSchools Ratings:</h2>
                            <p>
                                Our ratings give an overview of this<br/>
                                school's test results. They are based<br/>
                                on a comparison of test results for all<br/>
                                schools in the state.
                            </p>
                            <p><link:article articleId="1023">What our ratings tell you &gt;</link:article></p>
                            <c:if test="${hasRating == 'true'}">
                                <p><link:schoolProfileTestscore school="${school}">See this school's test results &gt;</link:schoolProfileTestscore></p>
                            </c:if>
                        </div>
                    </div>

                    <c:if test="${!communityUtil.newCommunityEnabled}">
                        <jsp:include page="/community/communityQuestionPromo.module">
                            <jsp:param name="code" value="school/rating.page"/>
                            <jsp:param name="styleClass" value="bottomBorder"/>
                        </jsp:include>
                    </c:if>

                    <c:if test="${hasRating == 'true'}">
                        <ratings:table ratingsDisplay="${ratingsDisplay}"/>
                    </c:if>
                    <!-- <school:ratingsIssuesLink/>   -->
                    <div id="issuesLink">
                       <h3>GreatSchools Ratings are based on test results.
                           <gsml:a href="/issues/$LCSTATE/ratings.html" onClick="issues();" target="issues">See which tests were used &gt;</gsml:a></h3>
                   </div>
                    
                    <school:bigPicture school="${school}" hideTalkLink="true"/>
                    <school:compareSchool school="${school}"/>
                </div>
                <div id="promoContent">
                    <ad:setSlotPrefix slotPrefix="School_Profile_Page_Ratings"/>
                    <ad:Top_300x137/>
                    <ad:AboveFold_300x250/>
                    <ad:multiTextAd blurb="Advertiser links"/>
                    <school:nearbySchools school="${school}"/>
                </div>
            </school:profile>
        </c:if>

    <mod:tracking pageName="Ratings"
                  hier1="School,Ratings"
            school="${school}"
            />
</gsml:body>
</html>
</jsp:root>