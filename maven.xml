<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
* Copyright 2005 GreatSchools.net. All Rights Reserved.

 */
 -->

<project xmlns:j="jelly:core" xmlns:ant="jelly:ant" default="war">

    <preGoal name="java:compile">
        <mkdir dir="${maven.war.webapp.dir}/WEB-INF"/>
        <attainGoal name="xdoclet:webdoclet"/>
        <attainGoal name="create-build-version"/>
    </preGoal>

    <!-- Copy the Spring XML config files to the test dir for BaseTestCase -->
    <preGoal name="test:test">
        <copy todir="${maven.test.dest}">
            <fileset dir="${maven.src.dir}/webapp/WEB-INF">
                <include name="**/*.xml"/>
            </fileset>
        </copy>
    </preGoal>

    <!-- Create a version.properties file with the build info -->
    <goal name="create-build-version">
        <ant:propertyfile file="${maven.build.dest}/version.properties">
            <entry key="gsweb.buildtime" type="date" default="now"/>
        </ant:propertyfile>
    </goal>

    <goal name="cruisecontrol">
        <attainGoal name="clean"/>
        <attainGoal name="site"/>
        <!-- avoid running tests again -->
        <j:if test="${maven.test.failure}">
            <fail message="There were test failures."/>
        </j:if>
        <j:set var="maven.test.skip" value="true"/>
        <attainGoal name="war"/>
        <j:set var="maven.test.skip" value="false"/>
    </goal>
</project>

